{"job":{"components":{"43310":{"id":43310,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-962,"y":253,"width":32,"height":32,"inputConnectorIDs":[43317],"outputConnectorIDs":[43315],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DWtablesjoin"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select  distinct\n  C.customerid,  \n  C.segmentlanguage as language, \n\n  OT.campaignname,\nISNULL(convert_Timezone('America/Toronto', CAST(campaignstartdatetime as timestamp)), '1900-01-01') as campaignstartdatetime\n\n,ISNULL(convert_Timezone('America/Toronto', CAST(campaignenddatetimeUTC as timestamp)),'1900-01-01') as campaignenddatetime,\n  ISNULL(OT.offercodename,SO.offercode) as offercodename, \n\nOT.masterpromotioncode,\n  SO.offercode as segmentoffercode, \n  --case when (OT.newskiesbookingid <> 0 and  OT.newskiesrecordlocator <> '') then 1 else 0 end as singleusepromotioncodeusedflag,\n   0 as singleusepromotioncodeusedflag,\n  getdate() as createdttm,\n  So.trackinggroupcode,\n  C.emailaddress,\n  C.emailpermissionflag,\n  C.viporternumber,\n  C.viportertiercode,\n  public.f_encryptquerystring('ID', OT.campaignid,'DWCustomerID', cast(C.customerid as varchar(35))) as tokencustomerpromo,\n  ISNULL(OT.ModifiedDateUTC, '1900-01-01') as ModifiedDateUTC\n FROM $T{distinctcampaignpromos} OT\n  inner join mktg.segmentofferemail AS SO on OT.offercodename = SO.offercode AND SO.activedate = '${Currentactivedate}'\n\t\n inner join public.customer C on SO.emailaddress = C.emailaddress AND c.emailcustomerrank = 1\n inner join public.emailpermission AS EP on C.emailaddress = EP.emailaddress AND EP.consent = 'optin'\n\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43311":{"id":43311,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-1371,"y":258,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[43318],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"otup_campaignpromos"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"otup_campaignpromos"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"campaignname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"campaignstartdatetime"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"campaignenddatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"campaigntype"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"createddateutc"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"modifieddateutc"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"masterpromotioncode"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"newskiesbookingid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"newskiesrecordlocator"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"offercodename"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"campaignid"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43312":{"id":43312,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-767,"y":259,"width":32,"height":32,"inputConnectorIDs":[43315],"outputConnectorIDs":[43316],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"scheduledsenddatetimeutc"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select  getdate()  as scheduledsenddatetimeutc,\n\n*\nfrom $T{DWtablesjoin}\n--where campaignname is not null and masterpromotioncode is not null\n\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43313":{"id":43313,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":-577,"y":258,"width":32,"height":32,"inputConnectorIDs":[43316],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"responsys_sup_singleusepromocode"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"responsys_sup_singleusepromocode"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"customerid"},"2":{"slot":2,"type":"STRING","value":"customerid"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"language"},"2":{"slot":2,"type":"STRING","value":"language"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"campaignname"},"2":{"slot":2,"type":"STRING","value":"campaignname"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"campaignstartdatetime"},"2":{"slot":2,"type":"STRING","value":"campaignstartdatetime"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"campaignenddatetime"},"2":{"slot":2,"type":"STRING","value":"campaignenddatetime"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"offercodename"},"2":{"slot":2,"type":"STRING","value":"promotioncodetype"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"masterpromotioncode"},"2":{"slot":2,"type":"STRING","value":"masterpromotioncode"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"segmentoffercode"},"2":{"slot":2,"type":"STRING","value":"segmentoffercode"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"singleusepromotioncodeusedflag"},"2":{"slot":2,"type":"STRING","value":"singleusepromotioncodeusedflag"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"tokencustomerpromo"},"2":{"slot":2,"type":"STRING","value":"tokencustomerpromo"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"scheduledsenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"scheduledsenddatetimeutc"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"createdttm"},"2":{"slot":2,"type":"STRING","value":"createdttm"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"modifieddateutc"},"2":{"slot":2,"type":"STRING","value":"campaignmodifieddatetimeutc"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"customerid"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"campaignname"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"campaignenddatetime"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"apps"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43314":{"id":43314,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-1158,"y":255,"width":32,"height":32,"inputConnectorIDs":[43318],"outputConnectorIDs":[43317],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distinctcampaignpromos"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n\tDISTINCT \n\t--fp_otup_campaignid\n       --, \n       campaignid\n       --, otup_campaignpromoid\n       , campaignname\n       , campaignstartdatetime\n       , campaignenddatetimeutc\n       , campaigntype\n       , createddateutc\n       , modifieddateutc\n       --, newskiespromocodetype\n       --, promotioncodetype\n       , offercodename\n       --, offercodesid\n--       , newskiesbookingid\n--       , newskiesrecordlocator\n       , masterpromotioncode\n       --, id\n       --, offercodetypeid\n FROM $T{otup_campaignpromos}"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"43315":{"id":43315,"sourceID":43310,"targetID":43312},"43316":{"id":43316,"sourceID":43312,"targetID":43313},"43317":{"id":43317,"sourceID":43314,"targetID":43310},"43318":{"id":43318,"sourceID":43311,"targetID":43314}},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1572362710127,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"Apps - Marketing_singleusepromocodes_Load","description":"","type":"TRANSFORMATION"}}