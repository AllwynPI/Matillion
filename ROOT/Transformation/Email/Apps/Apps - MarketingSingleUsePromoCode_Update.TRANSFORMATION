{"job":{"components":{"43320":{"id":43320,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":403,"y":273,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[43325],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"otup_campaignpromos"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"otup_campaignpromos"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"campaignname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"campaignstartdatetime"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"campaignenddatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"campaigntype"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"createddateutc"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"modifieddateutc"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"masterpromotioncode"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"newskiesbookingid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"newskiesrecordlocator"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"offercodename"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"campaignid"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"customerid"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43321":{"id":43321,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":555,"y":270,"width":32,"height":32,"inputConnectorIDs":[43325],"outputConnectorIDs":[43326],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"allcampaignpromos"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select  distinct\n  C.customerid,  \n  C.segmentlanguage as language, \n\n  OT.campaignname,\nISNULL(convert_Timezone('America/Toronto', CAST(campaignstartdatetime as timestamp)), '1900-01-01') as campaignstartdatetime\n\n,ISNULL(convert_Timezone('America/Toronto', CAST(campaignenddatetimeUTC as timestamp)),'1900-01-01') as campaignenddatetime,\n  ISNULL(OT.offercodename,SO.offercode) as offercodename, \n\nOT.masterpromotioncode,\n  SO.offercode as segmentoffercode, \n  case when (OT.newskiesbookingid <> 0 and  OT.newskiesrecordlocator <> '') then 1 else 0 end as singleusepromotioncodeusedflag,\n   \n  getdate() as createdttm,\n  So.trackinggroupcode,\n  C.emailaddress,\n  C.emailpermissionflag,\n  C.viporternumber,\n  C.viportertiercode,\n  public.f_encryptquerystring('ID', OT.campaignid,'DWCustomerID', cast(C.customerid as varchar(35))) as tokencustomerpromo,\n  ISNULL(OT.ModifiedDateUTC, '1900-01-01') as ModifiedDateUTC\n FROM mktg.segmentofferemail SO\n left  join $T{otup_campaignpromos} OT on SO.offercode = OT.offercodename AND SO.activedate = '${Currentactivedate}'\n\n inner join public.customer C on SO.emailaddress = C.emailaddress  AND c.emailcustomerrank = 1\n and OT.customerid = C.customerid\n inner join public.emailpermission AS EP on C.emailaddress = EP.emailaddress AND EP.consent = 'optin'"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43322":{"id":43322,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":729,"y":271,"width":32,"height":32,"inputConnectorIDs":[43326],"outputConnectorIDs":[43324],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Copy of scheduledsenddatetimeutc"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select case when singleusepromotioncodeusedflag = 1 then '9999-12-31' else getdate() end as scheduledsenddatetimeutc,\n\n*\nfrom $T{allcampaignpromos}\n--where campaignname is not null and masterpromotioncode is not null\n\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"43323":{"id":43323,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":980,"y":271,"width":32,"height":32,"inputConnectorIDs":[43324],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"responsys_sup_singleusepromocode_1"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"responsys_sup_singleusepromocode"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"customerid"},"2":{"slot":2,"type":"STRING","value":"customerid"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"language"},"2":{"slot":2,"type":"STRING","value":"language"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"campaignname"},"2":{"slot":2,"type":"STRING","value":"campaignname"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"campaignstartdatetime"},"2":{"slot":2,"type":"STRING","value":"campaignstartdatetime"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"campaignenddatetime"},"2":{"slot":2,"type":"STRING","value":"campaignenddatetime"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"offercodename"},"2":{"slot":2,"type":"STRING","value":"promotioncodetype"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"masterpromotioncode"},"2":{"slot":2,"type":"STRING","value":"masterpromotioncode"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"segmentoffercode"},"2":{"slot":2,"type":"STRING","value":"segmentoffercode"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"singleusepromotioncodeusedflag"},"2":{"slot":2,"type":"STRING","value":"singleusepromotioncodeusedflag"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"tokencustomerpromo"},"2":{"slot":2,"type":"STRING","value":"tokencustomerpromo"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"scheduledsenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"scheduledsenddatetimeutc"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"createdttm"},"2":{"slot":2,"type":"STRING","value":"createdttm"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"modifieddateutc"},"2":{"slot":2,"type":"STRING","value":"campaignmodifieddatetimeutc"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"campaignname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"customerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"campaignenddatetime"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"apps"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"43324":{"id":43324,"sourceID":43322,"targetID":43323},"43325":{"id":43325,"sourceID":43320,"targetID":43321},"43326":{"id":43326,"sourceID":43321,"targetID":43322}},"canUndo":true,"undoCommand":"Edit Note","undoCreated":1571856678647,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"43489":{"id":43489,"x":483,"y":182,"width":142,"height":167,"text":"permission denied: schema mktg.","colour":"e6e63c"},"43494":{"id":43494,"x":671,"y":182,"width":142,"height":167,"text":"upstream dependency.","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"Apps - MarketingSingleUsePromoCode_Update","description":null,"type":"TRANSFORMATION"}}