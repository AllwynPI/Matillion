{"job":{"components":{"64878":{"id":64878,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":288,"y":176,"width":32,"height":32,"inputConnectorIDs":[64881],"outputConnectorIDs":[64882],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"passengerlegeventflag"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n\nCASE WHEN eventdatetimeutc = bookingdatetimeutc THEN 1 ELSE 0 END AS BookingDateFlag\n/* BookingParentDateFlag added */\n\n,CASE WHEN eventdatetimeutc = parentbookingdatetimeutc THEN 1 ELSE 0 END AS BookingParentDateFlag\n,CASE WHEN ISNULL(prev_unitdesignator,'') = '' AND ISNULL(unitdesignator,'') <> '' \n\t  THEN 1 ELSE 0 END AS SeatAssignedFlag\n /* added 2019-07-25 */        \n,CASE WHEN ISNULL(prev_unitdesignator,'') <> '' AND ISNULL(unitdesignator,'') <> '' AND prev_unitdesignator <> unitdesignator \n\t  THEN 1 ELSE 0 END AS SeatChangedFlag\n\t  \n,CASE WHEN ISNULL(prev_unitdesignator,'') <> '' AND unitdesignator = '' \n\t  THEN 1 ELSE 0 END AS SeatUnAssignedFlag   \n\t  \n/* updated 2019-07-25 */        \n,CASE WHEN eventdatetimeutc >= bookingdatetimeutc AND liftstatus = 1 AND prev_liftstatus = 0 AND parentpnrflag = 0 THEN 1 \n\t  WHEN eventdatetimeutc >= parentbookingdatetimeutc AND liftstatus = 1 AND prev_liftstatus = 0 AND parentpnrflag = 1 THEN 1\n      ELSE 0 END AS CheckInFlag \n\t  \n,CASE WHEN eventdatetimeutc >= bookingdatetimeutc AND liftstatus = 2 AND prev_liftstatus = 1 THEN 1\n\t/* added 2019-10-30 include booking status changes to determine the change to a confirmed boarded event from standby*/\n      WHEN eventdatetimeutc >= bookingdatetimeutc AND liftstatus = 2 AND prev_liftstatus = 2\n      AND bookingstatus = 'HK' AND prev_bookingstatus = 'HL' THEN 1\n      ELSE 0 END AS BoardedFlag  \n      \n,CASE WHEN eventdatetimeutc >= bookingdatetimeutc AND liftstatus = 3 THEN 1\n\t  WHEN eventdatetimeutc >= bookingdatetimeutc AND liftstatus = 0 AND prev_liftstatus = 3 THEN 1\t\n\t  ELSE 0 END AS NoShowFlag\n\t  \n,CASE WHEN prev_liftstatus = 2 \tAND liftstatus = 0 AND eventdatetimeutc > bookingdatetimeutc THEN 1\n\t   /* TQ - added 2019-10-16 */ \n\t  WHEN prev_liftstatus = 2 \tAND liftstatus = 1 AND eventdatetimeutc > bookingdatetimeutc THEN 1 \n\t  ELSE 0 END AS UnboardedFlag\n\t  \n/* updated 2019-07-25 */    \n,CASE WHEN prev_liftstatus = 1 AND liftstatus = 0  AND eventdatetimeutc > bookingdatetimeutc AND parentpnrflag = 0\n\t  THEN 1 \n      WHEN prev_liftstatus = 1 AND liftstatus = 0  AND eventdatetimeutc > parentbookingdatetimeutc AND parentpnrflag = 1\n      THEN 1\n      END AS CheckoutFlag\n\t  \n,CASE WHEN liftstatus = 0 AND eventdatetimeutc > bookingdatetimeutc\n\t\t/* ms are slightly different between pjs and pjleg version tables */\n      AND to_char(segmentminstartdatetimeutc, 'YYYY-MM-DD HH24:MI:SS') = to_char(eventdatetimeutc, 'YYYY-MM-DD HH24:MI:SS')  \n\t  THEN 1 ELSE 0 END AS SegmentAddedFlag\n\t  \n,CASE WHEN \n\t  eventdatetimeutc > bookingdatetimeutc\n\t  AND to_char(segmentmaxenddatetimeutc, 'YYYY-MM-DD HH24:MI:SS') = to_char(eventdatetimeutc, 'YYYY-MM-DD HH24:MI:SS')  \n      AND segmentmaxstartdatetimeutc <= eventdatetimeutc \n\t  THEN 1 ELSE 0 END AS SegmentDroppedFlag\n\t  \n/*needed when a leg/flight stays the same but the segment changes*/        \n,CASE WHEN eventdatetimeutc > bookingdatetimeutc\n\t  AND to_char(segmentmaxstartdatetimeutc, 'YYYY-MM-DD HH24:MI:SS') = to_char(eventdatetimeutc, 'YYYY-MM-DD HH24:MI:SS')  \n      AND segmentmaxstartdatetimeutc > segmentminstartdatetimeutc\n\t  THEN 1 ELSE 0 END AS SegmentChangeFlag\n\t  \n/* added logic to support split PNRs */        \n,CASE WHEN ISNULL(liftstatus,0) = 0 \n      AND parentpnrflag = 0 /* pnr was not split */\n\t  AND eventdatetimeutc > bookingdatetimeutc\n\t  AND to_char(legminstartdatetimeutc, 'YYYY-MM-DD HH24:MI:SS') = to_char(eventdatetimeutc, 'YYYY-MM-DD HH24:MI:SS')\n       --AND legmaxenddatetimeutc = '9999-12-31' /* removed because flights can be added and then dropped */\n\t  THEN 1 \n      WHEN ISNULL(liftstatus,0) = 0 \n      AND parentpnrflag = 1 /* pnr was split */\n\t  AND eventdatetimeutc > parentbookingdatetimeutc\n\t  AND to_char(legminstartdatetimeutc, 'YYYY-MM-DD HH24:MI:SS') = to_char(eventdatetimeutc, 'YYYY-MM-DD HH24:MI:SS')\n      THEN 1\n      ELSE 0 END AS LegAddedFlag\n\n ,CASE WHEN liftstatus = 0 \n\t  AND eventdatetimeutc > bookingdatetimeutc\n\t  AND to_char(legminstartdatetimeutc, 'YYYY-MM-DD HH24:MI:SS') = to_char(eventdatetimeutc, 'YYYY-MM-DD HH24:MI:SS')\n      AND legmaxenddatetimeutc > eventdatetimeutc \n      AND legmaxenddatetimeutc < '9999-12-31'\n\t  THEN 1 ELSE 0 END AS LegAddedTempFlag \n\n,CASE WHEN \teventdatetimeutc >= legmaxstartdatetimeutc \tAND eventdatetimeutc = legmaxenddatetimeutc\n      AND legmaxenddatetimeutc < '9999-12-31'\n\t  THEN 1 ELSE 0 END AS LegDroppedFlag\n        \n,CASE WHEN legmaxenddatetimeutc = '9999-12-31'  AND segmentmaxenddatetimeutc = '9999-12-31' AND liftstatus = 2 \n--AND prev_liftstatus = 1\n      THEN 1 ELSE 0 END AS FlightFlownFlag\n      \n, CASE WHEN bookingstatus = 'HL' then 1 ELSE 0 END AS standbyflag\n,*\n\nFROM $T{passenger_droplegevent}"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64879":{"id":64879,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":32,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64881],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"passenger_droplegevent"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n    'pjlvdrop' AS eventtype\n\t, pjlv.versionendutc AS eventdatetimeutc\n\t, pjlv.passengerid\n\t, pjlv.segmentid\n\t, pjlv.inventorylegid\n\t, pjlv.boardingsequence \n\t, pjlv.createduserid \n\t/*, pjlv.modifieduserid */\n    /* user id who deleted the flight record \n\tassumes there is still a segment and journey for the passenger */\n\t,ISNULL((SELECT TOP 1 pjsv.modifieduserid\n\t\tFROM ods.passengerjourneysegmentversion AS pjsv\n\t\tWHERE pjsv.passengerid = pjlv.passengerid\n\t\tAND pjsv.versionstartutc >= pjlv.versionendutc\n\t\tORDER BY pjsv.versionstartutc),pjlv.modifieduserid) AS modifieduserid\n        \n\t, pjlv.legnumber\t\n\t, pjlv.liftstatus\n\t, pjlv.unitdesignator\n    , pjlv.pjlvid\n    , pjlv.bookingstatus\n\t\n\t/*######### flight details ###########*/\n\t,CAST(TRIM(scheduled.flightnumber) AS int) AS flightnumber ,\n    TRIM(scheduled.carriercode)  as carriercode, \n\tCAST(scheduled.departuredate AS DATE) AS departuredate,\n\tscheduled.stdutc,  \n    scheduled.stdutc AS etdutc, \n\tscheduled.std,  \n    scheduled.std AS etd,  \n\tscheduled.departurestation, \n\tscheduled.arrivalstation,\n    scheduled.stautc,  \n\tscheduled.sta,\n\tscheduled.sta AS eta,\n    scheduled.stautc AS etautc\n    /*########## pnr  details ##############*/\n\t--bookingdatetime\n   /*,(SELECT TOP 1 b.createdutc FROM ods.bookingpassenger AS bp\n   \t\t\t\t\t\tINNER JOIN ods.booking AS b\n\t\t\t\t\t\tON bp.bookingid =b.bookingid\n\t\tWHERE bp.passengerid = pjlv.passengerid) AS bookingdatetimeutc*/\n    ,pl.bookingcreateddatetimeutc\tAS bookingdatetimeutc    \n    --get bookingid for each \n\t/*,(SELECT TOP 1 bp.bookingid FROM ods.bookingpassenger AS bp\n\t\tWHERE passengerid = pjlv.passengerid) AS bookingid*/\n\t,pl.bookingid AS bookingid\n    \n    /* identify the previous booking status, if exists */\n\t,(SELECT TOP 1 bookingstatus\n\t\tFROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t\tAND pij.segmentid = pjlv.segmentid\n\t\tAND pij.inventorylegid = pjlv.inventorylegid\n\t\tAND pij.versionstartutc < pjlv.versionstartutc\n\t\tORDER BY versionstartutc DESC) \tAS prev_bookingstatus\n    \n    \t/* identify the previous lift status, if exists */\n\t,(SELECT TOP 1 liftstatus\n\t\tFROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t\tAND pij.segmentid = pjlv.segmentid\n\t\tAND pij.inventorylegid = pjlv.inventorylegid\n\t\tAND pij.versionstartutc < pjlv.versionstartutc\n\t\tORDER BY versionstartutc DESC) \tAS prev_liftstatus\n\t\t\n\t/* identify the previous seat , if exists */\n\t,(SELECT TOP 1 unitdesignator\n\t\tFROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t\tAND pij.segmentid = pjlv.segmentid\n\t\tAND pij.inventorylegid = pjlv.inventorylegid\n\t\tAND pij.versionstartutc < pjlv.versionstartutc\n\t\tORDER BY versionstartutc DESC) \tAS prev_unitdesignator\t\n        \n\t/* ################# get relevancy to related pjsv ########*/\t\n\t\t\n\t--first datetime of the segmentid was effective\n\t,(SELECT MIN(versionstartutc) FROM ods.passengerjourneysegmentversion\n\t\tWHERE passengerid = pjlv.passengerid\n\t\tAND segmentid = pjlv.segmentid) AS segmentminstartdatetimeutc\n\t\t\n\t--last datetime of the segmentid values was effective\n\t,(SELECT MAX(versionstartutc) FROM ods.passengerjourneysegmentversion\n\t\tWHERE passengerid = pjlv.passengerid\n\t\tAND segmentid = pjlv.segmentid) AS segmentmaxstartdatetimeutc\t\n\t\n\t--first last datetime of the segmentid values expired\n\t,(SELECT MIN(versionendutc) FROM ods.passengerjourneysegmentversion AS pjs\n\t\tWHERE pjs.passengerid = pjlv.passengerid\n\t\tAND pjs.segmentid = pjlv.segmentid) AS segmentminenddatetimeutc\n\t\n\t--last datetime of the segmentid values expired\n\t,(SELECT MAX(versionendutc) FROM ods.passengerjourneysegmentversion AS pjs\n\t\tWHERE pjs.passengerid = pjlv.passengerid\n\t\tAND pjs.segmentid = pjlv.segmentid) AS segmentmaxenddatetimeutc\n        \n     --returns a change reason if one exists for the passenger segment\n    ,(SELECT TOP 1 changereasoncode FROM ods.passengerjourneysegmentversion AS pjsv\n\t\tWHERE pjsv.passengerid = pjlv.passengerid\n\t\tAND pjsv.segmentid = pjlv.segmentid\n\t\tAND pjsv.versionstartutc <= pjlv.versionstartutc\n\t\tORDER BY pjsv.versionstartutc DESC) AS segmentchangereasoncode    \n        \n\t\t\n\t/* ################# get relevancy to other related pjlv records ########*/\t\t\n\t\t\n\t--first datetime of the inventorylegid values was effective\n\t,(SELECT MIN(versionstartutc)  FROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n        AND pij.segmentid = pjlv.segmentid\n\t\tAND pij.inventorylegid = pjlv.inventorylegid) AS legminstartdatetimeutc\n\t\t\n\t--last datetime of the inventorylegid values was effective\t\n\t/*,(SELECT MAX(versionstartutc) FROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t\tAND pij.inventorylegid = pjlv.inventorylegid) AS legmaxstartdatetimeutc\n\t*/\n    ,(SELECT MAX(versionstartutc) FROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t\tAND pij.segmentid = pjlv.segmentid\n        AND pij.inventorylegid = pjlv.inventorylegid) AS legmaxstartdatetimeutc\n        \n\t--last datetime of the inventorylegid values expired use the segmentid \t\n\t/*,(SELECT MAX(versionendutc) FROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t\tAND pij.inventorylegid = pjlv.inventorylegid) AS legmaxenddatetimeutc\t*/\n    ,(SELECT MAX(versionendutc) FROM ods.passengerjourneylegversion AS pij\n\t\tWHERE pij.passengerid = pjlv.passengerid\n\t  AND pij.segmentid = pjlv.segmentid\t\n      AND pij.inventorylegid = pjlv.inventorylegid) AS legmaxenddatetimeutc    \n        \n    ,(SELECT MIN(journeynumber) FROM ods.passengerjourneysegmentversion AS pjs  \n\t\tWHERE pjs.passengerid = pjlv.passengerid\n\t\tAND pjs.segmentid = pjlv.segmentid) AS journeynumber\n        \n\t,(SELECT MIN(segmentnumber) FROM ods.passengerjourneysegmentversion AS pjs \n\t\tWHERE pjs.passengerid = pjlv.passengerid\n\t\tAND pjs.segmentid = pjlv.segmentid) AS segmentnumber\n       \n    /** passenger event related fields **/\n    ,pl.pnr\n\t,pl.parentbookingdatetimeutc\n    ,pl.bookingparentid\n    ,pl.parentpnrflag\n    ,pl.parentpnr\n    \n     /* product class info */\n\t,(SELECT TOP 1 pjsv.productclasscode\n\t\tFROM ods.passengerjourneysegmentversion AS pjsv\n\t\tWHERE pjsv.passengerid = pjlv.passengerid\n\t\tAND pjsv.segmentid = pjlv.segmentid\n\t\tAND ISNULL(pjsv.productclasscode,'') > ''\n\t\tAND pjsv.versionstartutc <= pjlv.versionstartutc\n\t\tORDER BY pjsv.versionstartutc DESC) AS productcodeclass\n        \nFROM ods.passengerjourneylegversion AS pjlv\nLEFT JOIN ods.inventorylegversion AS scheduled\n\tON scheduled.inventorylegid = pjlv.inventorylegid \n\tAND pjlv.versionendutc >= scheduled.versionstartutc \n\tAND pjlv.versionendutc <  scheduled.versionendutc\nINNER JOIN  stage.pnrpassengereventlist AS pl\n\tON pl.passengerid = pjlv.passengerid\n /* identify only leg records that have been deleted for the pjl records*/\nWHERE  --pjlv.passengerid='15739159' AND\n EXISTS (SELECT 1 FROM \n\t\t\t\t(SELECT segmentid, inventorylegid, MAX(versionendutc) AS maxversionendutc \n\t\t\t\tFROM ods.passengerjourneylegversion AS pj\n\t\t\t\tWHERE EXISTS (SELECT 1 FROM stage.pnrpassengereventlist AS ppel\n\t\t\t\t\t\t\t\tWHERE pj.passengerid = ppel.passengerid)\n\t\t\t\tGROUP BY segmentid, inventorylegid) AS pjl\n\t\t  \tWHERE pjl.segmentid = pjlv.segmentid\n\t\t\tAND pjl.inventorylegid = pjlv.inventorylegid\n\t\t\tAND pjl.maxversionendutc = pjlv.versionendutc\n\t\t\tAND pjl.maxversionendutc < '9999-12-31')\n\n                        \n\n\n        "}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64880":{"id":64880,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":512,"y":176,"width":32,"height":32,"inputConnectorIDs":[64882],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengerevent"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengerevent"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"},"2":{"slot":2,"type":"STRING","value":"eventtype"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"},"2":{"slot":2,"type":"STRING","value":"pnr"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"},"2":{"slot":2,"type":"STRING","value":"segmentid"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"inventorylegid"},"2":{"slot":2,"type":"STRING","value":"inventorylegid"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"boardingsequence"},"2":{"slot":2,"type":"STRING","value":"boardingsequence"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"createduserid"},"2":{"slot":2,"type":"STRING","value":"createduserid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"modifieduserid"},"2":{"slot":2,"type":"STRING","value":"modifieduserid"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"},"2":{"slot":2,"type":"STRING","value":"journeynumber"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"},"2":{"slot":2,"type":"STRING","value":"segmentnumber"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"},"2":{"slot":2,"type":"STRING","value":"legnumber"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"liftstatus"},"2":{"slot":2,"type":"STRING","value":"liftstatus"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"prev_liftstatus"},"2":{"slot":2,"type":"STRING","value":"prev_liftstatus"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"unitdesignator"},"2":{"slot":2,"type":"STRING","value":"unitdesignator"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"prev_unitdesignator"},"2":{"slot":2,"type":"STRING","value":"prev_unitdesignator"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"departuredate"},"2":{"slot":2,"type":"STRING","value":"departuredate"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"stdutc"},"2":{"slot":2,"type":"STRING","value":"stdutc"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"std"},"2":{"slot":2,"type":"STRING","value":"std"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingdatetimeutc"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"bookingid"},"2":{"slot":2,"type":"STRING","value":"bookingid"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"segmentminstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentminstartdatetimeutc"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"segmentmaxstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentmaxstartdatetimeutc"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"segmentminenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentminenddatetimeutc"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"segmentmaxenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentmaxenddatetimeutc"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"legminstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"legminstartdatetimeutc"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"legmaxstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"legmaxstartdatetimeutc"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"legmaxenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"legmaxenddatetimeutc"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"segmentchangereasoncode"},"2":{"slot":2,"type":"STRING","value":"segmentchangereasoncode"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdateflag"},"2":{"slot":2,"type":"STRING","value":"bookingdateflag"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"seatassignedflag"},"2":{"slot":2,"type":"STRING","value":"seatassignedflag"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"checkinflag"},"2":{"slot":2,"type":"STRING","value":"checkinflag"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"boardedflag"},"2":{"slot":2,"type":"STRING","value":"boardedflag"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"noshowflag"},"2":{"slot":2,"type":"STRING","value":"noshowflag"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"unboardedflag"},"2":{"slot":2,"type":"STRING","value":"unboardedflag"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"checkoutflag"},"2":{"slot":2,"type":"STRING","value":"checkoutflag"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"segmentaddedflag"},"2":{"slot":2,"type":"STRING","value":"segmentaddedflag"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"segmentdroppedflag"},"2":{"slot":2,"type":"STRING","value":"segmentdroppedflag"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"segmentchangeflag"},"2":{"slot":2,"type":"STRING","value":"segmentchangeflag"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"legaddedflag"},"2":{"slot":2,"type":"STRING","value":"legaddedflag"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"legaddedtempflag"},"2":{"slot":2,"type":"STRING","value":"legaddedtempflag"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"legdroppedflag"},"2":{"slot":2,"type":"STRING","value":"legdroppedflag"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"flightflownflag"},"2":{"slot":2,"type":"STRING","value":"flightflownflag"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"pjlvid"},"2":{"slot":2,"type":"STRING","value":"pjlvid"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"parentbookingdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"parentbookingdatetimeutc"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"bookingparentid"},"2":{"slot":2,"type":"STRING","value":"bookingparentid"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnrflag"},"2":{"slot":2,"type":"STRING","value":"parentpnrflag"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnr"},"2":{"slot":2,"type":"STRING","value":"parentpnr"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"bookingparentdateflag"},"2":{"slot":2,"type":"STRING","value":"bookingparentdateflag"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"seatchangedflag"},"2":{"slot":2,"type":"STRING","value":"seatchangedflag"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"sta"},"2":{"slot":2,"type":"STRING","value":"sta"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"stautc"},"2":{"slot":2,"type":"STRING","value":"stautc"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"productcodeclass"},"2":{"slot":2,"type":"STRING","value":"productclasscode"}}},"58":{"slot":58,"values":{"1":{"slot":1,"type":"STRING","value":"eta"},"2":{"slot":2,"type":"STRING","value":"eta"}}},"59":{"slot":59,"values":{"1":{"slot":1,"type":"STRING","value":"etautc"},"2":{"slot":2,"type":"STRING","value":"etautc"}}},"60":{"slot":60,"values":{"1":{"slot":1,"type":"STRING","value":"etd"},"2":{"slot":2,"type":"STRING","value":"etd"}}},"61":{"slot":61,"values":{"1":{"slot":1,"type":"STRING","value":"etdutc"},"2":{"slot":2,"type":"STRING","value":"etdutc"}}},"62":{"slot":62,"values":{"1":{"slot":1,"type":"STRING","value":"bookingstatus"},"2":{"slot":2,"type":"STRING","value":"bookingstatus"}}},"63":{"slot":63,"values":{"1":{"slot":1,"type":"STRING","value":"prev_bookingstatus"},"2":{"slot":2,"type":"STRING","value":"prev_bookingstatus"}}},"64":{"slot":64,"values":{"1":{"slot":1,"type":"STRING","value":"standbyflag"},"2":{"slot":2,"type":"STRING","value":"standbyflag"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64881":{"id":64881,"sourceID":64879,"targetID":64878},"64882":{"id":64882,"sourceID":64878,"targetID":64880}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64874":{"id":64874,"x":-158,"y":-158,"width":552,"height":145,"text":"identify the pnr passenger leg events\n\nevents are separated from add and drops events, based on the versionstartutc and versionendutc columns\n\nadditional subqueries and lookups are included in the queries to get additional information on relevant pjl records\n\n\n\nupdate:2019-11-21","colour":"e6e63c"},"64875":{"id":64875,"x":413,"y":76,"width":206,"height":174,"text":"**For testing purpose, we use update/insert\n We will change this to truncate when run in production\n**\n","colour":"e6e63c"},"64876":{"id":64876,"x":-119,"y":35,"width":281,"height":210,"text":"drop flight events\n\nthe versionendutc is used to identify the drop event datetime. only records that have been deleted without a 9999-12-31 record are used for drop events\n\nneed to review if all of the subqueries are needed. the less subqueries the better the performance","colour":"e6e63c"},"64877":{"id":64877,"x":227,"y":77,"width":137,"height":176,"text":"add indicators to identify the event of the record","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"PNR - Passenger Leg Drop Events","description":"extract the passengerjourneylegversion records to create the add, drop and change flight events","type":"TRANSFORMATION"}}