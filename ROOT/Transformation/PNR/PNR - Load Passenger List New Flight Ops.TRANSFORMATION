{"job":{"components":{"64885":{"id":64885,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":368,"y":304,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64887],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"bookings and passengers to process"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT DISTINCT b.recordlocator AS pnr, bp.bookingid, bp.passengerid\n\t, b.createdutc AS bookingcreateddatetimeutc, b.modifiedutc AS bookingmodifieddatetimeutc\n\t,  b.status AS bookingstatus\n\t,pbp.parentbookingid AS bookingparentid\n    ,CASE WHEN pbp.parentbookingid IS NOT NULL THEN 1 ELSE 0 END AS parentpnrflag\n\t,pbp.parentpnr AS parentpnr\n\t,pbp.parentbookingcreateddatetimeutc AS parentbookingdatetimeutc\nFROM  ods.booking as B\n\tINNER JOIN ods.BookingPassenger AS bp \n\tON b.BookingID = bp.BookingID \n    --INNER JOIN stage.pnrbookingparent AS pbp\n    LEFT JOIN stage.pnrbookingparent AS pbp\n\tON b.bookingid = pbp.bookingid\n/* load all pnrs with new flight events just loaded into the stage table */\nWHERE EXISTS (SELECT 1 FROM stage.pnrpassengerevent AS ppe\n\t\t\tWHERE eventtype IN ('flightarrivalevent','flightcancelevent','flightetaevent','flightetd/etaevent','flightetdevent','flightdiversion')\n\t\t\tAND createdttm >= DATEADD(hr,-1,getdate())\n            AND b.recordlocator =  ppe.pnr\n            AND bp.passengerid = ppe.passengerid)"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64886":{"id":64886,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":576,"y":304,"width":32,"height":32,"inputConnectorIDs":[64887],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengereventlist"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventlist"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"},"2":{"slot":2,"type":"STRING","value":"pnr"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"bookingid"},"2":{"slot":2,"type":"STRING","value":"bookingid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"bookingcreateddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingcreateddatetimeutc"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"bookingmodifieddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingmodifieddatetimeutc"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"bookingstatus"},"2":{"slot":2,"type":"STRING","value":"bookingstatus"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnrflag"},"2":{"slot":2,"type":"STRING","value":"parentpnrflag"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"bookingparentid"},"2":{"slot":2,"type":"STRING","value":"bookingparentid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnr"},"2":{"slot":2,"type":"STRING","value":"parentpnr"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"parentbookingdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"parentbookingdatetimeutc"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate"}}}},"visible":true},"6":{"slot":6,"name":"Automatic Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64887":{"id":64887,"sourceID":64885,"targetID":64886}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64884":{"id":64884,"x":338,"y":176,"width":345,"height":82,"text":"load new or updated flight event records records from the flight ops process to be loaded into the pnr history table\n\nupdated: 2019-11-28","colour":"e6e63c"}},"noteConnectors":{},"variables":{"maxeventdate":{"definition":{"name":"maxeventdate","type":"DATETIME","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"1990-01-01 00:00:00"}},"grids":{}},"info":{"name":"PNR - Load Passenger List New Flight Ops","description":"","type":"TRANSFORMATION"}}