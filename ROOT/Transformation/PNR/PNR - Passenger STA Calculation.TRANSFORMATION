{"job":{"components":{"64769":{"id":64769,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":480,"y":208,"width":32,"height":32,"inputConnectorIDs":[64773],"outputConnectorIDs":[64772],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"generatecalculationfields"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/*****************************************************************************************\n   calculate the max STA & STAUTC for each passenger's scheduled arrival flight for their journey & segments\n\t\n    assumes all the flight add and booked events are in the staging table \n*****************************************************************************************/    \n\nSELECT \n     pnr\n\t,passengerid\n\t,journeynumber\n\t,segmentnumber\n\t,segmentsta\n\t,segmentstautc\n\t,MAX(segmentsta) OVER (PARTITION BY pnr, passengerid, journeynumber) AS journeysta\n\t,MAX(segmentstautc) OVER (PARTITION BY pnr, passengerid, journeynumber) AS journeystautc\nFROM (\nSELECT \n\tpnr\n\t,passengerid\n\t,journeynumber\n\t,segmentnumber\n\t,MAX(STA) AS segmentsta\n    ,MAX(STAUTC) AS segmentstautc\nFROM $T{pnrpassengereventcalc_source} AS ppec\nWHERE  scheduledarrivalflightflag = 1 \nAND EXISTS (SELECT 1 FROM stage.pnrpassengereventlist AS ppel\n\t\t\t\tWHERE ppec.pnr = ppel.pnr) \nAND eventname IN ('BOOKED', 'FLIGHT ADDED','BOOKED STANDBY','FLIGHT ADDED STANDBY')\nGROUP BY pnr, passengerid, segmentnumber, journeynumber\n)\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64770":{"id":64770,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":272,"y":208,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64773],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventcalc_source"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventcalc"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"stautc"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"sta"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"scheduledarrivalflightflag"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64771":{"id":64771,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":710,"y":204,"width":32,"height":32,"inputConnectorIDs":[64772],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengereventcalc"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventcalc"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"},"2":{"slot":2,"type":"STRING","value":"pnr"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"},"2":{"slot":2,"type":"STRING","value":"journeynumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"journeysta"},"2":{"slot":2,"type":"STRING","value":"journeysta"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"journeystautc"},"2":{"slot":2,"type":"STRING","value":"journeystautc"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"segmentsta"},"2":{"slot":2,"type":"STRING","value":"segmentsta"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"segmentstautc"},"2":{"slot":2,"type":"STRING","value":"segmentstautc"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64772":{"id":64772,"sourceID":64769,"targetID":64771},"64773":{"id":64773,"sourceID":64770,"targetID":64769}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64767":{"id":64767,"x":226,"y":39,"width":523,"height":79,"text":"Add passenger STA for each journey\n\nupdated: 2019-09-19","colour":"e6e63c"},"64768":{"id":64768,"x":408,"y":154,"width":157,"height":185,"text":"\n\n\n\n\n\n\nlook at STA based on pnr, passenger and journeynumber","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"PNR - Passenger STA Calculation","description":"determines the passenger's sta for each journey on the pnr","type":"TRANSFORMATION"}}