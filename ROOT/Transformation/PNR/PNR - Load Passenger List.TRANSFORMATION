{"job":{"components":{"64847":{"id":64847,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":368,"y":304,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64849],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"bookings and passengers to process"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/*********************************************************************\n\n\tbuild the list of pnr to process or reprocess\n    \n    \n*********************************************************************/\n\nSELECT DISTINCT b.recordlocator AS pnr, bp.bookingid, bp.passengerid\n\t, b.createdutc AS bookingcreateddatetimeutc, b.modifiedutc AS bookingmodifieddatetimeutc\n\t,  b.status AS bookingstatus\n\t,pbp.parentbookingid AS bookingparentid\n    ,CASE WHEN pbp.parentbookingid IS NOT NULL THEN 1 ELSE 0 END AS parentpnrflag\n\t,pbp.parentpnr AS parentpnr\n\t,pbp.parentbookingcreateddatetimeutc AS parentbookingdatetimeutc, CAST('${maxeventdate}' AS TIMESTAMP) AS maxeventdate\nFROM  ods.booking as B\n\tINNER JOIN ods.BookingPassenger AS bp \n\tON b.BookingID = bp.BookingID \n    LEFT JOIN stage.pnrbookingparent AS pbp\n\tON b.bookingid = pbp.bookingid\nWHERE EXISTS (SELECT 1 FROM ods.passengerjourneylegversion AS pjlv\n\t\t\t\tWHERE (pjlv.versionstartutc >= CAST('${maxeventdate}' AS timestamp) \n                       OR (pjlv.versionstartutc >= CAST('${maxeventdate}' AS timestamp) AND pjlv.versionendutc < '9999-12-31')) \n\t\t\t\tAND pjlv.passengerid = bp.passengerid)\n\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64848":{"id":64848,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":592,"y":304,"width":32,"height":32,"inputConnectorIDs":[64849],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengereventlist"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventlist"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"},"2":{"slot":2,"type":"STRING","value":"pnr"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"bookingid"},"2":{"slot":2,"type":"STRING","value":"bookingid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"bookingcreateddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingcreateddatetimeutc"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"bookingmodifieddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingmodifieddatetimeutc"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"bookingstatus"},"2":{"slot":2,"type":"STRING","value":"bookingstatus"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnrflag"},"2":{"slot":2,"type":"STRING","value":"parentpnrflag"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"bookingparentid"},"2":{"slot":2,"type":"STRING","value":"bookingparentid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnr"},"2":{"slot":2,"type":"STRING","value":"parentpnr"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"parentbookingdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"parentbookingdatetimeutc"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate"}}}},"visible":true},"6":{"slot":6,"name":"Automatic Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64849":{"id":64849,"sourceID":64847,"targetID":64848}},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1576861576718,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64846":{"id":64846,"x":322,"y":153,"width":330,"height":96,"text":"Identify the pjlv records that have been created or updated since the last run\n\nuse the stage.pnrbookingparent table to identify the pnr parent\n\nupdated: 2019-12-14","colour":"e6e63c"}},"noteConnectors":{},"variables":{"maxeventdate":{"definition":{"name":"maxeventdate","type":"DATETIME","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019-12-01"}},"grids":{}},"info":{"name":"PNR - Load Passenger List","description":"","type":"TRANSFORMATION"}}