{"job":{"components":{"64707":{"id":64707,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":480,"y":208,"width":32,"height":32,"inputConnectorIDs":[64711],"outputConnectorIDs":[64710],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"generatecalculationfields"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n    \nCASE WHEN eventtype NOT IN ('flightarrival','flightetdevent','flightetaevent','flightarrivalevent','flightetd/etaevent') THEN\nCASE\n----------- Voluntary : If Event Reason = Move and done by customer on the web then voluntar ----------------------------\n\tWHEN eventuser in ('customer','app','gds') AND eventreason = 'MOVE' THEN 1 \n    \n---------- Involuntary major case : If Event Reason = IROP then involuntary -------------------------------------\n    WHEN eventreason = 'IROP' THEN 0\n    \n------------Voluntary major case : If Event Reason = VOLF then voluntary --------------------------------------------\n    WHEN eventreason = 'VOLF' THEN 1\n    \n----------- Involuntary cases : ---------------------------------------------------------------------------\n\tWHEN eventuser = 'customer' AND ISNULL(flightdeparturedelayflag,0) = 1 and eventreason <> 'IROP' THEN 0 \n    \n------------Involuntary: If Event Reason = Move and done by CSR or Call Centre then involuntary ---------------------\n\tWHEN eventuser in ('station','callcenter') AND eventreason = 'MOVE'  THEN 0\n    \n----------- Involuntary: Any FLight operations done by socc before departure date is Invlountary ------------------------\n    WHEN eventdatetimeutc < departuredate AND eventuser in ('socc','rebookpump','scheduler','station') AND eventname in ('FLIGHT ADDED','FLIGHT DROPPED','SEGMENT ADDED','SEGMENT DROPPED') THEN 0 \n    \n------------Voluntary : If any event done by customer before departure date -------------------------------------------\n    WHEN eventdatetimeutc < departuredate AND eventuser = 'customer' AND eventname in ('BOOKED','CHECKEDIN','SEAT ASSIGNED') THEN 1 \n    \n----------- Voluntary : Any FLight operations which is not performed by socc before departure date is Vountary -------    \n\tWHEN eventdatetimeutc < departuredate AND eventuser not in ('socc','rebookpump','scheduler','station') AND eventname in ('FLIGHT ADDED','FLIGHT DROPPED','SEGMENT ADDED','SEGMENT DROPPED')\n          THEN 1 \n          \n----------- Voluntary : If there is no delay and changes made by customer then Voluntary-------------------------------- \n\tWHEN eventuser = 'customer' AND ISNULL(flightdeparturedelayflag,0) = 0 and eventreason <> 'IROP' THEN 1 \n    \n    \n----------  Voluntary : Event Reason has no code then voluntary ----------------------------------------------------------\n\tWHEN eventreason = '' AND ISNULL(flightdeparturedelayflag,0) = 0 AND eventuser not in ('socc','rebookpump','scheduler')  THEN 1\n    \n    ELSE 0 END\n    \n ELSE 0  END voluntaryflag,\n\t \neventtype, \neventname, \neventuser, \neventdatetimeutc, \npassengerid, \nsegmentid, \nlegnumber,\njourneynumber,\nsegmentnumber,\nflightdeparturedelayflag, \ndeparturedate\n  /* check the flight the pax was on if this is an add event to see if there was a delay on the flight */ \nFROM $T{stage.pnrpassengereventcalc_src} AS pfe\nWHERE eventname IS NOT NULL\nAND eventdatetimeutc IS NOT NULL\nAND departuredate IS NOT NULL\nAND EXISTS (SELECT 1 FROM stage.pnrpassengereventlist AS ppel\n\t\t\t\tWHERE pfe.pnr = ppel.pnr)"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64708":{"id":64708,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":272,"y":208,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64711],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengereventcalc_src"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventcalc"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventuser"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"flightdeparturedelayflag"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"departuredate"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"eventreason"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64709":{"id":64709,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":816,"y":208,"width":32,"height":32,"inputConnectorIDs":[64710],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengereventcalc"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventcalc"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"voluntaryflag"},"2":{"slot":2,"type":"STRING","value":"voluntaryflag"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"},"2":{"slot":2,"type":"STRING","value":"segmentid"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"},"2":{"slot":2,"type":"STRING","value":"legnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"},"2":{"slot":2,"type":"STRING","value":"journeynumber"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"},"2":{"slot":2,"type":"STRING","value":"segmentnumber"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"},"2":{"slot":2,"type":"STRING","value":"eventtype"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"eventuser"},"2":{"slot":2,"type":"STRING","value":"eventuser"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64710":{"id":64710,"sourceID":64707,"targetID":64709},"64711":{"id":64711,"sourceID":64708,"targetID":64707}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64705":{"id":64705,"x":197,"y":-30,"width":783,"height":167,"text":"Identify when events and flight changes were performed by the customer \n\nwhen a customer moves flights  without any flight status issues. then it is considered voluntary\n. . include the flight status of the flight they moved from and the status of the flight they are moving to\n\nAll events with the customer as the event user are voluntary = 1\n\nFlight move events by the other event users that indicate the original flight had no issues is also voluntary = 1\n\nAll other events = 0\n\nupdated: 2019-10-23","colour":"e6e63c"},"64706":{"id":64706,"x":405,"y":174,"width":157,"height":185,"text":"\n\n\n\n\n\ncompare the eventuser and the status of the flight the customer moved from ","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"PNR - Voluntary Event Calc","description":"Identifies which events were done by the customer.","type":"TRANSFORMATION"}}