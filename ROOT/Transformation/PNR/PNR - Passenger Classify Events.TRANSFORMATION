{"job":{"components":{"64659":{"id":64659,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":32,"y":176,"width":32,"height":32,"inputConnectorIDs":[64663],"outputConnectorIDs":[64664],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"classify the event"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n\n/* passenger flight events */\nCASE WHEN eventtype IN ('pjlvdrop','pjlvadd') THEN \n\tCASE \n    \t--WHEN BookingDateFlag = 1 AND ISNULL(BookingParentDateFlag,0) = 0 THEN 'BOOKED'\n        /* updated 2019-10-30 added standby logic */\n    \tWHEN BookingDateFlag = 1 AND ISNULL(BookingParentDateFlag,0) = 0 AND bookingstatus = 'HL' THEN 'BOOKED STANDBY'\n\t\tWHEN BookingDateFlag = 1 AND ISNULL(BookingParentDateFlag,0) = 0 AND bookingstatus = 'HK' THEN 'BOOKED'\n      \n       /*New logic for booking ---\n        WHEN eventtype = 'pjlvadd' AND BookingDateFlag = 1 AND ISNULL(BookingParentDateFlag,0) = 0 AND AND LegDroppedFlag = 0  AND bookingstatus = 'HK' THEN 'BOOKED' */\n      \n        WHEN eventtype = 'pjlvadd' AND BookingDateFlag = 0 AND liftstatus = 0 and prev_liftstatus is NULL AND legaddedflag = 0 AND bookingstatus ='HL' THEN 'BOOKED STANDBY'\n\n\t    --WHEN BookingDateFlag = 0 AND ISNULL(BookingParentDateFlag,0) = 1 THEN 'BOOKED'\n\t    /* updated 2019-10-30 */\n        WHEN BookingDateFlag = 0 AND ISNULL(BookingParentDateFlag,0) = 1 AND bookingstatus = 'HK' THEN 'BOOKED'\n        \n\t\t--WHEN CheckInFlag = 1 AND LegDroppedFlag = 0 AND UnboardedFlag = 0 THEN 'CHECKEDIN'\n        /* updated 2019-10-30 */\n\t\tWHEN eventtype = 'pjlvadd' AND CheckInFlag = 1 AND LegDroppedFlag = 0 AND UnboardedFlag = 0 AND bookingstatus = 'HK' THEN 'CHECKEDIN'\n\t\tWHEN eventtype = 'pjlvadd' AND CheckInFlag = 1 AND LegDroppedFlag = 0 AND UnboardedFlag = 0 AND bookingstatus = 'HL' THEN 'CHECKEDIN STANDBY'       \n \n\t\t--WHEN BoardedFlag = 1 THEN 'BOARDED'\n\t\t/* updated 2019-10-30 */\n        WHEN eventtype = 'pjlvadd' AND BoardedFlag = 1 AND bookingstatus = 'HK' THEN 'BOARDED'\n\t\tWHEN eventtype = 'pjlvadd' AND liftstatus = 2 and prev_liftstatus = 2 AND bookingstatus = 'HK' AND prev_bookingstatus = 'HL' THEN 'BOARDED' \n\t\tWHEN eventtype = 'pjlvadd' AND BoardedFlag = 1 AND bookingstatus = 'HL' THEN 'BOARDED STANDBY'\n        \n        \n\t\t--WHEN SeatAssignedFlag = 1 AND LegDroppedFlag = 0 AND LegAddedFlag = 0 THEN 'SEAT ASSIGNED'\n\t    /* updated 2019-10-30 */\n        WHEN eventtype = 'pjlvadd' AND SeatAssignedFlag = 1 AND LegDroppedFlag = 0 AND LegAddedFlag = 0 AND bookingstatus = 'HK' THEN 'SEAT ASSIGNED'\n\t\tWHEN eventtype = 'pjlvadd' AND SeatAssignedFlag = 1 AND LegDroppedFlag = 0 AND LegAddedFlag = 0 AND bookingstatus = 'HL' THEN 'SEAT ASSIGNED STANDBY'\n        \n\t    WHEN eventtype = 'pjlvadd' AND SeatAssignedFlag = 0 AND LegAddedFlag = 0  AND LegDroppedFlag = 0 AND SeatChangedFlag = 1 THEN 'SEAT CHANGED'\t\t\n\t\tWHEN  UnboardedFlag = 1 AND LegAddedFlag = 0 AND LegAddedTempFlag = 0 AND SegmentAddedFlag = 0  AND SegmentDroppedFlag = 0 THEN 'UNBOARDED'\t\n\t\t\n\t\t\n\t\tWHEN eventtype = 'pjlvadd' AND  CheckoutFlag = 1 AND SegmentChangeFlag = 0 AND LegDroppedFlag = 0 AND LegAddedFlag = 0 THEN 'CHECKEDOUT'\n       \tWHEN eventtype = 'pjlvadd' AND  CheckoutFlag = 1 AND SegmentChangeFlag = 1 THEN 'CHECKEDOUT'\n        \n\t\t\n\t\tWHEN  eventtype = 'pjlvadd' AND CheckoutFlag = 0  AND SegmentDroppedFlag = 0  AND SegmentChangeFlag = 1  AND LegAddedFlag = 1  THEN 'FLIGHT CHANGED'\n\t    WHEN  eventtype = 'pjlvadd' AND CheckoutFlag = 0  AND SegmentDroppedFlag = 0  AND SegmentChangeFlag = 1  AND LegAddedFlag = 0  THEN 'SEGMENT CHANGED'\n\t\t\n\t\tWHEN eventtype = 'pjlvdrop' AND CheckoutFlag = 1   AND LegDroppedFlag = 1 AND LegAddedFlag = 0 THEN 'FLIGHT DROPPED' \n     \tWHEN eventtype = 'pjlvdrop' AND LegDroppedFlag =1  AND LegAddedFlag = 0  AND LegAddedTempFlag = 0 THEN 'FLIGHT DROPPED' \n\t\tWHEN eventtype = 'pjlvdrop' AND CheckoutFlag = 1   AND SegmentDroppedFlag = 0 AND SegmentChangeFlag = 0 AND LegDroppedFlag = 1 THEN 'FLIGHT DROPPED'\n        \n\t \n\t    WHEN eventtype = 'pjlvdrop' AND SegmentDroppedFlag = 1 AND LegDroppedFlag = 0 THEN 'SEGMENT DROPPED'  --is used\n\t\t\n\t    /* updated 2019-10-30 */\n        WHEN eventtype = 'pjlvadd' AND LegAddedFlag = 1 AND LegDroppedFlag = 0 AND bookingstatus = 'HK' THEN 'FLIGHT ADDED' \n\t\tWHEN eventtype = 'pjlvadd' AND LegAddedFlag = 1 AND LegDroppedFlag = 0 AND bookingstatus = 'HL' THEN 'FLIGHT ADDED STANDBY'\n        WHEN eventtype = 'pjlvadd' AND LegAddedTempFlag = 1 AND LegDroppedFlag = 0 THEN 'FLIGHT ADDED'  \t\t\t\t\t\t\t\t\t --maynot be used anymore\n\t    \n\t\t--WHEN LegAddedFlag = 1 AND LegDroppedFlag = 1 AND SegmentAddedFlag = 1 AND SegmentDroppedFlag = 1 THEN 'FLIGHT ADDED THEN DROPPED'  --maynot be used anymore\n\t\tWHEN eventtype = 'pjlvadd' AND SegmentAddedFlag = 1 AND SegmentDroppedFlag = 0 AND LegDroppedFlag = 0 THEN 'SEGMENT ADDED'\n\t\tWHEN eventtype = 'pjlvdrop' AND SegmentAddedFlag = 1 AND SegmentDroppedFlag = 1 THEN 'SEGMENT ADDED THEN DROPPED'                     --maynot be used anymore\n\t    \n\t    --new----------------------\n\t    WHEN eventtype = 'pjlvdrop' AND CheckoutFlag = 0 AND SegmentDroppedFlag = 0 AND SegmentChangeFlag = 0 \n\t    \tAND SeatAssignedFlag = 0  AND SeatUnAssignedFlag = 1 AND LegDroppedFlag = 0 THEN 'SEAT UNASSIGNED'\n\t    \n\t\tWHEN eventtype = 'pjlvadd' AND NoShowFlag = 1 THEN 'NOSHOW'\n\t\tELSE 'UNKNOWN PAX EVENT' END \n    /* baggage events */    \nWHEN eventtype IN ('bagcheckin','bagcheckout') THEN\n\t\tCASE WHEN eventtype = 'bagcheckin' THEN 'BAG CHECKEDIN'\n\t\t\t WHEN eventtype = 'bagcheckout' THEN 'BAG CHECKEDOUT' \n\t\tEND\n    /* denied boarding event*/    \nWHEN eventtype = 'deniedadd' THEN 'DENIED BOARDING'\n\n/* ops flight events*/    \nWHEN eventtype = 'flightetaevent' THEN 'FLIGHT ETA CHANGE'\nWHEN eventtype = 'flightetdevent' THEN 'FLIGHT ETD CHANGE'\nWHEN eventtype = 'flightetd/etaevent' THEN 'FLIGHT ETD/ETA CHANGE'\nWHEN eventtype = 'flightcancelevent' THEN 'FLIGHT CANCEL'\nWHEN eventtype = 'flightarrivalevent' THEN 'FLIGHT ARRIVAL'\nWHEN eventtype = 'flightarvdelayevent' THEN 'FLIGHT ARRIVAL DELAY'\nWHEN eventtype = 'flightdiversion' THEN 'FLIGHT DIVERSION'\nELSE 'UNKNOWN EVENT TYPE' \n\nEND AS EventName\n     \n/** gettin the rest of the fields **/\n    ,pfe.eventtype\n    ,pfe.segmentchangereasoncode as eventreason\n    ,pfe.modifieduserid\n    ,pfe.createduserid\n    ,pfe.eventdatetimeutc\n    ,pfe.pnr\n    ,pfe.passengerid \n    ,pfe.segmentid\n    ,pfe.inventorylegid\n    ,pfe.boardingsequence\n    ,pfe.journeynumber\n    ,pfe.segmentnumber\n    ,pfe.legnumber\n    ,pfe.liftstatus\n    ,pfe.prev_liftstatus\n    ,pfe.unitdesignator\n    ,pfe.prev_unitdesignator\n    ,pfe.flightnumber\n    ,pfe.carriercode\n    ,pfe.departuredate\n    ,pfe.stdutc\n    ,pfe.std\n    ,pfe.stautc\n    ,pfe.sta\n    ,pfe.etautc\n    ,pfe.eta\n    ,pfe.etdutc\n    ,pfe.etd    \n    ,pfe.departurestation\n    ,pfe.arrivalstation\n    ,pfe.bookingdatetimeutc\n    ,pfe.bookingid\n    ,pfe.segmentminstartdatetimeutc\n\t,pfe.segmentmaxstartdatetimeutc\n\t,pfe.segmentminenddatetimeutc\n\t,pfe.segmentmaxenddatetimeutc\n\t,pfe.legminstartdatetimeutc\n\t,pfe.legmaxstartdatetimeutc\n\t,pfe.legmaxenddatetimeutc\n\t,pfe.segmentchangereasoncode\n\t,pfe.bookingdateflag\n\t,pfe.seatassignedflag\n\t,pfe.checkinflag\n\t,pfe.boardedflag\n\t,pfe.noshowflag\n\t,pfe.unboardedflag\n\t,pfe.checkoutflag\n\t,pfe.segmentaddedflag\n\t,pfe.segmentdroppedflag\n\t,pfe.segmentchangeflag\n\t,pfe.legaddedflag\n\t,pfe.legaddedtempflag\n\t,pfe.legdroppedflag\n\t,pfe.flightflownflag\n\t,pfe.pjlvid\n    ,pfe.eventsourceid \n    ,pfe.productclasscode\n    ,pfe.parentpnrflag\n    ,pfe.standbyflag\n    ,pfe.pnrpassengereventid\nFROM $T{pnrpassengerevent} AS pfe\nWHERE EventName is NOT NULL \nAND EXISTS (SELECT 1 FROM stage.pnrpassengereventlist AS ppel\n\t\t\tWHERE pfe.pnr = ppel.pnr)\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64660":{"id":64660,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-160,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64663],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengerevent"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengerevent"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"inventorylegid"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"boardingsequence"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"createduserid"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"modifieduserid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"liftstatus"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"prev_liftstatus"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"unitdesignator"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"prev_unitdesignator"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"departuredate"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"stdutc"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"std"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdatetimeutc"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"bookingid"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"segmentminstartdatetimeutc"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"segmentmaxstartdatetimeutc"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"segmentminenddatetimeutc"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"segmentmaxenddatetimeutc"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"legminstartdatetimeutc"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"legmaxstartdatetimeutc"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"legmaxenddatetimeutc"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"segmentchangereasoncode"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdateflag"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"seatassignedflag"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"checkinflag"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"boardedflag"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"noshowflag"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"unboardedflag"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"checkoutflag"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"segmentaddedflag"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"segmentdroppedflag"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"segmentchangeflag"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"legaddedflag"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"legaddedtempflag"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"legdroppedflag"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"flightflownflag"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"createdttm"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"pjlvid"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"seatunassignedflag"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"bookingparentdateflag"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"seatchangedflag"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"stautc"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"sta"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"eventsourceid"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"productclasscode"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"etautc"}}},"58":{"slot":58,"values":{"1":{"slot":1,"type":"STRING","value":"eta"}}},"59":{"slot":59,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnrflag"}}},"60":{"slot":60,"values":{"1":{"slot":1,"type":"STRING","value":"etd"}}},"61":{"slot":61,"values":{"1":{"slot":1,"type":"STRING","value":"etdutc"}}},"62":{"slot":62,"values":{"1":{"slot":1,"type":"STRING","value":"bookingstatus"}}},"63":{"slot":63,"values":{"1":{"slot":1,"type":"STRING","value":"prev_bookingstatus"}}},"64":{"slot":64,"values":{"1":{"slot":1,"type":"STRING","value":"standbyflag"}}},"65":{"slot":65,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventid"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64661":{"id":64661,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":240,"y":176,"width":32,"height":32,"inputConnectorIDs":[64664],"outputConnectorIDs":[64665],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventuser"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \n\npjlv.*\n/** code for event user**/\n\t,a.agentname\n    --,a.locationcode as eventlocation \n    ,CASE WHEN eventtype IN ('flightarrival','flightetdevent','flightetaevent','flightarrivalevent','flightetd/etaevent','flightcancelevent') THEN 'SOCC'\n\t\t  WHEN agentname = 'IROPRB' THEN 'WWW'\n      ELSE a.locationcode END as eventlocation \n\t,p.persontype\n\t,ap.airportcode\n    ,CASE WHEN eventtype NOT IN ('flightarrival','flightetdevent','flightetaevent','flightarrivalevent','flightetd/etaevent','flightcancelevent') THEN \n\t\t/* all user events */\n\t\tCASE WHEN locationcode = 'WWW' THEN 'customer' \n\t\tWHEN locationcode = 'HDQ' AND agentname = 'irpump' THEN 'rebookpump'\n        WHEN locationcode = 'HDQ' AND agentname = 'PorterBusinessAPI' THEN 'app'\n         WHEN locationcode = 'HDQ' AND agentname = 'FLTFRM' THEN 'Porterapp'\n          WHEN locationcode = 'CAP' AND agentname = 'STFRFD' THEN 'Porterapp'\n        WHEN locationcode = 'HDQ' AND agentname = 'USHER' THEN 'usher'\n        WHEN locationcode = 'GDS' AND agentname = 'GDSMaster' THEN 'gds'\n        --WHEN locationcode = 'API' AND agentname = 'WWWCheckIn' THEN 'app'\n        WHEN locationcode = 'SYS' AND agentname = 'JobScheduler' THEN 'scheduler'\n        WHEN locationcode = 'SYS' AND agentname = 'KioskMaster' THEN 'kiosk'\n        WHEN locationcode = 'SALES' AND LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'sales'\n        WHEN locationcode = 'OPS' AND LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'ops'\n        WHEN locationcode = 'CALL' AND LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'callcenter'   \n        WHEN locationcode = 'HDQ' AND agentname = 'IROPRB' THEN 'customer'\n        WHEN locationcode = 'EXT' AND agentname = 'porterescapes' THEN 'customer' \n        WHEN locationcode = 'EXT' AND agentname = 'MyIDTravel' THEN 'customer' \n        WHEN locationcode = 'EXT' AND organizationcode = 'OPTIONTOWN' AND agentname = 'OPTIONTOWN' THEN 'customer' \n        WHEN locationcode = 'HDQ' AND organizationcode = 'PDCR' AND agentname not in ('irpump', 'PorterBusinessAPI', 'USHER', 'IROPRB') THEN 'crewresources' \n        WHEN locationcode = 'API' AND agentname IN ('WWWCheckIn','HRGGOVCAN','ALTAIR') THEN 'customer'  \n        WHEN locationcode = 'COMP' AND organizationcode = 'PD' THEN 'porterstaff' \n        WHEN locationcode = 'CURL' AND organizationcode = 'PD' THEN 'porterstaff'\n        WHEN locationcode = 'SOCC' AND agentname = 'GDSMaster' THEN 'gds'\n\t\tWHEN locationcode = 'DIST' AND  LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'porterstaff'\n\t\tWHEN locationcode = 'SECUR' AND  LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'porterstaff'\n        WHEN locationcode = 'HDQ' AND  LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'porterstaff'\n        WHEN locationcode = 'TECH' AND  LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'porterstaff'\n        \n        WHEN locationcode <> 'WWW' AND ap.airportcode = '' AND LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'station'\n        WHEN ap.airportcode <> '' AND LEFT(agentname,4) BETWEEN 0 AND 9999 THEN 'station'\n        WHEN ap.airportcode <> '' THEN 'station'\n        ELSE locationcode + '-' +  agentname END \n        \n     ELSE 'socc' END AS eventuser\n    \nFROM $T{classify the event} pjlv\nINNER JOIN ods.agent as a\nON a.agentid = pjlv.modifieduserid\nLEFT JOIN ods.person as p\nON a.personid = p.personid\nLEFT JOIN public.airport as ap\nON ap.airportcode = a.locationcode\n--WHERE pjlv.passengerid = '17781181'\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64662":{"id":64662,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":496,"y":176,"width":32,"height":32,"inputConnectorIDs":[64665],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.pnrpassengereventcalc"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengereventcalc"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"},"2":{"slot":2,"type":"STRING","value":"eventtype"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"eventuser"},"2":{"slot":2,"type":"STRING","value":"eventuser"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"eventlocation"},"2":{"slot":2,"type":"STRING","value":"eventlocation"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"eventreason"},"2":{"slot":2,"type":"STRING","value":"eventreason"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"},"2":{"slot":2,"type":"STRING","value":"pnr"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"},"2":{"slot":2,"type":"STRING","value":"segmentid"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"inventorylegid"},"2":{"slot":2,"type":"STRING","value":"inventorylegid"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"boardingsequence"},"2":{"slot":2,"type":"STRING","value":"boardingsequence"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"createduserid"},"2":{"slot":2,"type":"STRING","value":"createduserid"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"modifieduserid"},"2":{"slot":2,"type":"STRING","value":"modifieduserid"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"},"2":{"slot":2,"type":"STRING","value":"journeynumber"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"},"2":{"slot":2,"type":"STRING","value":"segmentnumber"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"},"2":{"slot":2,"type":"STRING","value":"legnumber"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"liftstatus"},"2":{"slot":2,"type":"STRING","value":"liftstatus"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"prev_liftstatus"},"2":{"slot":2,"type":"STRING","value":"prev_liftstatus"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"unitdesignator"},"2":{"slot":2,"type":"STRING","value":"unitdesignator"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"prev_unitdesignator"},"2":{"slot":2,"type":"STRING","value":"prev_unitdesignator"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"departuredate"},"2":{"slot":2,"type":"STRING","value":"departuredate"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingdatetimeutc"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"bookingid"},"2":{"slot":2,"type":"STRING","value":"bookingid"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"segmentminstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentminstartdatetimeutc"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"segmentmaxstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentmaxstartdatetimeutc"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"segmentminenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentminenddatetimeutc"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"segmentmaxenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"segmentmaxenddatetimeutc"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"legminstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"legminstartdatetimeutc"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"legmaxstartdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"legmaxstartdatetimeutc"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"legmaxenddatetimeutc"},"2":{"slot":2,"type":"STRING","value":"legmaxenddatetimeutc"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"segmentchangereasoncode"},"2":{"slot":2,"type":"STRING","value":"segmentchangereasoncode"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdateflag"},"2":{"slot":2,"type":"STRING","value":"bookingdateflag"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"seatassignedflag"},"2":{"slot":2,"type":"STRING","value":"seatassignedflag"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"checkinflag"},"2":{"slot":2,"type":"STRING","value":"checkinflag"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"boardedflag"},"2":{"slot":2,"type":"STRING","value":"boardedflag"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"noshowflag"},"2":{"slot":2,"type":"STRING","value":"noshowflag"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"unboardedflag"},"2":{"slot":2,"type":"STRING","value":"unboardedflag"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"checkoutflag"},"2":{"slot":2,"type":"STRING","value":"checkoutflag"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"segmentaddedflag"},"2":{"slot":2,"type":"STRING","value":"segmentaddedflag"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"segmentdroppedflag"},"2":{"slot":2,"type":"STRING","value":"segmentdroppedflag"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"segmentchangeflag"},"2":{"slot":2,"type":"STRING","value":"segmentchangeflag"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"legaddedflag"},"2":{"slot":2,"type":"STRING","value":"legaddedflag"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"legaddedtempflag"},"2":{"slot":2,"type":"STRING","value":"legaddedtempflag"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"legdroppedflag"},"2":{"slot":2,"type":"STRING","value":"legdroppedflag"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"flightflownflag"},"2":{"slot":2,"type":"STRING","value":"flightflownflag"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"pjlvid"},"2":{"slot":2,"type":"STRING","value":"pjlvid"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"productclasscode"},"2":{"slot":2,"type":"STRING","value":"productclasscode"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"stdutc"},"2":{"slot":2,"type":"STRING","value":"stdutc"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"std"},"2":{"slot":2,"type":"STRING","value":"std"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"sta"},"2":{"slot":2,"type":"STRING","value":"sta"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"stautc"},"2":{"slot":2,"type":"STRING","value":"stautc"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"eta"},"2":{"slot":2,"type":"STRING","value":"eta"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"etautc"},"2":{"slot":2,"type":"STRING","value":"etautc"}}},"58":{"slot":58,"values":{"1":{"slot":1,"type":"STRING","value":"parentpnrflag"},"2":{"slot":2,"type":"STRING","value":"pnrdividedflag"}}},"59":{"slot":59,"values":{"1":{"slot":1,"type":"STRING","value":"etd"},"2":{"slot":2,"type":"STRING","value":"etd"}}},"60":{"slot":60,"values":{"1":{"slot":1,"type":"STRING","value":"etdutc"},"2":{"slot":2,"type":"STRING","value":"etdutc"}}},"61":{"slot":61,"values":{"1":{"slot":1,"type":"STRING","value":"standbyflag"},"2":{"slot":2,"type":"STRING","value":"standbyflag"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"segmentid"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64663":{"id":64663,"sourceID":64660,"targetID":64659},"64664":{"id":64664,"sourceID":64659,"targetID":64661},"64665":{"id":64665,"sourceID":64661,"targetID":64662}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64655":{"id":64655,"x":-171,"y":-117,"width":724,"height":161,"text":"Each passenger event  is assigned an event name, event user and event location\n\nThe event user is determine based on the source of the event (ODS or Operations db) and the modified user id\n\nThe event record is added to the stage.pnrpassengereventcalc\n\nmodified event user case 'IROPRB' then 'customer' \n\nincludes logic to identify a standby event versus a confirmed event\n\n\nupdate:2019-11-19","colour":"e6e63c"},"64656":{"id":64656,"x":-46,"y":104,"width":165,"height":143,"text":"Identify the event names based on the flags on the record","colour":"e6e63c"},"64657":{"id":64657,"x":166,"y":101,"width":148,"height":141,"text":"identify the event users","colour":"e6e63c"},"64658":{"id":64658,"x":391,"y":62,"width":206,"height":174,"text":"**For testing purpose, we use update/insert\n We will change this to truncate when run in production\n**\n","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"PNR - Passenger Classify Events","description":"Process the raw event records in the stage table to identify the event, event user and  flight info","type":"TRANSFORMATION"}}