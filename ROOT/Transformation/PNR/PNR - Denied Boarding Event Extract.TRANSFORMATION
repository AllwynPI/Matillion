{"job":{"components":{"64699":{"id":64699,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-48,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[64702],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"deniedboarding_feecharges"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT DISTINCT\n'deniedadd' AS eventtype\n,b.bookingid\n,b.createdutc AS bookingdatetimeutc\n, b.recordlocator AS pnr\n, bp.passengerid\n, pfc.chargecode\n, pf.createdutc AS eventdatetimeutc\n, CAST(0 AS int) AS segmentid\n, il.inventorylegid\n, il.carriercode\n, il.flightnumber\n, il.departuredate AS flightdate\n, il.departurestation\n, il.arrivalstation\n, pf.createduserid\n, pf.modifieduserid\n, pjs.journeynumber\n, pjs.segmentnumber\n, pjs.departuredate\n, 0 AS legnumber\t\n, 0 AS liftstatus\n, '' AS unitdesignator\n, CAST( 0 AS int) AS voluntaryflag\nFROM ods.booking AS b\nINNER JOIN ods.bookingpassenger AS bp\n\ton b.bookingid = bp.bookingid\nINNER JOIN ods.passengerfee AS pf\n\tON pf.passengerid = bp.passengerid\nINNER JOIN ods.passengerfeecharge AS pfc\n\ton bp.passengerid = pfc.passengerid\n\tAND pf.feenumber = pfc.feenumber\nLEFT JOIN ods.inventoryleg AS il /*get flight info if it exists */\n\tON il.inventorylegid = pf.inventorylegid\nLEFT JOIN ods.passengerjourneysegment AS pjs /* try to identify the journey and segment the denied was for will need to use the version table*/\n\ton bp.passengerid = pjs.passengerid\n\tAND pjs.departuredate = CAST(pf.createdutc AS date)    \nWHERE pfc.chargecode in ('COVER', 'CCREW', 'SMTOW', 'SMAIN', 'SCREW', 'UMTOW', 'UCREW', 'USECU', 'UOTHR')\nAND pf.createdutc > '2019-07-15' /* change to incremental change */"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64700":{"id":64700,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":528,"y":176,"width":32,"height":32,"inputConnectorIDs":[64703],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage.passengerflightevent"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"passengerflightevent"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"},"2":{"slot":2,"type":"STRING","value":"passengerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"journeynumber"},"2":{"slot":2,"type":"STRING","value":"journeynumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"segmentnumber"},"2":{"slot":2,"type":"STRING","value":"segmentnumber"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"},"2":{"slot":2,"type":"STRING","value":"eventtype"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"bookingid"},"2":{"slot":2,"type":"STRING","value":"bookingid"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"bookingdatetimeutc"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"pnr"},"2":{"slot":2,"type":"STRING","value":"pnr"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"inventorylegid"},"2":{"slot":2,"type":"STRING","value":"inventorylegid"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"departuredate"},"2":{"slot":2,"type":"STRING","value":"departuredate"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"createduserid"},"2":{"slot":2,"type":"STRING","value":"createduserid"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"modifieduserid"},"2":{"slot":2,"type":"STRING","value":"modifieduserid"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"legnumber"},"2":{"slot":2,"type":"STRING","value":"legnumber"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"liftstatus"},"2":{"slot":2,"type":"STRING","value":"liftstatus"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"passengerid"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventtype"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stage"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"64701":{"id":64701,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":256,"y":176,"width":32,"height":32,"inputConnectorIDs":[64702],"outputConnectorIDs":[64703],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"deniedboard_eventflag"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \nCASE WHEN eventdatetimeutc <> bookingdatetimeutc THEN 1 ELSE 0 END AS DeniedBoardingFlag\n,*\nFROM $T{deniedboarding_feecharges}"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"64702":{"id":64702,"sourceID":64699,"targetID":64701},"64703":{"id":64703,"sourceID":64701,"targetID":64700}},"canUndo":true,"undoCommand":"Delete","undoCreated":1583852334451,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"64695":{"id":64695,"x":-138,"y":-67,"width":515,"height":111,"text":"identify denied boarding fees added to pnrs to create an event for the pnr history process\n\nevent is sourced from the rez.passengerfeecharge table for charge code in ('COVER', 'CCREW', 'SMTOW', 'SMAIN', 'SCREW', 'UMTOW', 'UCREW', 'USECU', 'UOTHR')\n\n\nUpdate:2019-07-29","colour":"e6e63c"},"64696":{"id":64696,"x":-141,"y":91,"width":229,"height":143,"text":"Denied boarding fee codes\n\nthe createdutc is used to identify new events since the last time the process ran","colour":"e6e63c"},"64697":{"id":64697,"x":429,"y":72,"width":206,"height":174,"text":"**For testing purpose, we use update/insert\n We will change this to truncate when run in production\n**\n","colour":"e6e63c"},"64698":{"id":64698,"x":187,"y":74,"width":137,"height":176,"text":"add indicators to identify the event of the record","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"PNR - Denied Boarding Event Extract","description":"extract the passenger fee and passenger charge to identify denied boarding events added to the pnr","type":"TRANSFORMATION"}}