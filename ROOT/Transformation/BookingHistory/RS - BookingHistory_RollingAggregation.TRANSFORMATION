{"job":{"components":{"28207":{"id":28207,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":240,"y":159,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[28209],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public.BookingHistory"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT CityPairLegOrdered, cityPairleg,  FlownDatelocal, BookingDate \n      , sum(case when liftstatus<>'NoShow' then 1 else 0 end) as \"Segments\"\n      , sum(ProratedNetFarePlusNAV) as \"Revenue\" \n\t  ,sum(case when liftstatus<>'NoShow' then 1 else 0 end*actualdistance) as \"RPM\"\n      , sum(case when citypairlegordered=odordered and liftstatus<>'NoShow' then 1 else 0 end) as \"ODSegments\"\n      , sum(case when citypairlegordered=odordered then odnetfareplusnav else 0 end) as \"ODRevenue\"  \n      \nFROM public.BookingHistory \nWHERE FlownDatelocal >=  (Select firstdayofmonth\n\t\t\t\t\t\t\tfrom public.datedimension\n\t\t\t\t\t\t\twhere date = CAST(dateadd(mons, -36, getdate()) as date))      \n      and Origin<>Destination \n      and COSCode not in ('VY','VB','VG','VL','VM','VN','VQ','VH','VK','VT','VS','VE','VW','VO','VX','VF',\n\t\t\t'EY','EB','EG','EL','EM','EN','EQ','EH','EK','ET','ES','EE','EW','EO','EX','EF',\n\t\t\t'LY','LB','LG','LL','LM','LN','LQ','LH','LK','LT','LS','LE','LW','LO','LX','LF',\n\t\t\t'ZA','ZI','ZX','ZB','ZE','ZF','ZJ','ZK','ZC','ZN','ZL','ZM','ZH','ZZ','ZQ','ZR','ZP',\n\t\t\t/*'Z','O','OA','OB','OC','OD','CT') changed on 2018-05-14*/\n            'OA','OB','OC','OD','CT')\n      /*and CosCode Not Like 'Z%' changed on 2018-08-21*/\n      and CarrierCode='PD' and ODNetFarePlusNAV < 3000 \n      and ProratedNetFarePlusNAV < 3000 \nGROUP BY CityPairLegOrdered,citypairleg, FlownDatelocal, BookingDate \n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"28208":{"id":28208,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":474,"y":158,"width":32,"height":32,"inputConnectorIDs":[28209],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rm.marketrevenuesegments"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"marketrevenuesegments"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"citypairlegordered"},"2":{"slot":2,"type":"STRING","value":"citypairlegordered"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"flowndatelocal"},"2":{"slot":2,"type":"STRING","value":"flowndatelocal"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"bookingdate"},"2":{"slot":2,"type":"STRING","value":"bookingdate"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"segments"},"2":{"slot":2,"type":"STRING","value":"segments"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"revenue"},"2":{"slot":2,"type":"STRING","value":"revenue"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rpm"},"2":{"slot":2,"type":"STRING","value":"rpm"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"odsegments"},"2":{"slot":2,"type":"STRING","value":"odsegments"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"odrevenue"},"2":{"slot":2,"type":"STRING","value":"odrevenue"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"citypairleg"},"2":{"slot":2,"type":"STRING","value":"citypairleg"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate"}}}},"visible":true},"6":{"slot":6,"name":"Automatic Compression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"If Not Already"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rm"}}}},"visible":true}},"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"28209":{"id":28209,"sourceID":28207,"targetID":28208}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"28206":{"id":28206,"x":-35,"y":-37,"width":403,"height":102,"text":"created for RM to manage the last 36 months for analysis\nChanged to last 36 months\n\nlast updated: 2018-05-14\n\nremoved the \"O\" coscode","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"RS - BookingHistory_RollingAggregation","description":"","type":"TRANSFORMATION"}}