{"job":{"components":{"91478":{"id":91478,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-64,"y":224,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[91480],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Arrival Events Post Diversion"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \nDISTINCT\nfeh.ARVL_EVENTDATETIMEUTC\n\t,feh.ARVL_EVENTNAME\n    ,feh.flighteventhistoryid\n    ,feh.FLIGHTDATE\n    ,feh.ARVL_FLIGHTDATE\n\t,pph.passengerid\n    ,pph.journeynumber, pph.segmentid, pph.legnumber\n\t,pph.flightnumber,  feh.ARVL_DEPARTURESTATION\n\t,pph.segmentnumber\n\t,pph.bookingid\n\t,pph.bookingdatetimeutc\n\t,pph.pnr\n\t,pph.inventorylegid\n    ,ARVL_FLIGHTNUMBER    \n\t,feh.ARVL_CARRIERCODE\n\t,feh.ARVL_ARRIVALSTATION\n    ,pph.boardingsequence\n    ,pph.liftstatus\n\t,pph.assignedseat\n    ,pph.stdutc\n\t,pph.std\n\t,pph.sta\n\t,pph.stautc\n    ,ISNULL(pph.standbyflag,0) AS standbyflag\n    ,pph.productclasscode\n    ,feh.createdttm\nFROM public.pnrpassengerhistory AS pph\n\tLEFT OUTER JOIN (SELECT eventname , eventdatetimeutc,\n\t\tcarriercode,\n\t\tflightnumber,\n\t\tflightdate,\n\t\tdeparturestation,\n\t\tarrivalstation,\n\t\tleghashkey,\n\t\tflighteventhistoryid,\n\t   \tARVL_EVENTNAME,\n        ARVL_EVENTDATETIMEUTC,\n\t\tARVL_CARRIERCODE,\n\t   \tARVL_FLIGHTNUMBER,\n\t\tARVL_FLIGHTDATE,\n\t\tARVL_DEPARTURESTATION,\n\t   \tARVL_ARRIVALSTATION,\n\t\tARVL_LEGHASHKEY,\n\t\tgetdate() createdttm\nFROM\n(\n\nselect FEHD.eventname eventname , FEHD.eventdatetimeutc eventdatetimeutc,\n\t\t\t\t\t   FEHD.carriercode carriercode,\n\t\t\t\t\t   FEHD.flightnumber flightnumber,\n\t\t\t\t\t   FEHD.flightdate flightdate,\n\t\t\t\t\t   FEHD.departurestation departurestation,\n\t\t\t\t\t   FEHD.arrivalstation arrivalstation,\n\t\t\t\t\t   FEHD.leghashkey leghashkey,\n\t\t\t\t\t   FEHA.flighteventhistoryid flighteventhistoryid,\n\t   \t\t\t\t   FEHA.eventname ARVL_EVENTNAME,\n                       FEHA.eventdatetimeutc ARVL_EVENTDATETIMEUTC,\n\t\t\t\t\t   FEHA.carriercode ARVL_CARRIERCODE,\n\t   \t\t\t\t   FEHA.flightnumber ARVL_FLIGHTNUMBER,\n\t\t\t\t\t   FEHA.flightdate ARVL_FLIGHTDATE,\n\t\t\t\t\t   FEHA.departurestation ARVL_DEPARTURESTATION,\n\t   \t\t\t\t   FEHA.arrivalstation ARVL_ARRIVALSTATION,\n\t\t\t\t\t   FEHA.leghashkey ARVL_LEGHASHKEY,\n\t\t\t\t\t   getdate() createdttm\n  \t\t\tFROM public.flighteventhistory FEHD\n\t\t\tLEFT OUTER JOIN  public.flighteventhistory FEHA\n\t   \t\tON  FEHD.FLIGHTNUMBER = FEHA.FLIGHTNUMBER\n\t   \t\t\tAND FEHD.FLIGHTDATE = FEHA.FLIGHTDATE\n\t   \t\t\tAND FEHA.EVENTDATETIMEUTC >= FEHD.EVENTDATETIMEUTC\n\t   \t\t\tAND FEHA.EVENTNAME ='ARRIVAL'\n  \t\t\tWHERE FEHD.EVENTNAME  ='DIVERSION'\n)\t\t\t) AS feh\n\tON pph.flightnumber = feh.flightnumber\n\tAND pph.departuredate = feh.flightdate\n\tAND pph.departurestation = feh.departurestation\n\tAND pph.arrivalstation = feh.arrivalstation\nWHERE pph.eventname = 'FLIGHT DIVERSION' \nAND feh.eventname = 'DIVERSION' AND pph.standbyflag=0 AND pph.pnr IS NOT NULL\n/*\nSELECT * FROM (\nSELECT distinct 'ARRIVAL' eventname, \n'Arrival at:'||intime||';' as description\n, effectivedatetimeutc eventdatetimeutc, carriercode,flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc,leghashkey) RANKNO\nFROM public.flightdetailhistory AS fdh\nWHERE intime > '1900-01-01' \nand effectivedatetimeutc >= '${lasttimearrival}'\n--and effectivedatetimeutc >= '2017-12-30 21:05:11.643'\nand departurestation <> arrivalstation\nAND NOT EXISTS (SELECT 1 FROM public.flightdetailhistory AS cx\n\t\t\t\tWHERE cx.leghashkey = fdh.leghashkey\n\t\t\t\tAND cx.iropcode like 'X%')\n) WHERE RANKNO = 1\n*/\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"91479":{"id":91479,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":304,"y":224,"width":32,"height":32,"inputConnectorIDs":[91480],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public.flighteventhistory"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pnrpassengerhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"arvl_eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"arvl_carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"arvl_flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"arvl_flightdate"},"2":{"slot":2,"type":"STRING","value":"departuredate"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"arvl_departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"arvl_arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"createdttm"},"2":{"slot":2,"type":"STRING","value":"createdttm"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"createdttm"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"91480":{"id":91480,"sourceID":91478,"targetID":91479}},"canUndo":true,"undoCommand":"Delete","undoCreated":1583786166332,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"91475":{"id":91475,"x":-197,"y":8,"width":379,"height":95,"text":"This Job calculates Flight Arrival Event for every diversion recorded in the Flight Detail History table recorded \n\nidentifies a \"ARRIVAL\" after a \"DIVERSION\"\n\nupdated:2020--01-27","colour":"e6e63c"},"91476":{"id":91476,"x":-196,"y":131,"width":222,"height":141,"text":"Calculating Flight Arrival Events","colour":"e6e63c"},"91477":{"id":91477,"x":204,"y":134,"width":199,"height":135,"text":"Update FlightEventHistory table","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimearrival":{"definition":{"name":"lasttimearrival","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018-01-01"}},"grids":{}},"info":{"name":"OPS - FlightEventArrivalPostDiversion_Load","description":"","type":"TRANSFORMATION"}}