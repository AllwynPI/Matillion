{"job":{"components":{"62936":{"id":62936,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":352,"y":304,"width":32,"height":32,"inputConnectorIDs":[62938],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public.flightdetailhistory"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flightdetailhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"effectivedatetimeutc"},"2":{"slot":2,"type":"STRING","value":"effectivedatetimeutc"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"activeflag"},"2":{"slot":2,"type":"STRING","value":"activeflag"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"effectivedatetimeutc"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62937":{"id":62937,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":128,"y":304,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[62938],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rank active records"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/************************************************************************\n\tidentify the active record when there are duplicate events\n\t\n\twhen 2 instances of a flight are being updated at the same time, \n\tuse the first created flight instance as the highest rank record. When the first instance was canceled \n    used the second record as the highest rank because the second record will have the updated OOOI times\n\n************************************************************************/\nSELECT \ncarriercode, flightnumber, flightdate, departurestation\n,arrivalstation, effectivedatetimeutc, leghashkey\n,CASE WHEN rankno > 1 THEN 0 ELSE 1 END AS activeflag\nFROM (SELECT carriercode, flightnumber, flightdate, departurestation, arrivalstation, effectivedatetimeutc, leghashkey\n\t\t/* updated 2019-11-19 , rank() over (partition by carriercode, flightnumber, flightdate, departurestation\n                       , arrivalstation, effectivedatetimeutc order by leghashkey) AS rankno*/\n        , rank() over (partition by carriercode, flightnumber, flightdate, departurestation\n                       , arrivalstation, effectivedatetimeutc order by POSITION('-Y' IN uncorrectedtailnumber), leghashkey) AS rankno\n\tFROM public.flightdetailhistory)\n\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"62938":{"id":62938,"sourceID":62937,"targetID":62936}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"62935":{"id":62935,"x":91,"y":144,"width":425,"height":117,"text":"Update the activeflag on the flightdetailhistory table\n\nwhen 2 instances of a flight are being updated at the same time, use the first created flight instance as the highest rank record. when the first instance is canceled use the second instance\n\nupdated:2019-11-19","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"OPS - FlightDetailsHistoryActiveFlagUpdate_Load (1)","description":"","type":"TRANSFORMATION"}}