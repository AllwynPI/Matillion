{"job":{"components":{"62962":{"id":62962,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":640,"y":224,"width":32,"height":32,"inputConnectorIDs":[62972],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Flight Event Update"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"description"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62963":{"id":62963,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":64,"y":144,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[62970],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Departure Delay Code1"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select A.eventname,A.description,A.eventdatetimeutc,A.carriercode, A.flightnumber, A.flightdate, A.departurestation, \nA.arrivalstation, A.leghashkey\nfrom\n(select * from \n(select 'DEPARTURE DELAY' eventname, 'delay code: '||departuredelaycode1||'; '||'delay time: '||departuredelaytime1||'; '  description,\neffectivedatetimeutc as eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by leghashkey,flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc asc) RANK_\nfrom public.flightdetailhistory where departuredelaycode1 > '' \n and leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimedepdelay}')\n) where rank_=1 ) as A\nleft outer join \n(SELECT leghashkey, MIN(effectivedatetimeutc) AS effectivedatetimeutc \nFROM public.flightdetailhistory\nWHERE iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimedepdelay}')\n\tGROUP BY leghashkey) B\non (A.leghashkey=B.leghashkey) \n\twhere --A.leghashkey in ('2019-09-04_POE 145_YTZ_EWR','2019-08-31_POE 468_YUL_YTZ_1225') and \n    A.eventdatetimeutc<isnull(B.effectivedatetimeutc,'9999-12-31')\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62964":{"id":62964,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":304,"y":224,"width":32,"height":32,"inputConnectorIDs":[62968,62970,62971],"outputConnectorIDs":[62969],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unite_all"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62965":{"id":62965,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":64,"y":224,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[62968],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Departure Delay Code2"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select B.eventname,B.description,B.eventdatetimeutc,B.carriercode, B.flightnumber, B.flightdate, B.departurestation, \nB.arrivalstation, B.leghashkey\nfrom\n(select * from \n(select 'DEPARTURE DELAY' eventname, 'delay code: '||departuredelaycode2||'; '||'delay time: '||departuredelaytime2||'; '  description,\neffectivedatetimeutc as eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by leghashkey,flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc asc) RANK_\nfrom public.flightdetailhistory where departuredelaycode2 > '' --and leghashkey='2019-01-01_POE 236_YOW_YTZ_1547'\n  and leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimedepdelay}')\n) where rank_=1 ) as B\nleft outer join \n(SELECT leghashkey, MIN(effectivedatetimeutc) AS effectivedatetimeutc \nFROM public.flightdetailhistory\nWHERE iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimedepdelay}')\n\tGROUP BY leghashkey) C\non (B.leghashkey=C.leghashkey) \n\twhere --A.leghashkey in ('2019-09-04_POE 145_YTZ_EWR','2019-08-31_POE 468_YUL_YTZ_1225') and \n    B.eventdatetimeutc<isnull(C.effectivedatetimeutc,'9999-12-31')"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62966":{"id":62966,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":64,"y":304,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[62971],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Departure Delay Code3"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select C.eventname,C.description,C.eventdatetimeutc,C.carriercode, C.flightnumber, C.flightdate, C.departurestation, \nC.arrivalstation, C.leghashkey\nfrom\n(select * from \n(select 'DEPARTURE DELAY' eventname, 'delay code: '||departuredelaycode3||'; '||'delay time: '||departuredelaytime3||'; '  description,\neffectivedatetimeutc as eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by leghashkey,flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc asc) RANK_\nfrom public.flightdetailhistory where departuredelaycode3 > '' --and leghashkey='2019-01-01_POE 236_YOW_YTZ_1547'\n  and leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimedepdelay}')\n) where rank_=1 ) as C\nleft outer join \n(SELECT leghashkey, MIN(effectivedatetimeutc) AS effectivedatetimeutc \nFROM public.flightdetailhistory\nWHERE  iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimedepdelay}')\n\tGROUP BY leghashkey) B\non (C.leghashkey=B.leghashkey) \n\twhere --A.leghashkey in ('2019-09-04_POE 145_YTZ_EWR','2019-08-31_POE 468_YUL_YTZ_1225') and \n    C.eventdatetimeutc<isnull(B.effectivedatetimeutc,'9999-12-31')\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62967":{"id":62967,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":464,"y":224,"width":32,"height":32,"inputConnectorIDs":[62969],"outputConnectorIDs":[62972],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select eventname,min(eventdatetimeutc) eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nsubstring(listagg(description,'|') within group (order by eventdatetimeutc asc),1,100) as Description\nfrom $T{Unite_all}\ngroup by eventname,--eventdatetimeutc,\ncarriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey\n\n/*select * from $T{Unite_all}*/"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"62968":{"id":62968,"sourceID":62965,"targetID":62964},"62969":{"id":62969,"sourceID":62964,"targetID":62967},"62970":{"id":62970,"sourceID":62963,"targetID":62964},"62971":{"id":62971,"sourceID":62966,"targetID":62964},"62972":{"id":62972,"sourceID":62967,"targetID":62962}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"62959":{"id":62959,"x":-339,"y":-53,"width":300,"height":89,"text":"This job captures all Departure delay event based on departure delay code 1, 2 and 3","colour":"e6e63c"},"62960":{"id":62960,"x":-118,"y":96,"width":359,"height":247,"text":"Accumulating all the departure delay codes from FlightDetailHistory table","colour":"e6e63c"},"62961":{"id":62961,"x":554,"y":152,"width":187,"height":149,"text":"Update FlightEventHistory table\n","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimedepdelay":{"definition":{"name":"lasttimedepdelay","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019-09-01"}},"grids":{}},"info":{"name":"OPS - FlightEventDepartureDelay_Load","description":"","type":"TRANSFORMATION"}}