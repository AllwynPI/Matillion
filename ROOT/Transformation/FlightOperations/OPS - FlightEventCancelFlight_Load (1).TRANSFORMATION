{"job":{"components":{"62990":{"id":62990,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":480,"y":224,"width":32,"height":32,"inputConnectorIDs":[62992],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public.flighteventhistory"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"description"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"62991":{"id":62991,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":96,"y":224,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[62992],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CancelFlight"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/***********************************************************************\n\tidenitfy new cancel events for a flight across all flight instances\n************************************************************************/\nSELECT 'CANCEL FLIGHT' eventname, iropcode,\n(case when isnull(departureoveralldelaytime,0)>0 then 'dep delay time:'||departureoveralldelaytime||';' else '' end)\n||\n(case when departureoveralldelaycode>'' then 'dep delay code:'||departureoveralldelaycode||';' else '' end)\n||\n(case when isnull(arrivaloveralldelaytime,0) > 0 then 'arr delay time:'||arrivaloveralldelaytime||';' else '' end)\n||\n(case when arrivaloveralldelaycode>'' then 'arr delay code:'||arrivaloveralldelaycode||';' else '' end)\n||\n(case when iropcode>'' then 'irop code:'||iropcode||';' else '' end) as description\n, effectivedatetimeutc eventdatetimeutc, carriercode,flightnumber, flightdate, departurestation, arrivalstation, leghashkey\nfrom\n\t(SELECT flightnumber,carriercode, flightdate, departurestation,arrivalstation, iropcode\n \t, leghashkey, effectivedatetimeutc AS effectivedatetimeutc,arrivaloveralldelaytime,departureoveralldelaytime,\n\tdepartureoveralldelaycode,arrivaloveralldelaycode,\n\trank() over (partition by flightnumber, flightdate, departurestation,arrivalstation order by effectivedatetimeutc, leghashkey ) as RANK_\n\tFROM public.flightdetailhistory\n\tWHERE iropcode like 'X%' \n\tand EXISTS (SELECT 1 FROM public.flightdetailhistory AS fdh \n            \tWHERE LEFT(fdh.leghashkey,26) =  LEFT(flightdetailhistory.leghashkey,26)\n                AND fdh.effectivedatetimeutc > '${lasttimecancel}'\n                --AND fdh.effectivedatetimeutc > '2017-12-01'\n               )     \n) where RANK_=1\n                            "}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"62992":{"id":62992,"sourceID":62991,"targetID":62990}},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"62987":{"id":62987,"x":-65,"y":-55,"width":513,"height":134,"text":"This jobs get all the Cancelled Flights from Public.FlightDetailHistory table and update the information into FlightEventHistory table.\n\nA cancel flight is a flight with an X iropcode\n\nA unique cancel flight event record is  flight number, flight date, departure station and arrival station\n\nupdated: 2019-11-27","colour":"e6e63c"},"62988":{"id":62988,"x":-68,"y":124,"width":321,"height":171,"text":"Identify the cancelled flight leghashkey and get the first time the flight was cancelled","colour":"e6e63c"},"62989":{"id":62989,"x":379,"y":126,"width":181,"height":162,"text":"Update/insert Cancelled Flight events into Flight Event History table","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimecancel":{"definition":{"name":"lasttimecancel","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2018-01-01"}},"grids":{}},"info":{"name":"OPS - FlightEventCancelFlight_Load (1)","description":"","type":"TRANSFORMATION"}}