{"job":{"components":{"47941":{"id":47941,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-64,"y":224,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[47946],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Arrival Events"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT distinct 'ARRIVAL' eventname, \n'Arrival at:'||intime||';' as description\n, effectivedatetimeutc eventdatetimeutc, carriercode,flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc asc) RANK_\nFROM public.flightdetailhistory AS fdh\nWHERE intime > '1900-01-01' \n--and leghashkey not in (select leghashkey from public.flightdetailhistory where isnull(arrivaloveralldelaytime,0)>0)\nand effectivedatetimeutc >= '1900-01-01'--'${lasttimearrival}'\nand departurestation <> arrivalstation\nand leghashkey not in (\n\tSELECT leghashkey\n\tFROM public.flightdetailhistory\n\tWHERE  iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\t\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrival}')\n\tGROUP BY leghashkey)\n\n\n/*SELECT 'ARRIVAL' eventname, \n(case when isnull(arrivaloveralldelaytime,0)>0 then 'dep delay time:'||departureoveralldelaytime||';' else '' end)\n||\n(case when isnull(arrivaloveralldelaytime,0)>0 then 'dep delay code:'||departureoveralldelaycode||';' else '' end)\n||\n(case when isnull(arrivaloveralldelaytime,0)>0 then 'arr delay time:'||arrivaloveralldelaytime||';' else '' end)\n||\n(case when arrivaloveralldelaycode>'' then 'arr delay code:'||arrivaloveralldelaycode||';' else '' end)\n||\n(case when iropcode>'' then 'irop code:'||iropcode||';' else '' end) as description\n, effectivedatetimeutc eventdatetimeutc, carriercode,flightnumber, flightdate, departurestation, arrivalstation, leghashkey\nFROM public.flightdetailhistory AS fdh\nWHERE EXISTS (SELECT 1 FROM (SELECT leghashkey, MIN(effectivedatetimeutc) AS effectivedatetimeutc FROM public.flightdetailhistory\n\t\t\t\t\t\t\tWHERE intime > '1900-01-01' and effectivedatetimeutc >= '${last_effectivedatetimeutc}'\n\t\t\t\t\t\t\tGROUP BY leghashkey) AS arr\n\t\t\t\tWHERE \tfdh.leghashkey = arr.leghashkey\n\t\t\t\tAND fdh.effectivedatetimeutc = arr.effectivedatetimeutc)\nORDER BY leghashkey, effectivedatetimeutc\n*/"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"47942":{"id":47942,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":544,"y":224,"width":32,"height":32,"inputConnectorIDs":[47945],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Flight Event Update"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"description"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"47943":{"id":47943,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":176,"y":224,"width":32,"height":32,"inputConnectorIDs":[47946],"outputConnectorIDs":[47947],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unite_all"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"47944":{"id":47944,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":352,"y":224,"width":32,"height":32,"inputConnectorIDs":[47947],"outputConnectorIDs":[47945],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select * from $T{Unite_all} where RANK_=1"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"47945":{"id":47945,"sourceID":47944,"targetID":47942},"47946":{"id":47946,"sourceID":47941,"targetID":47943},"47947":{"id":47947,"sourceID":47943,"targetID":47944}},"canUndo":true,"undoCommand":"Rename Job","undoCreated":1575313219765,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"47938":{"id":47938,"x":-194,"y":19,"width":356,"height":60,"text":"This Job calculate Flight Arrival Event from Flight Detail History table","colour":"e6e63c"},"47939":{"id":47939,"x":-196,"y":131,"width":210,"height":178,"text":"Calculating Flight Arrival Events","colour":"e6e63c"},"47940":{"id":47940,"x":471,"y":149,"width":192,"height":144,"text":"Update FlightEventHistory table","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimearrival":{"definition":{"name":"lasttimearrival","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019-01-01"}},"grids":{}},"info":{"name":"20191212_OPS - FlightEventArrival_Load","description":"","type":"TRANSFORMATION"}}