{"job":{"components":{"48016":{"id":48016,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":256,"y":208,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48019],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"STG"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select distinct B.effectivedatetimeutc, B.expireddatetimeutc, B.Leghashkey,B.carriercode, B.flightdate, B.flightnumber, B.departurestation, B.arrivalstation,  B.uncorrectedtailnumber,B.outtime, B.offtime, \nB.ontime, B.intime,iropcode,\nrank() over(partition by B.carriercode, B.flightdate, B.flightnumber, B.departurestation order by B.effectivedatetimeutc asc) as RANK_\nfrom public.flightdetailhistory B\ninner join\n(select * from \n\t(select carriercode, flightdate, flightnumber, departurestation, count(distinct arrivalstation) cnt\n\tfrom public.flightdetailhistory where departurestation <> arrivalstation\n\tgroup by carriercode, flightdate, flightnumber, departurestation\n\thaving count(distinct arrivalstation) >1) A) C\non (B.carriercode=C.carriercode AND B.flightdate=C.flightdate and B.flightnumber=C.flightnumber and B.departurestation=C.departurestation) \n--where lasttimediversion\nwhere leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimediversion}')"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48017":{"id":48017,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":432,"y":208,"width":32,"height":32,"inputConnectorIDs":[48019],"outputConnectorIDs":[48020],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"transform"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select 'DIVERSION' eventname, '' eventdescription, effectivedatetimeutc eventdatetimeutc, carriercode, flightnumber, flightdate, departurestation, \nsubstring(Leghashkey,24,3) arrivalstation, leghashkey, getdate() createdttm\nfrom \n(select D.*,\nrank() over(partition by carriercode, flightdate, flightnumber, departurestation order by effectivedatetimeutc asc) as RANK__\nfrom $T{STG} D where leghashkey not in (select distinct leghashkey from $T{STG} where iropcode like 'X%')) as E\nwhere RANK__=1"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48018":{"id":48018,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":624,"y":208,"width":32,"height":32,"inputConnectorIDs":[48020],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdescription"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"createdttm"},"2":{"slot":2,"type":"STRING","value":"createdttm"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Delete/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"48019":{"id":48019,"sourceID":48016,"targetID":48017},"48020":{"id":48020,"sourceID":48017,"targetID":48018}},"canUndo":true,"undoCommand":"Rename Job","undoCreated":1574734555099,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"48013":{"id":48013,"x":151,"y":-9,"width":480,"height":75,"text":"This Job identifies the flights which has been diverted from original destination to a new one","colour":"e6e63c"},"48014":{"id":48014,"x":161,"y":147,"width":182,"height":141,"text":"Extracting records\n","colour":"e6e63c"},"48015":{"id":48015,"x":550,"y":141,"width":179,"height":150,"text":"Update/Insert records","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimediversion":{"definition":{"name":"lasttimediversion","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2018-01-01"}},"grids":{}},"info":{"name":"20191212_OPS - FlightDiversion_Load","description":"","type":"TRANSFORMATION"}}