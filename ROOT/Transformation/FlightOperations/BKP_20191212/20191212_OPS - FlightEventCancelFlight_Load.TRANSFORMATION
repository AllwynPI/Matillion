{"job":{"components":{"48009":{"id":48009,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":592,"y":224,"width":32,"height":32,"inputConnectorIDs":[48011],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Flight Event Update"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"description"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48010":{"id":48010,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":96,"y":224,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48011],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CancelFlight"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT 'CANCEL FLIGHT' eventname, iropcode,\n(case when isnull(departureoveralldelaytime,0)>0 then 'dep delay time:'||departureoveralldelaytime||';' else '' end)\n||\n(case when departureoveralldelaycode>'' then 'dep delay code:'||departureoveralldelaycode||';' else '' end)\n||\n(case when isnull(arrivaloveralldelaytime,0)>0 then 'arr delay time:'||arrivaloveralldelaytime||';' else '' end)\n||\n(case when arrivaloveralldelaycode>'' then 'arr delay code:'||arrivaloveralldelaycode||';' else '' end)\n||\n(case when iropcode>'' then 'irop code:'||iropcode||';' else '' end) as description\n, effectivedatetimeutc eventdatetimeutc, carriercode,flightnumber, flightdate, departurestation, arrivalstation, leghashkey\nfrom\n(SELECT flightnumber,carriercode, flightdate, departurestation,arrivalstation, iropcode, leghashkey, effectivedatetimeutc AS effectivedatetimeutc,arrivaloveralldelaytime,departureoveralldelaytime,\ndepartureoveralldelaycode,arrivaloveralldelaycode,\nrank() over (partition by flightnumber, flightdate, departurestation,arrivalstation order by effectivedatetimeutc asc ) as RANK_\nFROM public.flightdetailhistory\n\t\t\t\t\t\t\tWHERE iropcode like 'X%' --and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n                            --activeflag=1 \n \t\t\t\t\t\t\tand leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimecancel}')\n\t\t\t\t\t\t\t) where RANK_=1\n                            \n\n/*\nSELECT leghashkey, iropcode, MIN(effectivedatetimeutc) AS effectivedatetimeutc FROM public.flightdetailhistory\n\t\t\t\t\t\t\tWHERE iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n                            activeflag=1 and\n                            leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimecancel}')\n\t\t\t\t\t\t\tGROUP BY leghashkey,iropcode */"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"48011":{"id":48011,"sourceID":48010,"targetID":48009}},"canUndo":true,"undoCommand":"Rename Job","undoCreated":1575313255192,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"48006":{"id":48006,"x":-101,"y":-53,"width":493,"height":103,"text":"This jobs get all the Cancelled Flights from Public.FlightDetailHistory table and update the information into FlightEventHistory table.\n\nA unique cancel flight event record is  flight number, flight date, departure station and arrival station\n\nupdated: 2019-10-02","colour":"e6e63c"},"48007":{"id":48007,"x":-101,"y":89,"width":354,"height":238,"text":"Identify the cancelled flight leghashkey and get the first time the flight was cancelled","colour":"e6e63c"},"48008":{"id":48008,"x":515,"y":100,"width":141,"height":255,"text":"Update/insert Cancelled Flight events into Flight Event History table","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimecancel":{"definition":{"name":"lasttimecancel","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019-01-01"}},"grids":{}},"info":{"name":"20191212_OPS - FlightEventCancelFlight_Load","description":"","type":"TRANSFORMATION"}}