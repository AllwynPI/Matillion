{"job":{"components":{"48022":{"id":48022,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":224,"y":288,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48036],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETA Event"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select eventname, eventdescription, eventdatetimeutc, carriercode, flightnumber, flightdate, departurestation, arrivalstation\nfrom\n(select\n'ETA' as eventname --\n, (case when arrivaloveralldelaycode >'' then 'delay code: '||arrivaloveralldelaycode||'; '||'delay time: '||arrivaloveralldelaytime||'; '\n\t\twhen arrivaloveralldelaytime >0 then 'delay code: '||arrivaloveralldelaycode||'; '||'delay time: '||arrivaloveralldelaytime||'; '\n\t\telse '' end) eventdescription\n, effectivedatetimeutc eventdatetimeutc \n, carriercode\n, flightnumber\n, flightdate\n, departurestation\n, arrivalstation\n, leghashkey\n, sta\n, eta\n, ( case when rank() over (partition by flightnumber, flightdate, departurestation, arrivalstation,leghashkey order by effectivedatetimeutc) =1 then eta\n\t\telse LAG(eta,1) ignore nulls over(partition by flightnumber, flightdate, departurestation, arrivalstation,leghashkey order by effectivedatetimeutc) end) last_ETA\n--, departureoveralldelaycode, datediff(minutes, sta, eta) deriveddelaytime,\n--datediff(minutes, stautc, etautc) deriveddelaytimeutc\nfrom public.flightdetailhistory \nwhere eta >'1900-01-01' --OR etd > '1900-01-01'\n--and iropcode not like 'IR%' --and flightnumber=938 and flightdate='2019-07-12 00:00:00' and departurestation='BOS'\n--and leghashkey in (select leghashkey from public.flightdetailhistory where iropcode like 'IR%')\nand flightdetailhistoryid not in (select flightdetailhistoryid from public.flightdetailhistory where iropcode like 'IR%')\nand leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc >'1900-01-01')) ETD_EVENT\nwhere Eta<>last_ETa\n--and flightnumber=938 and flightdate='2019-07-12' and  departurestation='BOS' and arrivalstation='YTZ'\ngroup by eventname, eventdescription, eventdatetimeutc, carriercode, flightnumber, flightdate, departurestation, arrivalstation"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48023":{"id":48023,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":224,"y":112,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48038],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETD Event"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select eventname, eventdescription, eventdatetimeutc, carriercode, flightnumber, flightdate, departurestation, arrivalstation\nfrom\n(select\n'ETD' as eventname --\n, (case when departureoveralldelaycode >'' then 'delay code: '||departureoveralldelaycode||'; '||'delay time: '||departureoveralldelaytime||'; '\n\t\twhen departureoveralldelaytime >0 then 'delay code: '||departureoveralldelaycode||'; '||'delay time: '||departureoveralldelaytime||'; '\n\t\telse '' end) eventdescription\n, effectivedatetimeutc eventdatetimeutc \n, carriercode\n, flightnumber\n, flightdate\n, departurestation\n, arrivalstation\n, leghashkey\n, std\n, etd\n, ( case when rank() over (partition by flightnumber, flightdate, departurestation, arrivalstation,leghashkey order by effectivedatetimeutc) =1 then etd\n\t\telse LAG(etd,1) ignore nulls over(partition by flightnumber, flightdate, departurestation, arrivalstation,leghashkey order by effectivedatetimeutc) end) last_ETD\n--, departureoveralldelaycode, datediff(minutes, sta, eta) deriveddelaytime,\n--datediff(minutes, stautc, etautc) deriveddelaytimeutc\nfrom public.flightdetailhistory \nwhere etd >'1900-01-01' --OR etd > '1900-01-01'\n--and iropcode not like 'IR%' --and flightnumber=938 and flightdate='2019-07-12 00:00:00' and departurestation='BOS'\n--and leghashkey in (select leghashkey from public.flightdetailhistory where iropcode like 'IR%')\nand flightdetailhistoryid not in (select flightdetailhistoryid from public.flightdetailhistory where iropcode like 'IR%')\nand leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc >'1900-01-01')) ETD_EVENT\nwhere Etd<>last_ETD \n--and flightnumber=938 and flightdate='2019-07-12' and  departurestation='BOS' and arrivalstation='YTZ'\ngroup by eventname, eventdescription, eventdatetimeutc, carriercode, flightnumber, flightdate, departurestation, arrivalstation"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48024":{"id":48024,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":864,"y":208,"width":32,"height":32,"inputConnectorIDs":[48034,48043,48046],"outputConnectorIDs":[48040],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"union all events"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48025":{"id":48025,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":1248,"y":208,"width":32,"height":32,"inputConnectorIDs":[48035],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdescription"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghaskey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48026":{"id":48026,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":928,"y":352,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48044],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CancelFlight"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select distinct flightnumber, \n\t\t\t\tflightdate,\n                departurestation,\n                arrivalstation, \n                min(effectivedatetimeutc) canceldatetime \n                \tFROM public.flightdetailhistory \n\t\t\t\tWHERE iropcode like 'X%'\n                --and leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttineetaetdevent}')\n\t\t\t\tgroup by flightnumber, flightdate, departurestation, arrivalstation"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48027":{"id":48027,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":1040,"y":208,"width":32,"height":32,"inputConnectorIDs":[48040,48044],"outputConnectorIDs":[48035],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 4"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select distinct eventname,\n\t  listagg(eventdescription,';') within group (order by eventdatetimeutc) as eventdescription,\n      a.eventdatetimeutc, \n      a.flightnumber,\n      a.flightdate,\n      a.departurestation, \n      a.arrivalstation,\n      a.carriercode,\n      '' as leghaskey\nfrom $T{union all events} a\ngroup by eventname,\n         a.eventdatetimeutc,\n         a.flightnumber,\n         a.flightdate,\n         a.departurestation,\n         a.arrivalstation,\n         a.carriercode\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48028":{"id":48028,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":624,"y":112,"width":32,"height":32,"inputConnectorIDs":[48033,48037],"outputConnectorIDs":[48046],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETD/ETA"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select 'ETD/ETA' as eventname, etd.eventdescription||';'||eta.eventdescription as eventdescription, \netd.eventdatetimeutc, \netd.carriercode, \netd.flightnumber, \netd.flightdate,\netd.departurestation, \netd.arrivalstation\nfrom $T{Replicate ETD} as etd\n\tinner join\n\t$T{Replicate ETA} as eta \n\ton (etd.eventdatetimeutc = eta.eventdatetimeutc and\n    \tetd.flightnumber = eta.flightnumber and \n    \tetd.flightdate = eta.flightdate and \n    \tetd.departurestation = eta.departurestation and \n        etd.arrivalstation = eta.arrivalstation)"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48029":{"id":48029,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":624,"y":208,"width":32,"height":32,"inputConnectorIDs":[48042,48045],"outputConnectorIDs":[48034],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETD"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select eventname, \n\t   eventdescription,\n       eventdatetimeutc,\n       carriercode,\n       flightnumber,\n       flightdate,\n       departurestation,\n       arrivalstation\n       --,eta_departurestation\n       from\n          (select 'ETD' as eventname,\n                \t\t   etd.eventdescription,\n                           etd.eventdatetimeutc,\n                           etd.carriercode,\n                           etd.flightnumber,\n                           etd.flightdate,\n                           etd.departurestation,\n                           etd.arrivalstation,\n                           eta.departurestation eta_departurestation\n                            from $T{Replicate ETD} as etd\n                           left outer join\n                                 $T{Replicate ETA} as eta \n                                 on ( etd.eventdatetimeutc = eta.eventdatetimeutc and\n                                      etd.flightnumber = eta.flightnumber and\n                                      etd.flightdate = eta.flightdate and  \n                                      etd.departurestation = eta.departurestation and \n                                      etd.arrivalstation = eta.arrivalstation ) )\n                        where isnull(eta_departurestation,'N/A') = 'N/A'  --and eventdatetimeutc >'2019-10-01'\n                         \n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48030":{"id":48030,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":624,"y":288,"width":32,"height":32,"inputConnectorIDs":[48039,48041],"outputConnectorIDs":[48043],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ETA"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select eventname, eventdescription, eventdatetimeutc, carriercode, flightnumber, flightdate, departurestation, arrivalstation\n--,etd_departurestation \nfrom\n\t(select 'ETA' as eventname,\n     eta.eventdescription,\n     eta.eventdatetimeutc,\n     eta.carriercode,\n     eta.flightnumber, \n     eta.flightdate,\n     eta.departurestation, \n     eta.arrivalstation,\n \t etd.departurestation etd_departurestation\n     from $T{Replicate ETD} as etd\n      right outer join\n      $T{Replicate ETA} as eta \n      \ton (etd.eventdatetimeutc = eta.eventdatetimeutc and \n            etd.flightnumber = eta.flightnumber and\n            etd.flightdate = eta.flightdate and \n            etd.departurestation = eta.departurestation and \n            etd.arrivalstation = eta.arrivalstation ) )\n\twhere isnull(etd_departurestation,'N/A') = 'N/A'  -- and eventdatetimeutc >'2019-11-01'\n    \n    "}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48031":{"id":48031,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1949249710,"x":352,"y":112,"width":32,"height":32,"inputConnectorIDs":[48038],"outputConnectorIDs":[48033,48039,48042],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Replicate ETD"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48032":{"id":48032,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1949249710,"x":336,"y":288,"width":32,"height":32,"inputConnectorIDs":[48036],"outputConnectorIDs":[48037,48041,48045],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Replicate ETA"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"48033":{"id":48033,"sourceID":48031,"targetID":48028},"48034":{"id":48034,"sourceID":48029,"targetID":48024},"48035":{"id":48035,"sourceID":48027,"targetID":48025},"48036":{"id":48036,"sourceID":48022,"targetID":48032},"48037":{"id":48037,"sourceID":48032,"targetID":48028},"48038":{"id":48038,"sourceID":48023,"targetID":48031},"48039":{"id":48039,"sourceID":48031,"targetID":48030},"48040":{"id":48040,"sourceID":48024,"targetID":48027},"48041":{"id":48041,"sourceID":48032,"targetID":48030},"48042":{"id":48042,"sourceID":48031,"targetID":48029},"48043":{"id":48043,"sourceID":48030,"targetID":48024},"48044":{"id":48044,"sourceID":48026,"targetID":48027},"48045":{"id":48045,"sourceID":48032,"targetID":48029},"48046":{"id":48046,"sourceID":48028,"targetID":48024}},"canUndo":true,"undoCommand":"Rename Job","undoCreated":1574733805831,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{},"noteConnectors":{},"variables":{"lasttineetaetdevent":{"definition":{"name":"lasttineetaetdevent","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019-01-01"}},"grids":{}},"info":{"name":"20191212_OPS - FlightEventHistory New ETA ETD Event Load","description":"","type":"TRANSFORMATION"}}