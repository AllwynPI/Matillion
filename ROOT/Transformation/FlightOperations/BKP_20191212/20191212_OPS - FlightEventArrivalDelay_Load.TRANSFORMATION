{"job":{"components":{"47996":{"id":47996,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":720,"y":224,"width":32,"height":32,"inputConnectorIDs":[48001],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Flight Event Update"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"flighteventhistory"}}}},"visible":true},"3":{"slot":3,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"},"2":{"slot":2,"type":"STRING","value":"eventname"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"description"},"2":{"slot":2,"type":"STRING","value":"eventdescription"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"eventdatetimeutc"},"2":{"slot":2,"type":"STRING","value":"eventdatetimeutc"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"carriercode"},"2":{"slot":2,"type":"STRING","value":"carriercode"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"},"2":{"slot":2,"type":"STRING","value":"flightnumber"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"},"2":{"slot":2,"type":"STRING","value":"flightdate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"},"2":{"slot":2,"type":"STRING","value":"departurestation"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"arrivalstation"},"2":{"slot":2,"type":"STRING","value":"arrivalstation"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"},"2":{"slot":2,"type":"STRING","value":"leghashkey"}}}},"visible":true},"5":{"slot":5,"name":"Unique Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"leghashkey"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"flightdate"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"flightnumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"eventname"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"departurestation"}}}},"visible":true},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"public"}}}},"visible":true},"7":{"slot":7,"name":"Update Strategy","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Update/Insert"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"47997":{"id":47997,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":320,"y":224,"width":32,"height":32,"inputConnectorIDs":[48002,48003],"outputConnectorIDs":[48004],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Unite_all"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"47998":{"id":47998,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":80,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48002],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Arrival Delay Code 1"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select A.eventname,A.description,A.eventdatetimeutc,A.carriercode, A.flightnumber, A.flightdate, A.departurestation, \nA.arrivalstation, A.leghashkey\nfrom\n(select * from \n(select 'ARRIVAL DELAY' eventname, 'delay code: '||arrivaldelaycode1||'; '||'delay time: '||arrivaldelaytime1||'; '  description,\neffectivedatetimeutc as eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by leghashkey,flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc asc) RANK_\nfrom public.flightdetailhistory where arrivaldelaycode1 > '' --and leghashkey='2019-01-01_POE 236_YOW_YTZ_1547'\n  and leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrdelay}')\n) where rank_=1 ) as A\nleft outer join \n(SELECT leghashkey, MIN(effectivedatetimeutc) AS effectivedatetimeutc \nFROM public.flightdetailhistory\nWHERE  iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrdelay}')\n\tGROUP BY leghashkey) B\non (A.leghashkey=B.leghashkey) \n\twhere --A.leghashkey in ('2019-09-04_POE 145_YTZ_EWR','2019-08-31_POE 468_YUL_YTZ_1225') and \n    A.eventdatetimeutc<isnull(B.effectivedatetimeutc,'9999-12-31')\n\n/*where leghashkey not in (\n\tSELECT leghashkey\n\tFROM public.flightdetailhistory\n\tWHERE uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\t\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrdelay}')\n\tGROUP BY leghashkey)*/"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"47999":{"id":47999,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":80,"y":288,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[48003],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Arrival Delay Code 2"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select A.eventname,A.description,A.eventdatetimeutc,A.carriercode, A.flightnumber, A.flightdate, A.departurestation, \nA.arrivalstation, A.leghashkey\nfrom\n(select * from \n(select 'ARRIVAL DELAY' eventname, 'delay code: '||arrivaldelaycode2||'; '||'delay time: '||arrivaldelaytime2||'; '  description,\neffectivedatetimeutc as eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nrank() over (partition by leghashkey,flightnumber, flightdate, departurestation, arrivalstation order by effectivedatetimeutc asc) RANK_\nfrom public.flightdetailhistory where arrivaldelaycode2 > '' --and leghashkey='2019-01-01_POE 236_YOW_YTZ_1547'\n   and leghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrdelay}')\n) where rank_=1 ) as A\nleft outer join \n(SELECT leghashkey, MIN(effectivedatetimeutc) AS effectivedatetimeutc \nFROM public.flightdetailhistory\nWHERE  iropcode like 'X%' and ----uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrdelay}')\n\tGROUP BY leghashkey) B\non (A.leghashkey=B.leghashkey) \n\twhere --A.leghashkey in ('2019-09-04_POE 145_YTZ_EWR','2019-08-31_POE 468_YUL_YTZ_1225') and \n    A.eventdatetimeutc<isnull(B.effectivedatetimeutc,'9999-12-31')\n\n\n/*where leghashkey not in (\n\tSELECT leghashkey\n\tFROM public.flightdetailhistory\n\tWHERE uncorrectedtailnumber like '-Y%' and --effectivedatetimeutc >='${lasttimecancel}'\n\t\tleghashkey in (select leghashkey from public.flightdetailhistory where effectivedatetimeutc > '${lasttimearrdelay}')\n\tGROUP BY leghashkey) */"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"48000":{"id":48000,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":512,"y":224,"width":32,"height":32,"inputConnectorIDs":[48004],"outputConnectorIDs":[48001],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select eventname,min(eventdatetimeutc) eventdatetimeutc,carriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey,\nsubstring(listagg(description,'|') within group (order by eventdatetimeutc asc),1,100) as Description\nfrom $T{Unite_all}\ngroup by eventname,--eventdatetimeutc,\ncarriercode, flightnumber, flightdate, departurestation, arrivalstation, leghashkey"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"48001":{"id":48001,"sourceID":48000,"targetID":47996},"48002":{"id":48002,"sourceID":47998,"targetID":47997},"48003":{"id":48003,"sourceID":47999,"targetID":47997},"48004":{"id":48004,"sourceID":47997,"targetID":48000}},"canUndo":true,"undoCommand":"Rename Job","undoCreated":1574733768066,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"47993":{"id":47993,"x":-48,"y":104,"width":275,"height":244,"text":"Accumulating all the ARRIVAL delay codes from FlightDetailHistory table","colour":"e6e63c"},"47994":{"id":47994,"x":-274,"y":-8,"width":517,"height":74,"text":"This job captures all Arrival delay event based on departure delay code 1, 2 and 3","colour":"e6e63c"},"47995":{"id":47995,"x":615,"y":149,"width":212,"height":153,"text":"Update/Insert FlightEventHistory table","colour":"e6e63c"}},"noteConnectors":{},"variables":{"lasttimearrdelay":{"definition":{"name":"lasttimearrdelay","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"2019-07-01"}},"grids":{}},"info":{"name":"20191212_OPS - FlightEventArrivalDelay_Load","description":"","type":"TRANSFORMATION"}}