{"job":{"components":{"15789":{"id":15789,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1776,"y":-192,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[32521],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15790":{"id":15790,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1504,"y":-112,"width":32,"height":32,"inputConnectorIDs":[32525],"outputSuccessConnectorIDs":[15811],"outputFailureConnectorIDs":[15823],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Component","mapTo":"ErrorComponent"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Check Welcome"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"################################################################################\n#\n# check elmah\n#\n################################################################################\n\n#assign the name of the check to the environment variable\ncheckname = \"PET Viporter Welcome data check\"\n\n\ncursor = context.cursor()\n\nsql = \"SELECT name, issuetype, responsystablename, recordcount, firsterrordatetime, lasterrordatetime FROM etl.pegasuselmahlogs\"\nsql = sql  + \" WHERE responsystablename in ('PET_VIPorter_WelcomeNotification') \"\n\n#execute sql query\ncursor.execute(sql)\nrow = cursor.fetchone()\n\nappname = \"app\"\ntablename = \"table\"\nerrortype = \"description\"\nunloadedrecordcount = 0\nfirstunloaded = '2019-07-01'\nfirstunloadedstring = \"string\"\nlastunloaded = '2019-07-01'\nlastunloadedstring = \"string\"\n\n\n#assign variables\nif row:\n  if row[3] > 0:\n    appname = row[0]\n    errortype = row[1]\n    tablename = row[2]\n    unloadedrecordcount = row[3]\n    firstunloaded = row[4]\n    firstunloadedstring = str(firstunloaded)\n    lastunloaded = row[5]\n    lastunloadedstring = str(lastunloaded)\n\n# python subscring function --- string[start:end]: Get all characters from index start to end-1\n  \n#print \"appname: \" + str(appname)\n#print \"tablename: \" + str(tablename)\n#print \"errortype: \" + str(errortype)\n#print \"unloadedrecordcount: \" + str(unloadedrecordcount)\n#print \"firstunloaded: \" + (firstunloadedstring[0:19])\n#print \"lastunloaded: \" + (lastunloadedstring[0:19])\n\n\nif unloadedrecordcount > 0:\n  message = \"There are \" + str(unloadedrecordcount) + \" Viporter Welcome records not loaded in the last 24 hours. \\n\" \n  message = message + \"The date and time of the last record that failed to load is : \" + (lastunloadedstring[0:19]) + \" \\n\"\n  message = message + \"Please review the elmah logs for application \" + str(appname) + \", process \" + str(tablename) + \" \\n\"\n\n  \n  \n  context.updateVariable(\"Errormessage\", message)\n  print message\n  raise Exception    \n  \n  \n  \n  \n  "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15791":{"id":15791,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-1504,"y":-240,"width":32,"height":32,"inputConnectorIDs":[15823],"outputSuccessConnectorIDs":[15806],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 0"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning - ${job_name}"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning:\n${Errormessage}\n\n-------------------------------------------\nJob: ${job_name}\nComponent: ${ErrorComponent}\nEnvironment: ${environment_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15792":{"id":15792,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-1424,"y":-176,"width":32,"height":32,"inputConnectorIDs":[15811,15806],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[15817],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15793":{"id":15793,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1312,"y":-112,"width":32,"height":32,"inputConnectorIDs":[15817],"outputSuccessConnectorIDs":[15812],"outputFailureConnectorIDs":[15826],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Component","mapTo":"ErrorComponent"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Check StaffTravel"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"################################################################################\n#\n# check elmah\n#\n################################################################################\n\n#assign the name of the check to the environment variable\ncheckname = \"PET staff travel data check\"\n\n\ncursor = context.cursor()\n\nsql = \"SELECT name, issuetype, responsystablename, recordcount, firsterrordatetime, lasterrordatetime FROM etl.pegasuselmahlogs\"\nsql = sql  + \" WHERE responsystablename in ('PET_Staff_Travel') \"\n\n#execute sql query\ncursor.execute(sql)\nrow = cursor.fetchone()\n\nappname = \"app\"\ntablename = \"table\"\nerrortype = \"description\"\nunloadedrecordcount = 0\nfirstunloaded = '2019-07-01'\nfirstunloadedstring = \"string\"\nlastunloaded = '2019-07-01'\nlastunloadedstring = \"string\"\n\n\n#assign variables\nif row:\n  if row[3] > 0:\n    appname = row[0]\n    errortype = row[1]\n    tablename = row[2]\n    unloadedrecordcount = row[3]\n    firstunloaded = row[4]\n    firstunloadedstring = str(firstunloaded)\n    lastunloaded = row[5]\n    lastunloadedstring = str(lastunloaded)\n\n# python subscring function --- string[start:end]: Get all characters from index start to end-1\n  \n#print \"appname: \" + str(appname)\n#print \"tablename: \" + str(tablename)\n#print \"errortype: \" + str(errortype)\n#print \"unloadedrecordcount: \" + str(unloadedrecordcount)\n#print \"firstunloaded: \" + (firstunloadedstring[0:19])\n#print \"lastunloaded: \" + (lastunloadedstring[0:19])\n\nif unloadedrecordcount > 0:\n  message = \"There are \" + str(unloadedrecordcount) + \" Staff Travel records not loaded in the last 24 hours. \\n\" \n  message = message + \"The date and time of the last record that failed to load is : \" + (lastunloadedstring[0:19]) + \" \\n\"\n  message = message + \"Please review the elmah logs for application \" + str(appname) + \", process \" + str(tablename) + \" \\n\"\n\n  context.updateVariable(\"Errormessage\", message)\n  print message\n  raise Exception    \n  \n  \n  \n  "}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15794":{"id":15794,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-1312,"y":-240,"width":32,"height":32,"inputConnectorIDs":[15826],"outputSuccessConnectorIDs":[15807],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 1"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning - ${job_name}"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning:\n${Errormessage}\n\n-------------------------------------------\nJob: ${job_name}\nComponent: ${ErrorComponent}\nEnvironment: ${environment_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15795":{"id":15795,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-1216,"y":-176,"width":32,"height":32,"inputConnectorIDs":[15812,15807],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[15821],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15796":{"id":15796,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1120,"y":-112,"width":32,"height":32,"inputConnectorIDs":[15821],"outputSuccessConnectorIDs":[15815],"outputFailureConnectorIDs":[15825],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Component","mapTo":"ErrorComponent"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Check SpecialOffers"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"################################################################################\n#\n# check elmah\n#\n################################################################################\n\n#assign the name of the check to the environment variable\ncheckname = \"PET non member special offer data check\"\n\n\ncursor = context.cursor()\n\nsql = \"SELECT name, issuetype, responsystablename, recordcount, firsterrordatetime, lasterrordatetime FROM etl.pegasuselmahlogs\"\nsql = sql  + \" WHERE responsystablename in ('PET_NonMember_SpecialOfferCampaignPreference') \"\n\n#execute sql query\ncursor.execute(sql)\nrow = cursor.fetchone()\n\nappname = \"app\"\ntablename = \"table\"\nerrortype = \"description\"\nunloadedrecordcount = 0\nfirstunloaded = '2019-07-01'\nfirstunloadedstring = \"string\"\nlastunloaded = '2019-07-01'\nlastunloadedstring = \"string\"\n\n\n#assign variables\nif row:\n  if row[3] > 0:\n    appname = row[0]\n    errortype = row[1]\n    tablename = row[2]\n    unloadedrecordcount = row[3]\n    firstunloaded = row[4]\n    firstunloadedstring = str(firstunloaded)\n    lastunloaded = row[5]\n    lastunloadedstring = str(lastunloaded)\n\n# python subscring function --- string[start:end]: Get all characters from index start to end-1\n  \n#print \"appname: \" + str(appname)\n#print \"tablename: \" + str(tablename)\n#print \"errortype: \" + str(errortype)\n#print \"unloadedrecordcount: \" + str(unloadedrecordcount)\n#print \"firstunloaded: \" + (firstunloadedstring[0:19])\n#print \"lastunloaded: \" + (lastunloadedstring[0:19])\n\n\nif unloadedrecordcount > 0:\n  message = \"There are \" + str(unloadedrecordcount) + \" non-member special offers records not loaded in the last 24 hours. \\n\" \n  message = message + \"The date and time of the last record that failed to load is : \" + (lastunloadedstring[0:19]) + \" \\n\"\n  message = message + \"Please review the elmah logs for application \" + str(appname) + \", process \" + str(tablename) + \" \\n\"\n  \n  context.updateVariable(\"Errormessage\", message)\n  print message\n  raise Exception    \n  \n  \n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15797":{"id":15797,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-1120,"y":-240,"width":32,"height":32,"inputConnectorIDs":[15825],"outputSuccessConnectorIDs":[15810],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 2"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning - ${job_name}"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning:\n${Errormessage}\n\n-------------------------------------------\nJob: ${job_name}\nComponent: ${ErrorComponent}\nEnvironment: ${environment_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15798":{"id":15798,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-1024,"y":-176,"width":32,"height":32,"inputConnectorIDs":[15810,15815],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[15820],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 2"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15799":{"id":15799,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-912,"y":-240,"width":32,"height":32,"inputConnectorIDs":[15824],"outputSuccessConnectorIDs":[15814],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 3"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning - ${job_name}"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning:\n${Errormessage}\n\n-------------------------------------------\nJob: ${job_name}\nComponent: ${ErrorComponent}\nEnvironment: ${environment_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15800":{"id":15800,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-912,"y":-112,"width":32,"height":32,"inputConnectorIDs":[15820],"outputSuccessConnectorIDs":[15813],"outputFailureConnectorIDs":[15824],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Component","mapTo":"ErrorComponent"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Check VIPorterSale"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"################################################################################\n#\n# check elmah\n#\n################################################################################\n\n#assign the name of the check to the environment variable\ncheckname = \"PET VIPorter marketing sale data check\"\n\n\ncursor = context.cursor()\n\nsql = \"SELECT name, issuetype, responsystablename, recordcount, firsterrordatetime, lasterrordatetime FROM etl.pegasuselmahlogs\"\nsql = sql  + \" WHERE responsystablename in ('PET_VIPorter_MarketingSaleCampaignPreference') \"\n\n#execute sql query\ncursor.execute(sql)\nrow = cursor.fetchone()\n\nappname = \"app\"\ntablename = \"table\"\nerrortype = \"description\"\nunloadedrecordcount = 0\nfirstunloaded = '2019-07-01'\nfirstunloadedstring = \"string\"\nlastunloaded = '2019-07-01'\nlastunloadedstring = \"string\"\n\n\n#assign variables\nif row:\n  if row[3] > 0:\n    appname = row[0]\n    errortype = row[1]\n    tablename = row[2]\n    unloadedrecordcount = row[3]\n    firstunloaded = row[4]\n    firstunloadedstring = str(firstunloaded)\n    lastunloaded = row[5]\n    lastunloadedstring = str(lastunloaded)\n\n# python subscring function --- string[start:end]: Get all characters from index start to end-1\n  \n#print \"appname: \" + str(appname)\n#print \"tablename: \" + str(tablename)\n#print \"errortype: \" + str(errortype)\n#print \"unloadedrecordcount: \" + str(unloadedrecordcount)\n#print \"firstunloaded: \" + (firstunloadedstring[0:19])\n#print \"lastunloaded: \" + (lastunloadedstring[0:19])\n\n\nif unloadedrecordcount > 0:\n  message = \"There are \" + str(unloadedrecordcount) + \" viporter sales records not loaded in the last 24 hours. \\n\" \n  message = message + \"The date and time of the last record that failed to load is : \" + (lastunloadedstring[0:19]) + \" \\n\"\n  message = message + \"Please review the elmah logs for application \" + str(appname) + \", process \" + str(tablename) + \" \\n\"\n  \n  context.updateVariable(\"Errormessage\", message)\n  print message\n  raise Exception    \n  \n  \n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15801":{"id":15801,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-832,"y":-176,"width":32,"height":32,"inputConnectorIDs":[15813,15814],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[15819],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 3"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15802":{"id":15802,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-688,"y":-112,"width":32,"height":32,"inputConnectorIDs":[15819],"outputSuccessConnectorIDs":[15809],"outputFailureConnectorIDs":[15822],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Component","mapTo":"ErrorComponent"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Check VIPorter Promotion"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"################################################################################\n#\n# check elmah\n#\n################################################################################\n\n#assign the name of the check to the environment variable\ncheckname = \"PET VIPorter Promotions data check\"\n\n\ncursor = context.cursor()\n\nsql = \"SELECT name, issuetype, responsystablename, recordcount, firsterrordatetime, lasterrordatetime FROM etl.pegasuselmahlogs\"\nsql = sql  + \" WHERE responsystablename in ('PET_VIPorter_PromotionCampaignPreference') \"\n\n#execute sql query\ncursor.execute(sql)\nrow = cursor.fetchone()\n\nappname = \"app\"\ntablename = \"table\"\nerrortype = \"description\"\nunloadedrecordcount = 0\nfirstunloaded = '2019-07-01'\nfirstunloadedstring = \"string\"\nlastunloaded = '2019-07-01'\nlastunloadedstring = \"string\"\n\n\n#assign variables\nif row:\n  if row[3] > 0:\n    appname = row[0]\n    errortype = row[1]\n    tablename = row[2]\n    unloadedrecordcount = row[3]\n    firstunloaded = row[4]\n    firstunloadedstring = str(firstunloaded)\n    lastunloaded = row[5]\n    lastunloadedstring = str(lastunloaded)\n\n# python subscring function --- string[start:end]: Get all characters from index start to end-1\n  \n#print \"appname: \" + str(appname)\n#print \"tablename: \" + str(tablename)\n#print \"errortype: \" + str(errortype)\n#print \"unloadedrecordcount: \" + str(unloadedrecordcount)\n#print \"firstunloaded: \" + (firstunloadedstring[0:19])\n#print \"lastunloaded: \" + (lastunloadedstring[0:19])\n\n\nif unloadedrecordcount > 0:\n  message = \"There are \" + str(unloadedrecordcount) + \" viporter promotion records not loaded in the last 24 hours. \\n\" \n  message = message + \"The date and time of the last record that failed to load is : \" + (lastunloadedstring[0:19]) + \" \\n\"\n  message = message + \"Please review the elmah logs for application \" + str(appname) + \", process \" + str(tablename) + \" \\n\"\n  \n  context.updateVariable(\"Errormessage\", message)\n  print message\n  raise Exception    \n  \n  \n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15803":{"id":15803,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-688,"y":-240,"width":32,"height":32,"inputConnectorIDs":[15822],"outputSuccessConnectorIDs":[15808],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 4"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning - ${job_name}"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Warning:\n${Errormessage}\n\n-------------------------------------------\nJob: ${job_name}\nComponent: ${ErrorComponent}\nEnvironment: ${environment_name}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15804":{"id":15804,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-368,"y":-176,"width":32,"height":32,"inputConnectorIDs":[32542],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"15805":{"id":15805,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-592,"y":-176,"width":32,"height":32,"inputConnectorIDs":[15808,15809],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[32539],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 4"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32505":{"id":32505,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-741198691,"x":-1664,"y":-192,"width":32,"height":32,"inputConnectorIDs":[32521],"outputSuccessConnectorIDs":[32525],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get_pegasus_elmah_log"}}}},"visible":true},"2":{"slot":2,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Microsoft SQL Server"}}}},"visible":true},"3":{"slot":3,"name":"Connection URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_server_url_elmah}"}}}},"visible":true},"6":{"slot":6,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_user_elmah}"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"appDWETLelmah"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/*return the # of records not loaded into each PET table */\nSELECT name, elmahtypename, issuetype, SUM(recordcount) AS recordcount, responsystablename, MIN(CreateDate) AS firsterrordatetime, MAX(CreateDate) AS lasterrordatetime FROM (\nSELECT \nea.name, et.name AS elmahtypename\n, em.Name AS elmahmessage \n, e.CreateDate\n, CASE WHEN CHARINDEX('Merged',em.name, 1) > 0 THEN 'loading' ELSE 'connecting' END AS issuetype\n, CASE WHEN CHARINDEX('record(s)',em.name,0) = 0 THEN 0 ELSE CAST(SUBSTRING(em.name, 1,CHARINDEX('record(s)',em.name,0)-1) AS int) END AS recordcount\n, CASE WHEN CHARINDEX('table',em.name,0) = 0 THEN '' ELSE SUBSTRING(em.name, CHARINDEX('table',em.name,0)+6,LEN(em.name)) END AS responsystablename\nFROM dbo.Elmah AS e\nINNER JOIN dbo.ElmahType AS et\nON e.typeid = et.id\nINNER JOIN dbo.ElmahMessage AS em\nON e.MessageID = em.ID\nINNER JOIN dbo.ElmahApp AS ea\nON e.appid = ea.id\nWHERE appid=104 --Pegasus\nAND em.Name NOT LIKE '%Airmail%' --ignore airmail messages\nAND createdate BETWEEN getdate()-7 AND getdate()\n\n) AS results\nGROUP BY name, elmahtypename, issuetype,responsystablename"}}}},"visible":true},"9":{"slot":9,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pegasuselmahlogs"}}}},"visible":true},"10":{"slot":10,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"porterdatawarehouse"}}}},"visible":true},"11":{"slot":11,"name":"Connection Options","elements":{},"visible":true},"12":{"slot":12,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"2"}}}},"visible":true},"13":{"slot":13,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"15":{"slot":15,"name":"Sort Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"firsterrordatetime"}}}},"visible":true},"16":{"slot":16,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"17":{"slot":17,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32528":{"id":32528,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-480,"y":-176,"width":32,"height":32,"inputConnectorIDs":[32539],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[32542],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate Tables 0"}}}},"visible":true},"2":{"slot":2,"name":"Tables to Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pegasuselmahlogs"}}}},"visible":true},"3":{"slot":3,"name":"Schema ","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"15808":{"id":15808,"sourceID":15803,"targetID":15805},"15809":{"id":15809,"sourceID":15802,"targetID":15805},"15810":{"id":15810,"sourceID":15797,"targetID":15798},"15811":{"id":15811,"sourceID":15790,"targetID":15792},"15812":{"id":15812,"sourceID":15793,"targetID":15795},"15813":{"id":15813,"sourceID":15800,"targetID":15801},"15814":{"id":15814,"sourceID":15799,"targetID":15801},"15815":{"id":15815,"sourceID":15796,"targetID":15798},"32525":{"id":32525,"sourceID":32505,"targetID":15790},"15806":{"id":15806,"sourceID":15791,"targetID":15792},"15807":{"id":15807,"sourceID":15794,"targetID":15795}},"failureConnectors":{"15824":{"id":15824,"sourceID":15800,"targetID":15799},"15825":{"id":15825,"sourceID":15796,"targetID":15797},"15826":{"id":15826,"sourceID":15793,"targetID":15794},"15822":{"id":15822,"sourceID":15802,"targetID":15803},"15823":{"id":15823,"sourceID":15790,"targetID":15791}},"unconditionalConnectors":{"15817":{"id":15817,"sourceID":15792,"targetID":15793},"32521":{"id":32521,"sourceID":15789,"targetID":32505},"15819":{"id":15819,"sourceID":15801,"targetID":15802},"32539":{"id":32539,"sourceID":15805,"targetID":32528},"15820":{"id":15820,"sourceID":15798,"targetID":15800},"15821":{"id":15821,"sourceID":15795,"targetID":15796},"32542":{"id":32542,"sourceID":32528,"targetID":15804}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1570629818768,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"15783":{"id":15783,"x":-1761,"y":-422,"width":250,"height":58,"text":"This job checks how many records for each Pegasus Process failed to load.\n\nLast updated: 2019-10-01","colour":"e6e63c"},"15784":{"id":15784,"x":-1584,"y":-318,"width":140,"height":268,"text":"PET_VIPorter_WelcomeNotification","colour":"e6e63c"},"15785":{"id":15785,"x":-1388,"y":-326,"width":143,"height":280,"text":"PET_Staff_Travel","colour":"e6e63c"},"15786":{"id":15786,"x":-1182,"y":-326,"width":130,"height":281,"text":"PET_NonMember_SpecialOfferCampaignPreference","colour":"e6e63c"},"15787":{"id":15787,"x":-985,"y":-320,"width":146,"height":274,"text":"PET_VIPorter_MarketingSaleCampaignPreference","colour":"e6e63c"},"15788":{"id":15788,"x":-767,"y":-326,"width":154,"height":284,"text":"PET_VIPorter_PromotionCampaignPreference","colour":"e6e63c"},"15986":{"id":15986,"x":-1730,"y":-275,"width":130,"height":155,"text":"Get the pegasus elmah logs.","colour":"e6e63c"},"32613":{"id":32613,"x":-519,"y":-259,"width":82,"height":165,"text":"Cleanup.","colour":"e6e63c"}},"variables":{"var_cnt":{"definition":{"name":"var_cnt","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"1"}},"grids":{}},"info":{"name":"DI - Pegasus Data Checks","description":"DI check on Pegasus","type":"ORCHESTRATION"}}