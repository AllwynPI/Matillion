{"job":{"components":{"32486":{"id":32486,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-741198691,"x":-1664,"y":-352,"width":32,"height":32,"inputConnectorIDs":[32497],"outputSuccessConnectorIDs":[32493],"outputFailureConnectorIDs":[32498],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"elmah_log"}}}},"visible":true},"2":{"slot":2,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Microsoft SQL Server"}}}},"visible":true},"3":{"slot":3,"name":"Connection URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_server_url_elmah}"}}}},"visible":true},"6":{"slot":6,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_user_elmah}"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"appDWETLelmah"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"/*return the # of records not loaded into each PET table */\nSELECT name, elmahtypename, issuetype, SUM(recordcount) AS recordcount, responsystablename, MIN(CreateDate) AS firsterrordatetime FROM (\nSELECT \nea.name, et.name AS elmahtypename\n, em.Name AS elmahmessage \n, e.CreateDate\n, CASE WHEN CHARINDEX('Merged',em.name, 1) > 0 THEN 'loading' ELSE 'connecting' END AS issuetype\n, CASE WHEN CHARINDEX('record(s)',em.name,0) = 0 THEN 0 ELSE CAST(SUBSTRING(em.name, 1,CHARINDEX('record(s)',em.name,0)-1) AS int) END AS recordcount\n, CASE WHEN CHARINDEX('table',em.name,0) = 0 THEN '' ELSE SUBSTRING(em.name, CHARINDEX('table',em.name,0)+6,LEN(em.name)) END AS responsystablename\nFROM dbo.Elmah AS e\nINNER JOIN dbo.ElmahType AS et\nON e.typeid = et.id\nINNER JOIN dbo.ElmahMessage AS em\nON e.MessageID = em.ID\nINNER JOIN dbo.ElmahApp AS ea\nON e.appid = ea.id\nWHERE appid=104 --Pegasus\nAND em.Name NOT LIKE '%Airmail%' --ignore airmail messages\nAND createdate BETWEEN getdate()-7 AND getdate()\n\n) AS results\nGROUP BY name, elmahtypename, issuetype,responsystablename"}}}},"visible":true},"9":{"slot":9,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"elmahlogs"}}}},"visible":true},"10":{"slot":10,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"porterdatawarehouse"}}}},"visible":true},"11":{"slot":11,"name":"Connection Options","elements":{},"visible":true},"12":{"slot":12,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"2"}}}},"visible":true},"13":{"slot":13,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"15":{"slot":15,"name":"Sort Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"firsterrordatetime"}}}},"visible":true},"16":{"slot":16,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"17":{"slot":17,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32487":{"id":32487,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-1248,"y":-352,"width":32,"height":32,"inputConnectorIDs":[32495],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32488":{"id":32488,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-1599,"y":-231,"width":32,"height":32,"inputConnectorIDs":[32498],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[32496],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32489":{"id":32489,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-1414,"y":-223,"width":32,"height":32,"inputConnectorIDs":[32496],"outputSuccessConnectorIDs":[32494],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import failed"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} Failed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob Failed: ${job_name}\n\nErrorMessage: ${Errormessage}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32490":{"id":32490,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-1254,"y":-223,"width":32,"height":32,"inputConnectorIDs":[32494],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32491":{"id":32491,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1882,"y":-351,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[32497],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"32492":{"id":32492,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-1463,"y":-349,"width":32,"height":32,"inputConnectorIDs":[32493],"outputSuccessConnectorIDs":[32495],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Elmah - Error_Load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Elmah - Error_Load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"32493":{"id":32493,"sourceID":32486,"targetID":32492},"32494":{"id":32494,"sourceID":32489,"targetID":32490},"32495":{"id":32495,"sourceID":32492,"targetID":32487}},"failureConnectors":{"32498":{"id":32498,"sourceID":32486,"targetID":32488}},"unconditionalConnectors":{"32496":{"id":32496,"sourceID":32488,"targetID":32489},"32497":{"id":32497,"sourceID":32491,"targetID":32486}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":false,"undoCommand":"","undoCreated":-1,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"32484":{"id":32484,"x":-2046,"y":-492,"width":425,"height":66,"text":"Extracts records from the elmah logging db\n\nupdated: 2019-08-13","colour":"e6e63c"},"32485":{"id":32485,"x":-1519,"y":-454,"width":134,"height":175,"text":"Added transformation component to copy the extracted results to a sandbox table for testing.","colour":"e6e63c"}},"variables":{},"grids":{}},"info":{"name":"Elmah - Pegasus Error Log","description":"","type":"ORCHESTRATION"}}