{"job":{"components":{"105793":{"id":105793,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-688,"y":-32,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[105804],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"105799":{"id":105799,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-576,"y":-32,"width":32,"height":32,"inputConnectorIDs":[105804],"outputSuccessConnectorIDs":[107937],"outputFailureConnectorIDs":[107942],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Preprocessing"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#   print myvar\n# Updating a variable:\n#   context.updateVariable('myvar', 'new-value')\n# Grid Variables are accessible via the context:\n#   print context.getGridVariable('mygridvar')\n# Updating a grid variable:\n#   context.updateGridVariable('mygridvar', [['list','of'],['lists','!']])\n# A database cursor can be accessed from the context (Jython only):\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\nfrom ftplib import FTP\nimport re\nimport os\nfrom datetime import datetime\nfrom dateutil.relativedelta import relativedelta\ncursor = context.cursor()\ncursor.execute(\"\"\"SELECT to_char(ISNULL(max(founddateutc) + 1, DateAdd(d, -1, GetDate())), 'YYYYMMDD') as date\n\t\t\t\t FROM public.infaredetails\n\t\t\t\t WHERE founddateutc = (SELECT ISNULL(max(founddateutc), DateAdd(d, -1, GetDate())) FROM public.infaredetails) \"\"\") \nresult = cursor.fetchone()\n\nprint result\n#datestamp = {'AM':result[0], 'PM':  (datetime.strptime(result[0], '%d%m%Y') + timedelta(days=1)).strftime('%d%m%Y')}[result[1]]\n#datestamp = result[0]\n# print datestamp \n#atestamp = datetime.now()+ relativedelta(days=5)\ndatestampe = datetime.now()\n\n\ndatestamp = datestampe.strftime(\"%Y%m%d\")\n#datestamp = datestampe.strftime(\"%d-%b-%Y (%H:%M:%S.%f)\")\nprint datestamp \n\nnextFilePattern = \"PD_FH_\" + datestamp + \"0800.zip\"\n\nprint nextFilePattern\n\n#Login to FPT, download file list\nftp = FTP('ftp.infare.net')\nftp.login('pd_vacation','SvVr37rJ')\nftp.cwd('VacationCompact/NotProcessed')\ncontents = ftp.nlst()\n\n#print contents\nfiles = [x for i, x in enumerate(contents) if re.search(nextFilePattern, x)]\nfilecount = len(files)\n\nif filecount == 1:\n#  print \"found \" +  str(filecount) + \" file\"\n \tprint \"filecount = 1\"\n\tcontext.updateVariable(\"ftp_filename\", files[0])\n\tcontext.updateVariable(\"ftp_scrapestatus\", 1)\n\tcontext.updateVariable(\"ftp_scrapefile\", files[0].replace(\".zip\", \"\"))\nelse:\n#print \"found \" +  str(filecount) + \" files\"\n  \tprint \"filecount = 0\" \n\tcontext.updateVariable(\"ftp_scrapestatus\", 0)\n\ttd = datetime.today() - datetime.strptime(datestamp, '%d%m%Y')\n\tcontext.updateVariable(\"ftp_lastupdate\", td.days)\n\tprint td.days\n\nprint \"Files found: \" , files"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"107934":{"id":107934,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-416,"y":-80,"width":32,"height":32,"inputConnectorIDs":[107937],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[107971],"outputFalseConnectorIDs":[108016],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"IF - Error conditions"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ftp_filename"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Blank"},"4":{"slot":4,"type":"STRING","value":""}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"ftp_lastupdate"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Greater than"},"4":{"slot":4,"type":"STRING","value":"1"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"107939":{"id":107939,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-416,"y":16,"width":32,"height":32,"inputConnectorIDs":[107942,108022],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[107988],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"107968":{"id":107968,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-240,"y":-128,"width":32,"height":32,"inputConnectorIDs":[107971],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"107979":{"id":107979,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-272,"y":112,"width":32,"height":32,"inputConnectorIDs":[107991],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"107984":{"id":107984,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-416,"y":112,"width":32,"height":32,"inputConnectorIDs":[107988],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[107991],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 0"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-west-2"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} - Job Failed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} - Job Failed\n\n${Errormessage}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"108005":{"id":108005,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":620619864,"x":-240,"y":-32,"width":32,"height":32,"inputConnectorIDs":[108016],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[108022],"outputUnconditionalConnectorIDs":[109659],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Data Transfer to s3"}}}},"visible":true},"2":{"slot":2,"name":"Source Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"FTP"}}}},"visible":true},"4":{"slot":4,"name":"Target Object Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"test.csv"}}}},"visible":false},"5":{"slot":5,"name":"Target Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"S3"}}}},"visible":true},"6":{"slot":6,"name":"Set Home Directory as Root","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"7":{"slot":7,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ftp://ftp.infare.net/VacationCompact/Archive/${ftp_filename}"}}}},"visible":true},"8":{"slot":8,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"pd_vacation"}}}},"visible":true},"9":{"slot":9,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"PE_InScrape_ftp"}}}},"visible":true},"10":{"slot":10,"name":"Source URL","elements":{},"visible":false},"11":{"slot":11,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"hdfs://host:port/filePath"}}}},"visible":false},"12":{"slot":12,"name":"Perform Certificate Validation","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"13":{"slot":13,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"https://[username[:password]@]hostname[:port][absolute-path]"}}}},"visible":false},"14":{"slot":14,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"15":{"slot":15,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"16":{"slot":16,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"http://[username[:password]@]hostname[:port][absolute-path]"}}}},"visible":false},"17":{"slot":17,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"18":{"slot":18,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"19":{"slot":19,"name":"Source URL","elements":{},"visible":false},"20":{"slot":20,"name":"Set Home Directory as Root","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"21":{"slot":21,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sftp://[username[:password]@]hostname[:port][path]"}}}},"visible":false},"22":{"slot":22,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"23":{"slot":23,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"24":{"slot":24,"name":"Source SFTP Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"25":{"slot":25,"name":"Source URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"smb://[[[authdomain;]user@]host[:port][/share[/dirpath][/name]]][?context]"}}}},"visible":false},"26":{"slot":26,"name":"Source Domain","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"27":{"slot":27,"name":"Source Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"28":{"slot":28,"name":"Source Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"29":{"slot":29,"name":"Target URL","elements":{},"visible":false},"30":{"slot":30,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"hdfs://host:port/filePath"}}}},"visible":false},"31":{"slot":31,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://porterdatawarehouse/infare/"}}}},"visible":true},"33":{"slot":33,"name":"Set Home Directory as Root","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"34":{"slot":34,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sftp://[username[:password]@]hostname[:port][path]"}}}},"visible":false},"35":{"slot":35,"name":"Target Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"36":{"slot":36,"name":"Target Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"37":{"slot":37,"name":"Target SFTP Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"38":{"slot":38,"name":"Target URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"smb://[[[authdomain;]user@]host[:port][/share[/dirpath][/name]]][?context]"}}}},"visible":false},"39":{"slot":39,"name":"Target Domain","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"40":{"slot":40,"name":"Target Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"41":{"slot":41,"name":"Target Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"42":{"slot":42,"name":"Unpack ZIP file","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"43":{"slot":43,"name":"Gzip data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"50":{"slot":50,"name":"URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"https://<account>.sharepoint.com"}}}},"visible":false},"51":{"slot":51,"name":"User","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"52":{"slot":52,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":""}}}},"visible":false},"53":{"slot":53,"name":"SharePoint Edition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SharePoint Online"}}}},"visible":false},"54":{"slot":54,"name":"File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Document"}}}},"visible":false},"55":{"slot":55,"name":"Library","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"56":{"slot":56,"name":"File URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"57":{"slot":57,"name":"Connection Options","elements":{},"visible":false},"16040":{"slot":16040,"name":"Blob Location","elements":{},"visible":false},"16140":{"slot":16140,"name":"Blob Location","elements":{},"visible":false},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"109654":{"id":109654,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-16,"y":-32,"width":32,"height":32,"inputConnectorIDs":[109659],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 1"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"107937":{"id":107937,"sourceID":105799,"targetID":107934}},"failureConnectors":{"107991":{"id":107991,"sourceID":107984,"targetID":107979},"107942":{"id":107942,"sourceID":105799,"targetID":107939},"108022":{"id":108022,"sourceID":108005,"targetID":107939}},"unconditionalConnectors":{"107988":{"id":107988,"sourceID":107939,"targetID":107984},"109659":{"id":109659,"sourceID":108005,"targetID":109654},"105804":{"id":105804,"sourceID":105793,"targetID":105799}},"trueConnectors":{"107971":{"id":107971,"sourceID":107934,"targetID":107968}},"falseConnectors":{"108016":{"id":108016,"sourceID":107934,"targetID":108005}},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1582663025184,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"112198":{"id":112198,"x":-772,"y":-185,"width":859,"height":366,"text":"Move file from ftp server to S3","colour":"e6e63c"}},"variables":{},"grids":{}},"info":{"name":"FTP - PEMarketScrape","description":null,"type":"ORCHESTRATION"}}