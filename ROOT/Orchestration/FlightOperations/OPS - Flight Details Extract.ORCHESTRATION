{"job":{"components":{"52856":{"id":52856,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-741198691,"x":-1667,"y":-351,"width":32,"height":32,"inputConnectorIDs":[52867],"outputSuccessConnectorIDs":[52865],"outputFailureConnectorIDs":[52873],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl.opsflightdetails"}}}},"visible":true},"2":{"slot":2,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Microsoft SQL Server"}}}},"visible":true},"3":{"slot":3,"name":"Connection URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_server_url_operations}"}}}},"visible":true},"6":{"slot":6,"name":"Username","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_user_operations}"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"${db_pswd_operations}"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT \nfd.LegHashKey\n,CAST(FltNum AS varchar(10)) AS FltNum\n,FltDate\n,CAST(DepAirport  AS varchar(10)) AS DepAirport\n,CAST(ArrAirport  AS varchar(10)) AS ArrAirport\n,CAST(TailNum AS varchar(20)) AS TailNum\n,SDT\n,SAT\n,EDT\n,EAT\n,OUTTime\n,OFFTime\n,ONTime\n,INTime\n,CAST(DepGate  AS varchar(10)) AS DepGate\n,CAST(ArrGate AS varchar(10)) AS ArrGate\n,CAST(DelayCode AS varchar(10)) AS DelayCode\n,CAST(IROPStatus AS varchar(10)) AS IROPStatus\n,SI\n/*,RawData*/\n,Model\n,FltDuration\n,ActFltDuration\n,PairingId\n,CA\n,CAFName\n,CAEmpNum\n,FO\n,FOFName\n,FOEmpNum\n,PU\n,PUFName\n,PUEmpNum\n,FA\n,FAFName\n,FAEmpNum\n,ACM1\n,ACM1FName\n,ACM1EmpNum\n,ACM2\n,ACM2FName\n,ACM2EmpNum\n,ACM3\n,ACM3FName\n,ACM3EmpNum\n,ACM4\n,ACM4FName\n,ACM4EmpNum\n,MTOW\n,RampFuelWeight\n,BurnFuelWeight\n,ActualBurnFuelWeight\n,UncorrectedTailNum\n,ArrAirportSCH\n,M_E_Number\n,FlightDetailsGroup_id\n,IROPDescription\n,DepDelayCode1\n,DepDelayTime1\n,CAST(CASE WHEN DepDelayControllable1 = 1 THEN 1 ELSE 0 END AS int) DepDelayControllable1\n,DepDelayDescription1\n,DepDelayCode2\n,DepDelayTime2\n,CAST(CASE WHEN DepDelayControllable2 = 1 THEN 1 ELSE 0 END AS int) DepDelayControllable2\n--,DepDelayControllable2\n,DepDelayDescription2\n,DepDelayCode3\n,DepDelayTime3\n--,DepDelayControllable3\n,CAST(CASE WHEN DepDelayControllable3 = 1 THEN 1 ELSE 0 END AS int) DepDelayControllable3\n,DepDelayDescription3\n,ArrDelayCode1\n,ArrDelayTime1\n--,ArrDelayControllable1\n,CAST(CASE WHEN ArrDelayControllable1 = 1 THEN 1 ELSE 0 END AS int) ArrDelayControllable1\n,ArrDelayDescription1\n,ArrDelayCode2\n,ArrDelayTime2\n--,ArrDelayControllable2\n,CAST(CASE WHEN ArrDelayControllable2 = 1 THEN 1 ELSE 0 END AS int) ArrDelayControllable2\n,ArrDelayDescription2\n,DepOverallDelayCode\n,DepOverallDelayCalcTime\n--,DepOverallDelayControllable\n,CAST(CASE WHEN DepOverallDelayControllable = 1 THEN 1 ELSE 0 END AS int) DepOverallDelayControllable\n,DepOverallDelayDescription\n,ArrOverallDelayCode\n,ArrOverallDelayCalcTime\n--,ArrOverallDelayControllable\n,CAST(CASE WHEN ArrOverallDelayControllable = 1 THEN 1 ELSE 0 END AS int) ArrOverallDelayControllable\n,ArrOverallDelayDescription\n,IsHeadStart\n,UpliftFuelWeight\n,FuelTicketNum\n,SequenceNumber\n,DepAirportICAO\n,ArrAirportICAO\n,LandingAlternate1\n,LandingAlternate2\n,TakeoffAlternate\n,STD_UTC\n,STA_UTC\n,ETD_UTC\n,ETA_UTC\n,OUTTime_UTC\n,OFFTime_UTC\n,ONTime_UTC\n,INTime_UTC\n,DepartureFuel\n,ArrivalFuel\n,DispatchDesk\n,ActualFlightType\n,UpliftFuelUnits\n,CrewConfiguration\n,EDCT\n,EDCT_UTC\n,CTA\n,CTA_UTC\n,PlainLegHashKey\n,PlainFltNum\n,CarrierCode\n,MLW\n,StubFltNum\n,fdc.ChangeTimeUTC AS  flightdetailchangedatetimeutc\nFROM FlightDetails AS fd\nINNER JOIN (SELECT LegHashKey, MAX(ChangeTimeUTC) AS ChangeTimeUTC \n\t\t\tFROM FlightDetailsChanges AS fdc\n            WHERE ChangeTimeUTC >= '${lastchangetimeutc}'  AND ChangeTimeUTC < '${maxchangetimeutc}' \n\t\t\tGROUP BY  fdc.LegHashKey) AS fdc \n/* return all flight instances for the flight */            \nON \tLEFT(fd.LegHashKey,26) = LEFT(fdc.LegHashKey,26)"}}}},"visible":true},"9":{"slot":9,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"opsflightdetails"}}}},"visible":true},"10":{"slot":10,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"porterdatawarehouse"}}}},"visible":true},"11":{"slot":11,"name":"Connection Options","elements":{},"visible":true},"12":{"slot":12,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${s3_concurrent_files}"}}}},"visible":true},"13":{"slot":13,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"15":{"slot":15,"name":"Sort Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"LegHashKey"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"FltDate"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"FltNum"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"DepAirport"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"ArrAirport"}}}},"visible":true},"16":{"slot":16,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"17":{"slot":17,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"","elements":{},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Comp Update"},"2":{"slot":2,"type":"STRING","value":"Off"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Recreate Target Table"},"2":{"slot":2,"type":"STRING","value":"Off"}}}},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52857":{"id":52857,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-1168,"y":-352,"width":32,"height":32,"inputConnectorIDs":[52869],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52858":{"id":52858,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-1599,"y":-231,"width":32,"height":32,"inputConnectorIDs":[52872,52873],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[52870],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52859":{"id":52859,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-1456,"y":-224,"width":32,"height":32,"inputConnectorIDs":[52870],"outputSuccessConnectorIDs":[52868],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import failed"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${sns_region}"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${sns_dw_etl}"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} Failed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob Failed: ${job_name}\n\nErrorMessage: ${Errormessage}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52860":{"id":52860,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-1254,"y":-223,"width":32,"height":32,"inputConnectorIDs":[52868],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52861":{"id":52861,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-1968,"y":-352,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[52871],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52862":{"id":52862,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-1456,"y":-352,"width":32,"height":32,"inputConnectorIDs":[52865],"outputSuccessConnectorIDs":[52866],"outputFailureConnectorIDs":[52872],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OPS - Flight Detail Load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OPS - Flight Details Load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52863":{"id":52863,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-1824,"y":-352,"width":32,"height":32,"inputConnectorIDs":[52871],"outputSuccessConnectorIDs":[52867],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get last maxchangetimeutc"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# get the lastest changetimeutc\n###\n\ncursor = context.cursor()\n\n###effectivedatetimeutc - ultimate required\n\nSQL = \"SELECT to_char(ISNULL(MAX(flightdetailchangedatetimeutc),getdate()-1),'yyyy-mm-dd hh24:mi:ss') FROM ops.flightdetails\"\n\n\n\ncursor.execute(SQL)\nactdt = cursor.fetchone()[0]\n\ncontext.updateVariable(\"lastchangetimeutc\", str(actdt))\n\n# test variables settings\n#context.updateVariable(\"lastchangetimeutc\", \"2017-09-01\")\n#context.updateVariable(\"maxchangetimeutc\", \"2017-11-01\")\n\nprint \"lastchangetimeutc: \" + str(lastchangetimeutc)\nprint \"maxchangetimeutc: \" + str(maxchangetimeutc)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"52864":{"id":52864,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-1312,"y":-352,"width":32,"height":32,"inputConnectorIDs":[52866],"outputSuccessConnectorIDs":[52869],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate etl table"}}}},"visible":true},"2":{"slot":2,"name":"Tables to Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"opsflightdetails"}}}},"visible":true},"3":{"slot":3,"name":"Schema ","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"52865":{"id":52865,"sourceID":52856,"targetID":52862},"52866":{"id":52866,"sourceID":52862,"targetID":52864},"52867":{"id":52867,"sourceID":52863,"targetID":52856},"52868":{"id":52868,"sourceID":52859,"targetID":52860},"52869":{"id":52869,"sourceID":52864,"targetID":52857}},"failureConnectors":{"52872":{"id":52872,"sourceID":52862,"targetID":52858},"52873":{"id":52873,"sourceID":52856,"targetID":52858}},"unconditionalConnectors":{"52870":{"id":52870,"sourceID":52858,"targetID":52859},"52871":{"id":52871,"sourceID":52861,"targetID":52863}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Resize Note","undoCreated":1580501598379,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"52855":{"id":52855,"x":-1986,"y":-506,"width":529,"height":111,"text":"Extracts all the flight details column data from the operations db and loads into the ops schema\n\ndatabase query uses the parameter to set the s3 concurrent files, automatic compression is turned off, and recreated table is turned off\n\n\nupdate:2020-01-31\n","colour":"e6e63c"}},"variables":{"lastchangetimeutc":{"definition":{"name":"lastchangetimeutc","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"2019-11-25"},"maxchangetimeutc":{"definition":{"name":"maxchangetimeutc","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"9999-12-31"}},"grids":{}},"info":{"name":"OPS - Flight Details Extract","description":"","type":"ORCHESTRATION"}}