{"job":{"components":{"13935":{"id":13935,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-800,"y":16,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[13951],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13936":{"id":13936,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-624,"y":16,"width":32,"height":32,"inputConnectorIDs":[13951],"outputSuccessConnectorIDs":[16880],"outputFailureConnectorIDs":[13955],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get the job name"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#  print myvar\n#  Updating a variable:\n#    context.updateVariable('myvar', 'new-value')\n# Using a database cursor:\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\n\nimport re\nfrom datetime import datetime\n\njob_name = ''\n#find the according child job\nif re.match('(.*)[0-9]{8}_odBidprice\\.csv\\.gz$', pros_s3filename):\n  job_name = 'PROS - rme_bidprice'\n  flag = 1\nelif re.match('(.*)[0-9]{8}_postDepartureData\\.csv\\.gz$', pros_s3filename):\n  job_name = 'PROS - rme_post_dept_data'\n  flag = 1\nelif re.match('(.*)[0-9]{8}_preDepartureData\\.csv\\.gz$', pros_s3filename):\n  job_name = 'PROS - rme_pre_dept_data'\n  flag = 1\nelif re.match('(.*)[0-9]{8}_segmentDCPForecasts\\.csv\\.gz$', pros_s3filename):\n  job_name = 'PROS - seg_dcp_forecasts'\n  flag = 1\nelif re.match('(.*)[0-9]{8}_segmentSummaryForecasts\\.csv\\.gz$', pros_s3filename):\n  job_name = 'PROS - seg_fcst_dcprma'\n  flag = 1\nelse:\n  flag = 0\n  job_message = \"File: \" + pros_s3filename + \" does not reference to any Pros RME job\"  \n  context.updateVariable(\"message\", job_message)\n  print (message) \n  \nprint(job_name)\nprint(pros_s3filename)\n\ncontext.updateVariable('valid_file' , flag)\ncontext.updateVariable('pros_s3filename', pros_s3filename.strip())\ncontext.updateVariable('child_job_name', job_name)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13937":{"id":13937,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1785813072,"x":-208,"y":16,"width":32,"height":32,"inputConnectorIDs":[16883],"outputSuccessConnectorIDs":[13945,13947],"outputFailureConnectorIDs":[13954],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PROS - Job"}}}},"visible":true},"2":{"slot":2,"name":"Orchestration Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${child_job_name}"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"file_name"},"2":{"slot":2,"type":"STRING","value":"${pros_s3filename}"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"file_location"},"2":{"slot":2,"type":"STRING","value":"${file_location}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13938":{"id":13938,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":320,"y":32,"width":32,"height":32,"inputConnectorIDs":[13953],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13939":{"id":13939,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":320,"y":192,"width":32,"height":32,"inputConnectorIDs":[13949],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13940":{"id":13940,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":48,"y":192,"width":32,"height":32,"inputConnectorIDs":[13952],"outputSuccessConnectorIDs":[13949],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Send  DW Error Message"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} - Job Failed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob failed: ${job_name}\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13941":{"id":13941,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":48,"y":-48,"width":32,"height":32,"inputConnectorIDs":[13945],"outputSuccessConnectorIDs":[13946],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RM Success"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_RM"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} Success"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob ${job_name} - Success\n\n${pros_s3filename} has been successfully loaded"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13942":{"id":13942,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":48,"y":96,"width":32,"height":32,"inputConnectorIDs":[13947],"outputSuccessConnectorIDs":[13948],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW Message"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" ${job_name} Success"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob ${job_name} - Success\n\n${pros_s3filename} has been successfully loaded"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13943":{"id":13943,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":235671163,"x":208,"y":32,"width":32,"height":32,"inputConnectorIDs":[13946,13948],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[13953],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"13944":{"id":13944,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-208,"y":192,"width":32,"height":32,"inputConnectorIDs":[16976,13954,13955],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[13952],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"16879":{"id":16879,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"CONDITIONAL","executionHint":"FLOW","implementationID":-1357378929,"x":-416,"y":16,"width":32,"height":32,"inputConnectorIDs":[16880],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[16976],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[16883],"outputFalseConnectorIDs":[16895],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"valid_file?"}}}},"visible":true},"2":{"slot":2,"name":"Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Simple"}}}},"visible":true},"3":{"slot":3,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"valid_file"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"1"}}}},"visible":true},"4":{"slot":4,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":true},"5":{"slot":5,"name":"Condition","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"16887":{"id":16887,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-224,"y":-160,"width":32,"height":32,"inputConnectorIDs":[16895],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[20299],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW Success"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" ${job_name} Success"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob ${job_name} - Success\n\nMessage: ${message}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"16905":{"id":16905,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":320,"y":-160,"width":32,"height":32,"inputConnectorIDs":[20299],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Success"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"16880":{"id":16880,"sourceID":13936,"targetID":16879},"13945":{"id":13945,"sourceID":13937,"targetID":13941},"13946":{"id":13946,"sourceID":13941,"targetID":13943},"13947":{"id":13947,"sourceID":13937,"targetID":13942},"13948":{"id":13948,"sourceID":13942,"targetID":13943},"13949":{"id":13949,"sourceID":13940,"targetID":13939}},"failureConnectors":{"16976":{"id":16976,"sourceID":16879,"targetID":13944},"13954":{"id":13954,"sourceID":13937,"targetID":13944},"13955":{"id":13955,"sourceID":13936,"targetID":13944}},"unconditionalConnectors":{"13952":{"id":13952,"sourceID":13944,"targetID":13940},"13953":{"id":13953,"sourceID":13943,"targetID":13938},"20299":{"id":20299,"sourceID":16887,"targetID":16905},"13951":{"id":13951,"sourceID":13935,"targetID":13936}},"trueConnectors":{"16883":{"id":16883,"sourceID":16879,"targetID":13937}},"falseConnectors":{"16895":{"id":16895,"sourceID":16879,"targetID":16887}},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Connect Components","undoCreated":1568647162990,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"13931":{"id":13931,"x":-843,"y":-219,"width":291,"height":82,"text":"The job listens to the SQS from lambda and triggers a load of PROS RME file \n\nUpdate: 2019-06-03","colour":"e6e63c"},"13932":{"id":13932,"x":-713,"y":-66,"width":186,"height":165,"text":"Checks for the valid file name and finds the corresponding Matillion job to run","colour":"e6e63c"},"13933":{"id":13933,"x":-297,"y":-65,"width":167,"height":158,"text":"Load the corresponding job by ${child_job_name}","colour":"e6e63c"},"13934":{"id":13934,"x":-46,"y":-121,"width":181,"height":369,"text":"Send RM email about job success or failure","colour":"e6e63c"},"17043":{"id":17043,"x":-298,"y":-226,"width":162,"height":129,"text":"Send Success message with invalid file name","colour":"e6e63c"}},"variables":{"child_job_name":{"definition":{"name":"child_job_name","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":null},"file_location":{"definition":{"name":"file_location","type":"TEXT","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":"porter.pros/"},"pros_s3filename":{"definition":{"name":"pros_s3filename","type":"TEXT","scope":"BRANCH","description":" ","visibility":"PUBLIC"},"value":"outgoing/rme/TEST/extract/20190905_FinishExportCsv.txt"},"valid_file":{"definition":{"name":"valid_file","type":"DECIMAL","scope":"BRANCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"PROS - RME - Master","description":"","type":"ORCHESTRATION"}}