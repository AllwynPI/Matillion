{"job":{"components":{"88514":{"id":88514,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-2832,"y":-896,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[88539],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88515":{"id":88515,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-2482,"y":-909,"width":32,"height":32,"inputConnectorIDs":[88531],"outputSuccessConnectorIDs":[88529,88532],"outputFailureConnectorIDs":[88547],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"output json response header and answer files"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Extract the SurveyMonkey responses into json files to be loaded into DW\n###\n\n#surveyid = 88334631\n#context.updateVariable(\"surveymonkey_surveyid\", str(surveyid))\n#context.updateVariable(\"surveymonkey_datemodified\", str(\"2019-11-13T17:15:21\"))\n\nimport requests\nimport json\nimport boto3\n\nclient = requests.session()\n\nheaders = {\n\"Authorization\": \"bearer %s\" % \"fQFyrH0s6FAuxp7D9NR2Dk.D3rNp.Uql5maQYvzKb8.-DiQjUXxNVQPgkmSCRCDoFzn.OwsphJohLxfVGZoeUOe4YxxYYPL6nolIuFECwQrFltPwREHYv4mbyk4m3pas\",\n\"Content-Type\": \"application/json\"\n}\n\nHOST = \"https://api.surveymonkey.net\"\n\n#######################\n#survey responses  \n#######################\n\n#SURVEY_LIST_ENDPOINT = \"/v3/surveys/88334631/responses/bulk?page=899&per_page=2\"\n\n#the survey and the date of the responses to extract\n#pass latest date modified to the url\n#SURVEY_LIST_ENDPOINT = \"/v3/surveys/88334631/responses/bulk?per_page=100&start_modified_at=\" + surveymonkey_englishdatemodified #2018-05-04T18:56:03\"\n\n#surveymonkey_surveyid = 88334631\n#surveymonkey_datemodified = '2019-04-29T20:14:17'\n\nSURVEY_LIST_ENDPOINT = \"/v3/surveys/\" + str(surveymonkey_surveyid) +\"/responses/bulk?per_page=100&start_modified_at=\" + surveymonkey_datemodified #2018-05-04T18:56:03\"\n\n#print SURVEY_LIST_ENDPOINT\n\nuri = \"%s%s\" % (HOST, SURVEY_LIST_ENDPOINT)\n\n#retrieve the responses\nresponse = client.get(uri, headers=headers)\nresponse.encoding = 'utf-8'\nprint(response.text)\nresponsejson = response.json()\n\n###################################################\n# parse the response header information\n###################################################\nresponse_json = \"\"\n\n#count the number of responses being loaded\nsurveymonkey_responsecount = 0\nsurveymonkey_responsecount = len(responsejson['data'])\n\nprint \"response count:\" + str(surveymonkey_responsecount)\n\nfor i in responsejson['data']:\n  response = {}\n \n  #get the # of questions in the response\n  quescount = 0\n  for ques in i['pages']:\n  \tquescount+= len(ques['questions'])\n  print i\n  #print quescount\n  \n  response.update({'id':i['id']})\n  response.update({'question_count':quescount})\n  response.update({'response_status':i['response_status']})\n                   \n  response.update({'date_created':i['date_created']})\n  if 'customerid' in i['custom_variables']:\n  \tresponse.update({'customerid':i['custom_variables']['customerid']})\n  else:\n  \tresponse.update({'customerid':'0'})\n    \n  response.update({'ip_address':i['ip_address']}) #: \"66.130.159.99\",\n  response.update({'survey_id':i['survey_id']}) #: \"88334631\",\n  response.update({'pagecount':str(len(i['pages']))})\n  response.update({'date_modified':i['date_modified']})#\": \"2017-04-19T12:31:08+00:00\",\n  response.update({'total_time':i['total_time']}) #\": 473,\n  #optional survey properties\n  #print i['collection_mode']#\": \"default\",\n  #print i['collector_id']#\": \"96132210\",\n  #print i['edit_url']#\": \"https://www.surveymonkey.com/r/?sm=6TMc_2FcR7iLoruX1F3BjfDFoB4K7H4XSldOTWPsSZdk1RgIBgigvepCiXsU9yHKt9\",\n  #print i['page_path']#\": [],\n  #print i['href']#\": \"https://api.surveymonkey.net/v3/surveys/88334631/responses/5332541840\",\n  #print i['analyze_url']#\": \"https://www.surveymonkey.com/analyze/browse/npkT5Qd_2BfxrGjsQGKuVVchSh8yKi74m7B_2FW9zT2hpSc_3D?respondent_id=5332541840\",\n  #print i['recipient_id']#\": \"\"\n\n  #save json to filestring\n  response_json+=json.dumps(response)\n\n\nprint \"saving responses to S3: porterdatawarehouse/surveymonkey_responses.txt\" \n  \ns3 = boto3.resource('s3') \nnewfile = s3.Object('porterdatawarehouse','surveymonkey_responses.txt')\nnewfile.put(Body=response_json)\n\n\n#####################################################\n#\t\tparse and load the answer details\n#####################################################\n\nresponse_jsondetail = \"\"\n\nfor resp in responsejson['data']: # responsedata:\n    \n  for page in resp['pages']:\n   \n    #get the number of questions on the page\n      for ques in page['questions']:\n   \t  #initialize the json object\n        data = {}\n      \n        for answers in ques['answers']:\n\n          data.update({'survey_id':str(surveymonkey_surveyid)}) #: \"88334631\",\n          data.update({'response_id':resp['id']})\n          data.update({'question_id':ques['id']})\n          data.update({'answer':answers})\n        \n        #append the json record to the string\n          response_jsondetail+= json.dumps(data)\n\nprint \"saving responses answers to S3: porterdatawarehouse/surveymonkey_answers.txt\" \n\n#connect to S3 and create file  \ns3 = boto3.resource('s3') \n#answers file\nnewfile = s3.Object('porterdatawarehouse','surveymonkey_answers.txt')\nnewfile.put(Body=response_jsondetail)\n\n\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Python 2"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88516":{"id":88516,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1449697230,"x":-2112,"y":-1008,"width":32,"height":32,"inputConnectorIDs":[88528],"outputSuccessConnectorIDs":[88534],"outputFailureConnectorIDs":[88544],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load surveymonkeyresponse"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"surveymonkeyresponse"}}}},"visible":true},"3":{"slot":3,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"response_status"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"pagecount"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"date_created"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ip_address"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"question_count"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"survey_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"date_modified"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"customerid"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"total_time"}}}},"visible":true},"4":{"slot":4,"name":"S3 URL Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://porterdatawarehouse"}}}},"visible":true},"5":{"slot":5,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"surveymonkey_responses.txt"}}}},"visible":true},"6":{"slot":6,"name":"Data File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"JSON"}}}},"visible":true},"7":{"slot":7,"name":"Fixed Width Spec","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"9":{"slot":9,"name":"CSV Quoter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"10":{"slot":10,"name":"JSON Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://porterdatawarehouse/surveymonkey/surveymonkey_response_jsonpath.json"}}}},"visible":true},"11":{"slot":11,"name":"S3 Bucket Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"13":{"slot":13,"name":"Compression Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"14":{"slot":14,"name":"Encoding","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UTF8"}}}},"visible":true},"15":{"slot":15,"name":"Remove Quotes","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"16":{"slot":16,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"?"}}}},"visible":true},"17":{"slot":17,"name":"Maximum Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"18":{"slot":18,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"19":{"slot":19,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"20":{"slot":20,"name":"Ignore Header Rows","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"21":{"slot":21,"name":"Accept Any Date","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"22":{"slot":22,"name":"Ignore Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"23":{"slot":23,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"24":{"slot":24,"name":"Fill Record","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"25":{"slot":25,"name":"Trim Blanks","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"26":{"slot":26,"name":"NULL As","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"27":{"slot":27,"name":"Empty As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"28":{"slot":28,"name":"Blanks As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"29":{"slot":29,"name":"Comp Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"30":{"slot":30,"name":"Stat Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"31":{"slot":31,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"32":{"slot":32,"name":"Round Decimals","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"33":{"slot":33,"name":"Manifest","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"34":{"slot":34,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"35":{"slot":35,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"36":{"slot":36,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"37":{"slot":37,"name":"Explicit IDs","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"38":{"slot":38,"name":"IAM Role ARN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"arn:aws:iam::<aws-account-id>:role/<role-name>"}}}},"visible":true},"112":{"slot":112,"name":"Avro Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88517":{"id":88517,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":1449697230,"x":-2112,"y":-832,"width":32,"height":32,"inputConnectorIDs":[88536],"outputSuccessConnectorIDs":[88530],"outputFailureConnectorIDs":[88545],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"load surveymonkeyresponseanswer"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"surveymonkeyresponseanswer"}}}},"visible":true},"3":{"slot":3,"name":"Load Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"survey_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"response_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"question_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"answer"}}}},"visible":true},"4":{"slot":4,"name":"S3 URL Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://porterdatawarehouse"}}}},"visible":true},"5":{"slot":5,"name":"S3 Object Prefix","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"surveymonkey_answers.txt"}}}},"visible":true},"6":{"slot":6,"name":"Data File Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"JSON"}}}},"visible":true},"7":{"slot":7,"name":"Fixed Width Spec","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"8":{"slot":8,"name":"Delimiter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"9":{"slot":9,"name":"CSV Quoter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"10":{"slot":10,"name":"JSON Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://porterdatawarehouse/surveymonkey/sm_answers_jsonpath.json"}}}},"visible":true},"11":{"slot":11,"name":"S3 Bucket Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"13":{"slot":13,"name":"Compression Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"14":{"slot":14,"name":"Encoding","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UTF8"}}}},"visible":true},"15":{"slot":15,"name":"Remove Quotes","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"16":{"slot":16,"name":"Replace Invalid Characters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"?"}}}},"visible":true},"17":{"slot":17,"name":"Maximum Errors","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"18":{"slot":18,"name":"Date Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"19":{"slot":19,"name":"Time Format","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":true},"20":{"slot":20,"name":"Ignore Header Rows","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"0"}}}},"visible":true},"21":{"slot":21,"name":"Accept Any Date","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"22":{"slot":22,"name":"Ignore Blank Lines","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"23":{"slot":23,"name":"Truncate Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"24":{"slot":24,"name":"Fill Record","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"25":{"slot":25,"name":"Trim Blanks","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"26":{"slot":26,"name":"NULL As","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"27":{"slot":27,"name":"Empty As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"28":{"slot":28,"name":"Blanks As Null","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"29":{"slot":29,"name":"Comp Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"30":{"slot":30,"name":"Stat Update","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Off"}}}},"visible":true},"31":{"slot":31,"name":"Escape","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"32":{"slot":32,"name":"Round Decimals","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"33":{"slot":33,"name":"Manifest","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"34":{"slot":34,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"35":{"slot":35,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":false},"36":{"slot":36,"name":"","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":null}}}},"visible":false},"37":{"slot":37,"name":"Explicit IDs","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"38":{"slot":38,"name":"IAM Role ARN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"arn:aws:iam::<aws-account-id>:role/<role-name>"}}}},"visible":true},"112":{"slot":112,"name":"Avro Layout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"auto"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88518":{"id":88518,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-2688,"y":-896,"width":32,"height":32,"inputConnectorIDs":[88539],"outputSuccessConnectorIDs":[88531],"outputFailureConnectorIDs":[88546],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get surveymonkey_datemodified"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n# Variables are directly accessible: \n#  print myvar\n#  Updating a variable:\n#    context.updateVariable('myvar', 'new-value')\n# Using a database cursor:\n#   cursor = context.cursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n###\n\n#surveyid = 88334631\n#context.updateVariable(\"surveymonkey_surveyid\", str(surveyid))\n#context.updateVariable(\"surveymonkey_datemodified\", str(\"2019-11-13T17:15:21\"))\n\ncursor = context.cursor()\nsql = \"\"\n#sql = \"SELECT left(MAX(date_created),19) as datecreated, left(ISNULL(MAX(date_modified),'2018-05-01'),19) As datemodified\" \n#sql = sql + \" FROM etl.surveymonkeyresponse WHERE survey_id = '\" + str(surveymonkey_englishsurveyid) + \"'\"\n\nsql\t= \"SELECT left(MAX(surveyresponsecreated),19) as datecreated, left(ISNULL(MAX(surveyresponsemodified),'2018-05-01'),19) As datemodified\" \nsql = sql + \" FROM web.surveymonkeysurveyresponse WHERE surveymonkeysurveyid = '\" + str(surveymonkey_surveyid) + \"'\"\n\nprint \"survey id: \" + str(surveymonkey_surveyid)\n\ncursor.execute(sql)\n\n#assign the date_modified field\ndatemodified = cursor.fetchone()[1]\ncontext.updateVariable(\"surveymonkey_datemodified\", str(datemodified))\nprint \"surveymonkey_datemodified: \" + str(datemodified)\n"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88519":{"id":88519,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-2289,"y":-1009,"width":32,"height":32,"inputConnectorIDs":[88532],"outputSuccessConnectorIDs":[88528],"outputFailureConnectorIDs":[88543],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl.surveymonkeyresponse"}}}},"visible":true},"2":{"slot":2,"name":"Tables to Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"surveymonkeyresponse"}}}},"visible":true},"3":{"slot":3,"name":"Schema ","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88520":{"id":88520,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":237373210,"x":-2284,"y":-832,"width":32,"height":32,"inputConnectorIDs":[88529],"outputSuccessConnectorIDs":[88536],"outputFailureConnectorIDs":[88548],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl.surveymonkeyresponseanswer"}}}},"visible":true},"2":{"slot":2,"name":"Tables to Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"surveymonkeyresponseanswer"}}}},"visible":true},"3":{"slot":3,"name":"Schema ","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88521":{"id":88521,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-1940,"y":-1008,"width":32,"height":32,"inputConnectorIDs":[88534],"outputSuccessConnectorIDs":[88533],"outputFailureConnectorIDs":[88541],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSAT - SM_SurveyResponse_Load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSAT - SM_SurveyResponse_Load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88522":{"id":88522,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-1936,"y":-832,"width":32,"height":32,"inputConnectorIDs":[88530],"outputSuccessConnectorIDs":[88535],"outputFailureConnectorIDs":[88542],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSAT - SM_SurveyResponseAnswer_Load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CSAT - SM_SurveyResponseAnswer_Load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88523":{"id":88523,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-2226,"y":-682,"width":32,"height":32,"inputConnectorIDs":[88545,88544,88547,88546,88548,88541,88543,88542],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[88538],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88524":{"id":88524,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":-2051,"y":-692,"width":32,"height":32,"inputConnectorIDs":[88538],"outputSuccessConnectorIDs":[88537],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"import failed"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} Failed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Job Failed: ${job_name}\n\nErrorMessage: ${Errormessage}\n\nEnvironment: ${environment_name}\n\n\n"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88525":{"id":88525,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":-1728,"y":-912,"width":32,"height":32,"inputConnectorIDs":[88540],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88526":{"id":88526,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":235671163,"x":-1824,"y":-912,"width":32,"height":32,"inputConnectorIDs":[88533,88535],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[88540],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"88527":{"id":88527,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":-1884,"y":-693,"width":32,"height":32,"inputConnectorIDs":[88537],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"88529":{"id":88529,"sourceID":88515,"targetID":88520},"88528":{"id":88528,"sourceID":88519,"targetID":88516},"88531":{"id":88531,"sourceID":88518,"targetID":88515},"88530":{"id":88530,"sourceID":88517,"targetID":88522},"88533":{"id":88533,"sourceID":88521,"targetID":88526},"88532":{"id":88532,"sourceID":88515,"targetID":88519},"88535":{"id":88535,"sourceID":88522,"targetID":88526},"88534":{"id":88534,"sourceID":88516,"targetID":88521},"88537":{"id":88537,"sourceID":88524,"targetID":88527},"88536":{"id":88536,"sourceID":88520,"targetID":88517}},"failureConnectors":{"88545":{"id":88545,"sourceID":88517,"targetID":88523},"88544":{"id":88544,"sourceID":88516,"targetID":88523},"88547":{"id":88547,"sourceID":88515,"targetID":88523},"88546":{"id":88546,"sourceID":88518,"targetID":88523},"88548":{"id":88548,"sourceID":88520,"targetID":88523},"88541":{"id":88541,"sourceID":88521,"targetID":88523},"88543":{"id":88543,"sourceID":88519,"targetID":88523},"88542":{"id":88542,"sourceID":88522,"targetID":88523}},"unconditionalConnectors":{"88539":{"id":88539,"sourceID":88514,"targetID":88518},"88538":{"id":88538,"sourceID":88523,"targetID":88524},"88540":{"id":88540,"sourceID":88526,"targetID":88525}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Move Components","undoCreated":1579722816749,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"88510":{"id":88510,"x":-2857,"y":-1202,"width":436,"height":132,"text":"Connect to survey monkey using their api and authorization. Save the json output to s3 file to be loaded in to the DW\n\nneed to extract both english and french versions of the survey\n\nEnglish : 88334631 French : 85180583\n\ndate:2018-05-17\n\n","colour":"e6e63c"},"88511":{"id":88511,"x":-2558,"y":-1043,"width":161,"height":224,"text":"Extract the earliest changed 100 responsys since the last time the job ran. Will need to run the job multiple times a day to get all responses.","colour":"e6e63c"},"88512":{"id":88512,"x":-2729,"y":-990,"width":103,"height":156,"text":"get the max modified date from the DW table","colour":"e6e63c"},"88513":{"id":88513,"x":-2170,"y":-1054,"width":127,"height":253,"text":"Load json files ","colour":"e6e63c"}},"variables":{"response":{"definition":{"name":"response","type":"TEXT","scope":"TASKBATCH","description":null,"visibility":"PUBLIC"},"value":"${response_json}"}},"grids":{}},"info":{"name":"CSAT - SurveyMonkey_SurveyDetails_Extract","description":"extract the survey details from survey monkey","type":"ORCHESTRATION"}}