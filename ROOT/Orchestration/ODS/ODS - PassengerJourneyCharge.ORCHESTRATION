{"job":{"components":{"26235":{"id":26235,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1343684451,"x":-131,"y":115,"width":32,"height":32,"inputConnectorIDs":[26260,26261,26262,26263,26264,26265,26266],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[26259],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Or 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26236":{"id":26236,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":-1946388514,"x":189,"y":-61,"width":32,"height":32,"inputConnectorIDs":[26249],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Success 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26237":{"id":26237,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-675,"y":-125,"width":32,"height":32,"inputConnectorIDs":[26258],"outputSuccessConnectorIDs":[26248],"outputFailureConnectorIDs":[26260],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get Latest Modified"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n###\n# get the lastest datetime from the table\n#\n###\n\ncursor = context.cursor()\n#subtract 6 hours from the latest datetime incase there are any gaps in the ODS replication or previous job failures\ncursor.execute('select isnull(DATEADD(hr, -6,max(createdutc)),getdate()-7) from ods.passengerjourneycharge WHERE skyledgerkey = 0')\n\nstartdate = cursor.fetchone()[0]\n\n\n#added for manual load\n#startdate = '2019-12-01'\n\ncontext.updateVariable(\"paxchg_maxcreatedutc\", str(startdate))\n\n#test date assignment\n#context.updateVariable(\"paxchg_maxcreatedutc\", str(\"2018-10-28\"))\n\nprint \"paxchg_maxcreatedutc: \" + str(paxchg_maxcreatedutc)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26238":{"id":26238,"inputCardinality":"MANY","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":235671163,"x":-67,"y":-77,"width":32,"height":32,"inputConnectorIDs":[26251,26254],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[26256],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26239":{"id":26239,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-259,"y":-29,"width":32,"height":32,"inputConnectorIDs":[26252],"outputSuccessConnectorIDs":[26254],"outputFailureConnectorIDs":[26265],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS - PassengerJourneyChargeVersion_Load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS - PassengerJourneyChargeVersion_Load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26240":{"id":26240,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-867,"y":-77,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[26257,26258],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start Job"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26241":{"id":26241,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-798585337,"x":61,"y":-61,"width":32,"height":32,"inputConnectorIDs":[26256],"outputSuccessConnectorIDs":[26249],"outputFailureConnectorIDs":[26262],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Clean up Charges"}}}},"visible":true},"2":{"slot":2,"name":"SQL Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DELETE FROM ods.passengerjourneycharge\nwhere  passengerjourneychargeid in (\n\t\tselect distinct passengerjourneychargeid\n\t\tfrom ods.passengerjourneycharge pjc\n\t\tjoin (Select passengerid, segmentid, chargenumber, chargetype, chargecode, ticketcode, max(versionendutc) as versionendutc\n\t\t\t   from ods.passengerjourneychargeversion\n\t\t\t  group by  passengerid, segmentid, chargenumber, chargetype, chargecode, ticketcode\n\t\t\t  )  pjcv\n\t\ton pjc.passengerid = pjcv.passengerid\n\t\tand pjc.segmentid = pjcv.segmentid\n\t\tand pjc.chargenumber = pjcv.chargenumber\n\t\tand pjc.chargetype = pjcv.chargetype\n\t\tand pjc.chargecode = pjcv.chargecode\n\t\tand pjc.ticketcode = pjcv.ticketcode\n\t\twhere versionendutc < '9999-12-31' \n) "}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26242":{"id":26242,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-259,"y":-141,"width":32,"height":32,"inputConnectorIDs":[26253],"outputSuccessConnectorIDs":[26251],"outputFailureConnectorIDs":[26264],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS - PassengerJourneyCharge_Load"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS - PassengerJourneyCharge_Load"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26243":{"id":26243,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-741198691,"x":-467,"y":-13,"width":32,"height":32,"inputConnectorIDs":[26255],"outputSuccessConnectorIDs":[26252],"outputFailureConnectorIDs":[26263],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rez_passengerjourneychargeversion"}}}},"visible":true},"2":{"slot":2,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Microsoft SQL Server"}}}},"visible":true},"3":{"slot":3,"name":"Connection URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_server_url_ods_rezpdod01}"}}}},"visible":true},"6":{"slot":6,"name":"Usename","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_user_ods_rezpdod01}"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"${db_pswd_ods_rezpdod01}"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\tSELECT  * \n\t, TSTREFPDOD01.reference.ConvertUTCtoTZ('CA3', CreatedUTC) AS CreatedEST\n\t, CASE WHEN ForeignCurrencyCode <> 'CAD' \n\t\tTHEN TSTREFPDOD01.reference.ConvertCurrency(chargeamount, ForeignCurrencyCode, 'CAD', 'PD', CreatedUTC)\n\t  ELSE ChargeAmount\n\t  END AS ChargeAmountCAD\n\t, CASE \n\t\tWHEN ForeignCurrencyCode = 'CAD'  AND Currencycode = 'USD'\n\t\t\tTHEN TSTREFPDOD01.reference.ConvertCurrency(1, 'USD', 'CAD', 'PD', CreatedUTC) \n        WHEN ForeignCurrencyCode = 'CAD'  AND Currencycode = 'CAD'\n\t\t\tTHEN 1.00\n\t    WHEN ForeignCurrencyCode <> 'CAD' \n\t\t\tTHEN TSTREFPDOD01.reference.ConvertCurrency(1, ForeignCurrencyCode, 'CAD', 'PD', CreatedUTC)\n\t  ELSE 1.00\n\t  END AS ExchangeRate\nFROM rez.PassengerJourneyChargeversion pjc\nWhere versionstartutc >= CAST('${paxchgver_maxversionstartutc}' as DATETIME2)\nor (versionendutc >= CAST('${paxchgver_maxversionstartutc}' as DATETIME2) \n    AND versionstartutc <= CAST('${paxchgver_maxversionstartutc}' AS DateTime2)\n\tAND versionendutc <> CAST('9999-12-31' as DATETIME2)\n\t)\n"}}}},"visible":true},"9":{"slot":9,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"passengerjourneychargeversion"}}}},"visible":true},"10":{"slot":10,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"porterdatawarehouse"}}}},"visible":true},"11":{"slot":11,"name":"Connection Options","elements":{},"visible":true},"12":{"slot":12,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"4"}}}},"visible":true},"13":{"slot":13,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"15":{"slot":15,"name":"Sort Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PassengerID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SegmentID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ChargeNumber"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"VersionStartUTC"}}}},"visible":true},"16":{"slot":16,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"17":{"slot":17,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"HIDDEN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" drop table if exists \"etl\".\"passengerjourneychargeversion\" cascade; create table \"etl\".\"passengerjourneychargeversion\" (\n\t\"VersionStartUTC\" DATETIME,\n\t\"PassengerID\" DECIMAL(19, 0),\n\t\"SegmentID\" DECIMAL(19, 0),\n\t\"ChargeNumber\" DECIMAL(5, 0),\n\t\"VersionEndUTC\" DATETIME,\n\t\"CreatedUserID\" DECIMAL(19, 0),\n\t\"CreatedUTC\" DATETIME,\n\t\"ChargeType\" DECIMAL(5, 0),\n\t\"ChargeCode\" VARCHAR(6),\n\t\"TicketCode\" VARCHAR(3),\n\t\"CurrencyCode\" VARCHAR(3),\n\t\"ChargeAmount\" DECIMAL(19, 4),\n\t\"ChargeDetail\" VARCHAR(10),\n\t\"ForeignCurrencyCode\" VARCHAR(3),\n\t\"ForeignAmount\" DECIMAL(19, 4),\n\t\"CreatedEST\" DATETIME,\n\t\"ChargeAmountCAD\" DECIMAL(19, 4),\n\t\"ExchangeRate\" DECIMAL(19, 4)\n) DISTSTYLE EVEN"}}}},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26244":{"id":26244,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":438858066,"x":45,"y":115,"width":32,"height":32,"inputConnectorIDs":[26259],"outputSuccessConnectorIDs":[26250],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SNS Message 0"}}}},"visible":true},"2":{"slot":2,"name":"AWS Region","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"us-east-1"}}}},"visible":true},"3":{"slot":3,"name":"Topic Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DW_ETL"}}}},"visible":true},"4":{"slot":4,"name":"Subject","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${job_name} - Job Failed"}}}},"visible":true},"5":{"slot":5,"name":"Message","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Environment: ${environment_name}\n\nJob failed: ${job_name}\n\nError Message: ${Errormessage}"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"DISABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26245":{"id":26245,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-741198691,"x":-467,"y":-141,"width":32,"height":32,"inputConnectorIDs":[26248],"outputSuccessConnectorIDs":[26253],"outputFailureConnectorIDs":[26261],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rez_passengerjourneycharge"}}}},"visible":true},"2":{"slot":2,"name":"Database Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Microsoft SQL Server"}}}},"visible":true},"3":{"slot":3,"name":"Connection URL","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_server_url_ods_rezpdod01}"}}}},"visible":true},"6":{"slot":6,"name":"Usename","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${db_user_ods_rezpdod01}"}}}},"visible":true},"7":{"slot":7,"name":"Password","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"PASSWORD","value":"${db_pswd_ods_rezpdod01}"}}}},"visible":true},"8":{"slot":8,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT  * \n\t, TSTREFPDOD01.reference.ConvertUTCtoTZ('CA3', CreatedUTC) AS CreatedEST\n\t, CASE WHEN ForeignCurrencyCode <> 'CAD' \n\t\tTHEN TSTREFPDOD01.reference.ConvertCurrency(chargeamount, ForeignCurrencyCode, 'CAD', 'PD', CreatedUTC)\n\t  ELSE ChargeAmount\n\t  END AS ChargeAmountCAD\n\t, CASE \n\t\tWHEN ForeignCurrencyCode = 'CAD'  AND Currencycode = 'USD'\n\t\t\tTHEN --REFPDOD01.reference.ConvertCurrency(1, 'USD', 'CAD', 'PD', CreatedUTC) \n            /* check if the exchange rate returns 1 , if so add 5 minutes to the time to get the next exchange rate */\n                (CASE WHEN TSTREFPDOD01.reference.ConvertCurrency(1, 'USD', 'CAD', 'PD', CreatedUTC ) = 1.0\n\t\t\t\tTHEN TSTREFPDOD01.reference.ConvertCurrency(1, 'USD', 'CAD', 'PD', DATEADD(mi,5,CreatedUTC) ) \n\t\t\t\tELSE TSTREFPDOD01.reference.ConvertCurrency(1, 'USD', 'CAD', 'PD',  CreatedUTC ) \n\t\t\t\tEND)\n        WHEN ForeignCurrencyCode = 'CAD'  AND Currencycode = 'CAD'\n\t\t\tTHEN 1.00\n\t    WHEN ForeignCurrencyCode <> 'CAD' \n\t\t\tTHEN --REFPDOD01.reference.ConvertCurrency(1, ForeignCurrencyCode, 'CAD', 'PD', CreatedUTC)\n            /* check if the exchange rate returns 1 , if so add 5 minute to the time to get the next exchange rate */\n            \t(CASE WHEN TSTREFPDOD01.reference.ConvertCurrency(1, ForeignCurrencyCode, 'CAD', 'PD', CreatedUTC ) = 1.0\n\t\t\t\tTHEN TSTREFPDOD01.reference.ConvertCurrency(1, ForeignCurrencyCode, 'CAD', 'PD', DATEADD(mi,5,CreatedUTC) )\n\t\t\t\tELSE TSTREFPDOD01.reference.ConvertCurrency(1, ForeignCurrencyCode, 'CAD', 'PD', CreatedUTC )\n\t\t\t\tEND)\n\t  ELSE 1.00\n\t  END AS ExchangeRate\nFROM rez.PassengerJourneyCharge pjc\nwhere createdutc >= CAST('${paxchg_maxcreatedutc}' as DATETIME2)"}}}},"visible":true},"9":{"slot":9,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PassengerJourneyCharge"}}}},"visible":true},"10":{"slot":10,"name":"S3 Staging Area","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"porterdatawarehouse"}}}},"visible":true},"11":{"slot":11,"name":"Connection Options","elements":{},"visible":true},"12":{"slot":12,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"6"}}}},"visible":true},"13":{"slot":13,"name":"Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"14":{"slot":14,"name":"Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"15":{"slot":15,"name":"Sort Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PassengerID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SegmentID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ChargeNumber"}}}},"visible":true},"16":{"slot":16,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"etl"}}}},"visible":true},"17":{"slot":17,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":true},"18":{"slot":18,"name":"Primary Key","elements":{},"visible":true},"20":{"slot":20,"name":"Data Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"96":{"slot":96,"name":"Location","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"s3://<bucket>/<path>"}}}},"visible":false},"97":{"slot":97,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"98":{"slot":98,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"99":{"slot":99,"name":"Type","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Standard"}}}},"visible":true},"101":{"slot":101,"name":"Basic/Advanced Mode","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Advanced"}}}},"visible":true},"102":{"slot":102,"name":"Data Source","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"103":{"slot":103,"name":"Data Selection","elements":{},"visible":false},"104":{"slot":104,"name":"Data Source Filter","elements":{},"visible":false},"105":{"slot":105,"name":"Combine Filters","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"And"}}}},"visible":false},"106":{"slot":106,"name":"Limit","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"100"}}}},"visible":false},"1001":{"slot":1001,"name":"HIDDEN","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":" drop table if exists \"etl\".\"PassengerJourneyCharge\" cascade; create table \"etl\".\"PassengerJourneyCharge\" (\n\t\"PassengerID\" DECIMAL(19, 0),\n\t\"SegmentID\" DECIMAL(19, 0),\n\t\"ChargeNumber\" DECIMAL(5, 0),\n\t\"CreatedUserID\" DECIMAL(19, 0),\n\t\"CreatedUTC\" DATETIME,\n\t\"ChargeType\" DECIMAL(5, 0),\n\t\"ChargeCode\" VARCHAR(6),\n\t\"TicketCode\" VARCHAR(3),\n\t\"CurrencyCode\" VARCHAR(3),\n\t\"ChargeAmount\" DECIMAL(19, 4),\n\t\"ChargeDetail\" VARCHAR(10),\n\t\"ForeignCurrencyCode\" VARCHAR(3),\n\t\"ForeignAmount\" DECIMAL(19, 4),\n\t\"CreatedEST\" DATETIME,\n\t\"ChargeAmountCAD\" DECIMAL(19, 4),\n\t\"ExchangeRate\" DECIMAL(19, 4)\n) DISTSTYLE EVEN"}}}},"visible":false},"1034":{"slot":1034,"name":"Load Options","elements":{},"visible":true},"40000":{"slot":40000,"name":"Encryption","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"None"}}}},"visible":true},"40001":{"slot":40001,"name":"KMS Key ID","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26246":{"id":26246,"inputCardinality":"ONE","outputCardinality":"ZERO","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":515156205,"x":189,"y":115,"width":32,"height":32,"inputConnectorIDs":[26250],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"End Failure 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"26247":{"id":26247,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1773186960,"x":-675,"y":-13,"width":32,"height":32,"inputConnectorIDs":[26257],"outputSuccessConnectorIDs":[26255],"outputFailureConnectorIDs":[26266],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{"1":{"slot":1,"fromId":null,"fromName":"Message","mapTo":"Errormessage"}},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get Latest Modified - Version"}}}},"visible":true},"2":{"slot":2,"name":"Script","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"###\n###\n#  Updating a variable:\n#    context.updateVariable('myvar', 'new-value')\n# Using a database cursor:\n#   cursor = context.getCursor()\n#   cursor.execute('select count(*) from mytable')\n#   rowcount = cursor.fetchone()[0]\n#\n###\n\ncursor = context.cursor()\ncursor.execute('select isnull(DATEADD(hr, -6,max(versionstartutc)),getdate()) from ods.passengerjourneychargeversion')\n\nstartdate = cursor.fetchone()[0]\n#added for manual load\n#startdate = '2019-12-01'\n\ncontext.updateVariable(\"paxchgver_maxversionstartutc\", str(startdate))\n#context.updateVariable(\"paxchgver_maxversionstartutc\", str(\"2018-10-28\"))\n\nprint \"paxchgver_maxversionstartutc: \" + str(paxchgver_maxversionstartutc)"}}}},"visible":true},"3":{"slot":3,"name":"Interpreter","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Jython"}}}},"visible":true},"4":{"slot":4,"name":"Timeout","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"360"}}}},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]}},"successConnectors":{"26248":{"id":26248,"sourceID":26237,"targetID":26245},"26249":{"id":26249,"sourceID":26241,"targetID":26236},"26250":{"id":26250,"sourceID":26244,"targetID":26246},"26251":{"id":26251,"sourceID":26242,"targetID":26238},"26252":{"id":26252,"sourceID":26243,"targetID":26239},"26253":{"id":26253,"sourceID":26245,"targetID":26242},"26254":{"id":26254,"sourceID":26239,"targetID":26238},"26255":{"id":26255,"sourceID":26247,"targetID":26243}},"failureConnectors":{"26260":{"id":26260,"sourceID":26237,"targetID":26235},"26261":{"id":26261,"sourceID":26245,"targetID":26235},"26262":{"id":26262,"sourceID":26241,"targetID":26235},"26263":{"id":26263,"sourceID":26243,"targetID":26235},"26264":{"id":26264,"sourceID":26242,"targetID":26235},"26265":{"id":26265,"sourceID":26239,"targetID":26235},"26266":{"id":26266,"sourceID":26247,"targetID":26235}},"unconditionalConnectors":{"26256":{"id":26256,"sourceID":26238,"targetID":26241},"26257":{"id":26257,"sourceID":26240,"targetID":26247},"26258":{"id":26258,"sourceID":26240,"targetID":26237},"26259":{"id":26259,"sourceID":26235,"targetID":26244}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{},"noteConnectors":{},"canUndo":true,"undoCommand":"Set Parameter","undoCreated":1577139991237,"canRedo":false,"redoCommand":"","redoCreated":-1,"notes":{"26234":{"id":26234,"x":-896,"y":-279,"width":285,"height":105,"text":"Extracts new, updated and delete records from the ODS REZ database\n\nuses variables to connect to the ODS database\n\nupdate:2018-10-30\n\nadded where clause to exclude skyledger updates to get the mad modified date","colour":"e6e63c"}},"variables":{"paxchgver_maxversionstartutc":{"definition":{"name":"paxchgver_maxversionstartutc","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""},"paxchg_maxcreatedutc":{"definition":{"name":"paxchg_maxcreatedutc","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":""}},"grids":{}},"info":{"name":"ODS - PassengerJourneyCharge","description":"","type":"ORCHESTRATION"}}